const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dj8ncPAG.js","assets/ui-vendor-CJNjIdOR.js","assets/react-vendor-92AQlTAG.js","assets/three-vendor-CVohgf7y.js","assets/index-CM9obA4Y.css"])))=>i.map(i=>d[i]);
var S=Object.defineProperty;var E=(h,e,s)=>e in h?S(h,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[e]=s;var m=(h,e,s)=>E(h,typeof e!="symbol"?e+"":e,s);import{_ as p}from"./three-vendor-CVohgf7y.js";import{J as y}from"./jszip.min-VaQned3v.js";const l=class l{async validateTheme(e){const s=[],t=[];try{this.validateMetadata(e,s,t),this.validateCompatibility(e,s,t),this.validateComponents(e,s,t),await this.performSecurityScan(e,s,t),this.validatePerformance(e,s,t),this.validateAccessibility(e,s,t)}catch(n){s.push({type:"structure",severity:"critical",message:`Validation failed: ${n instanceof Error?n.message:String(n)}`,suggestion:"Fix critical errors before proceeding"})}const i=this.calculateScore(s,t),a=this.generateSummary(s,t,i);return{isValid:s.filter(n=>n.severity==="critical"||n.severity==="high").length===0,score:i,errors:s,warnings:t,summary:a}}async validateThemePackage(e){const s=[],t=[];try{await this.validateStructure(e,s,t),await this.validateThemeJson(e,s,t),await this.validateComponentFiles(e,s,t),await this.securityScan(e,s,t),await this.validateFileSizes(e,s,t)}catch(n){s.push({type:"structure",severity:"critical",message:`Package validation failed: ${n instanceof Error?n.message:String(n)}`,suggestion:"Ensure package structure is correct"})}const i=this.calculateScore(s,t),a=this.generateSummary(s,t,i);return{isValid:s.filter(n=>n.severity==="critical"||n.severity==="high").length===0,score:i,errors:s,warnings:t,summary:a}}validateMetadata(e,s,t){const{metadata:i}=e;if(!i){s.push({type:"structure",severity:"critical",message:"Theme metadata is required",suggestion:"Add metadata object to theme configuration"});return}const a=["name","version","description","author"];for(const n of a)i[n]||s.push({type:"structure",severity:"high",message:`Missing required field in metadata: ${n}`,suggestion:`Add "${n}" to theme metadata`});i.version&&!/^\d+\.\d+\.\d+/.test(i.version)&&s.push({type:"structure",severity:"medium",message:"Invalid version format",suggestion:"Use semantic versioning (e.g., 1.0.0)"})}validateCompatibility(e,s,t){const{metadata:i}=e;if(!(i!=null&&i.compatibility)){t.push({type:"best-practice",message:"No compatibility information provided",suggestion:"Add compatibility field to specify supported versions"});return}if(i.compatibility.stencil){const a=l.CANVABIS_VERSION,n=i.compatibility.stencil;this.isVersionCompatible(a,n)||s.push({type:"compatibility",severity:"critical",message:`Theme requires Stencil ${n}, but current version is ${a}`,suggestion:"Update theme or upgrade Stencil version"})}}validateComponents(e,s,t){if(!e.components){s.push({type:"structure",severity:"critical",message:"Theme components are required",suggestion:"Add components object to theme"});return}const i=["Header","Footer"];for(const a of i)e.components[a]||s.push({type:"structure",severity:"high",message:`Required component '${a}' is missing`,suggestion:`Create ${a} component`})}async performSecurityScan(e,s,t){const i=[{pattern:/eval\s*\(/g,message:"Use of eval() is dangerous and can lead to code injection"},{pattern:/Function\s*\(/g,message:"Function constructor is dangerous"},{pattern:/document\.write/g,message:"document.write can cause XSS vulnerabilities"},{pattern:/innerHTML\s*=/g,message:"innerHTML can cause XSS, use textContent or sanitize input"},{pattern:/dangerouslySetInnerHTML/g,message:"dangerouslySetInnerHTML should be used with caution"}],a=JSON.stringify(e);for(const{pattern:n,message:r}of i)n.test(a)&&t.push({type:"security",message:r,suggestion:"Review and ensure safe usage or use alternatives"})}validatePerformance(e,s,t){var i;(i=e.assets)!=null&&i.styles&&Array.isArray(e.assets.styles)&&(e.assets.styles.length>10&&t.push({type:"performance",message:"Large number of style files may impact performance",suggestion:"Consider bundling styles into fewer files"}),e.assets.styles.reduce((n,r)=>n+r.length,0)>1e5&&t.push({type:"performance",message:"Total CSS size exceeds 100KB",suggestion:"Optimize and minify CSS files"}))}validateAccessibility(e,s,t){var i,a;(a=(i=e.metadata)==null?void 0:i.supports)!=null&&a.includes("accessibility")||t.push({type:"best-practice",message:"Theme does not declare accessibility support",suggestion:"Consider adding accessibility features and declaring support"})}async validateStructure(e,s,t){const i=["theme.json","components/layout/Header.tsx","components/layout/Footer.tsx"];for(const r of i)e.find(o=>o.path===r||o.path.endsWith(r))||s.push({type:"structure",severity:"critical",message:`Required file missing: ${r}`,file:r,suggestion:`Create the file ${r} in your theme package`});const a=["README.md","CHANGELOG.md","preview.jpg"];for(const r of a)e.find(o=>o.path===r)||t.push({type:"best-practice",message:`Recommended file missing: ${r}`,file:r,suggestion:`Consider adding ${r} for better documentation`});const n=[".tsx",".ts",".jsx",".js",".css",".scss",".json",".md",".jpg",".jpeg",".png",".svg",".webp",".woff",".woff2",".ttf",".otf"];for(const r of e){const o=r.path.substring(r.path.lastIndexOf(".")).toLowerCase();o&&!n.includes(o)&&t.push({type:"best-practice",message:`Unusual file extension: ${r.path}`,file:r.path,suggestion:"Ensure this file is necessary and safe"})}}async validateThemeJson(e,s,t){var a;const i=e.find(n=>n.path==="theme.json"||n.path.endsWith("/theme.json"));if(i)try{const n=JSON.parse(i.content),r=["name","displayName","version","description","author"];for(const o of r)n[o]||s.push({type:"structure",severity:"high",message:`Missing required field in theme.json: ${o}`,file:"theme.json",suggestion:`Add "${o}" field to theme.json`});n.version&&!/^\d+\.\d+\.\d+/.test(n.version)&&s.push({type:"structure",severity:"medium",message:"Invalid version format in theme.json",file:"theme.json",suggestion:"Use semantic versioning (e.g., 1.0.0)"}),(a=n.compatibility)!=null&&a.stencil&&(this.isVersionCompatible(l.CANVABIS_VERSION,n.compatibility.stencil)||s.push({type:"compatibility",severity:"critical",message:`Theme is not compatible with current Stencil version (${l.CANVABIS_VERSION})`,file:"theme.json",suggestion:"Update compatibility range or theme code"}))}catch{s.push({type:"structure",severity:"critical",message:"Invalid JSON in theme.json",file:"theme.json",suggestion:"Fix JSON syntax errors"})}}async validateComponentFiles(e,s,t){const i=e.filter(a=>(a.path.includes("/components/")||a.path.startsWith("components/"))&&(a.path.endsWith(".tsx")||a.path.endsWith(".jsx")));for(const a of i)!/import\s+(?:React|\{[^}]*\})\s+from\s+['"]react['"]/.test(a.content)&&/export\s+default/.test(a.content)&&t.push({type:"best-practice",message:"Component may be missing React import",file:a.path,suggestion:"Ensure React is imported if needed"}),/export\s+default/.test(a.content)||s.push({type:"structure",severity:"high",message:"Component missing default export",file:a.path,suggestion:"Add default export to component"})}async securityScan(e,s,t){const i=[{pattern:/eval\s*\(/g,message:"Use of eval() is dangerous"},{pattern:/Function\s*\(/g,message:"Function constructor is dangerous"},{pattern:/document\.write/g,message:"document.write can cause XSS"},{pattern:/innerHTML\s*=/g,message:"innerHTML can cause XSS, use textContent"},{pattern:/dangerouslySetInnerHTML/g,message:"dangerouslySetInnerHTML should be used carefully"},{pattern:/__dirname/g,message:"__dirname not available in browser"},{pattern:/__filename/g,message:"__filename not available in browser"},{pattern:/process\.env/g,message:"process.env access in client code"}];for(const a of e)if(a.path.endsWith(".tsx")||a.path.endsWith(".ts")||a.path.endsWith(".js")||a.path.endsWith(".jsx"))for(const{pattern:n,message:r}of i)n.test(a.content)&&t.push({type:"security",message:`Security concern in ${a.path}: ${r}`,file:a.path,suggestion:"Review and ensure safe usage"})}async validateFileSizes(e,s,t){let i=0;for(const a of e)i+=a.size,a.size>l.MAX_FILE_SIZE&&t.push({type:"performance",message:`File exceeds 1MB: ${a.path} (${Math.round(a.size/1024)}KB)`,file:a.path,suggestion:"Consider optimizing or splitting this file"});i>l.MAX_TOTAL_SIZE&&t.push({type:"performance",message:`Total package size exceeds 10MB (${Math.round(i/1024/1024)}MB)`,suggestion:"Optimize assets and code to reduce package size"})}calculateScore(e,s){let t=100;for(const i of e)switch(i.severity){case"critical":t-=25;break;case"high":t-=15;break;case"medium":t-=10;break;case"low":t-=5;break}return t-=s.length*2,Math.max(0,Math.min(100,t))}generateSummary(e,s,t){const i=e.filter(o=>o.severity==="critical").length,a=e.filter(o=>o.severity==="high").length,n=e.length,r=s.length;return i>0?`Theme has ${i} critical error(s) that must be fixed before installation.`:a>0?`Theme has ${a} high-priority error(s) that should be addressed.`:n>0?`Theme has ${n} error(s) and ${r} warning(s). Score: ${t}/100`:r>0?`Theme is valid with ${r} warning(s). Score: ${t}/100`:`Theme is valid and ready for installation. Score: ${t}/100`}isVersionCompatible(e,s){const t=n=>{const r=n.match(/(\d+)\.(\d+)\.(\d+)/);return r?[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])]:[0,0,0]},i=t(e),a=t(s.replace(/[^0-9.]/g,""));return s.startsWith("^")?i[0]===a[0]&&(i[1]>a[1]||i[1]===a[1]&&i[2]>=a[2]):s.startsWith("~")?i[0]===a[0]&&i[1]===a[1]&&i[2]>=a[2]:i[0]>=a[0]&&i[1]>=a[1]&&i[2]>=a[2]}};m(l,"CANVABIS_VERSION","1.0.0"),m(l,"MAX_FILE_SIZE",1024*1024),m(l,"MAX_TOTAL_SIZE",10*1024*1024);let d=l;class w{constructor(){m(this,"STORAGE_PREFIX","theme:")}async saveTheme(e,s){const t=this.STORAGE_PREFIX+e;try{localStorage.setItem(t,JSON.stringify(s))}catch(i){throw console.error(`Failed to save theme: ${e}`,i),new Error(`Theme storage failed: ${e}`)}}async getTheme(e){const s=this.STORAGE_PREFIX+e;try{const t=localStorage.getItem(s);return t?JSON.parse(t):null}catch(t){return console.error(`Failed to load theme: ${e}`,t),null}}async deleteTheme(e){const s=this.STORAGE_PREFIX+e;localStorage.removeItem(s)}async listThemes(){const e=[];for(let s=0;s<localStorage.length;s++){const t=localStorage.key(s);t!=null&&t.startsWith(this.STORAGE_PREFIX)&&e.push(t.replace(this.STORAGE_PREFIX,""))}return e}}const u=new w;class b{constructor(){m(this,"validator");m(this,"installationCallbacks");this.validator=new d,this.installationCallbacks=new Map}async installThemeFromZip(e,s){const t=this.generateId();s&&this.installationCallbacks.set(t,s);try{if(this.updateProgress(t,{stage:"uploading",progress:10,message:"Validating upload..."}),!this.isValidZipFile(e))throw new Error("Invalid ZIP file format. Please upload a valid theme package.");if(e.size>50*1024*1024)throw new Error("Theme package too large. Maximum size is 50MB.");this.updateProgress(t,{stage:"extracting",progress:25,message:"Extracting theme files..."});const i=await this.extractZipFile(e);this.updateProgress(t,{stage:"validating",progress:50,message:"Validating theme structure and security..."});const a=await this.validator.validateThemePackage(i);if(!a.isValid){const o=a.errors.filter(g=>g.severity==="critical"||g.severity==="high");if(o.length>0)throw new Error(`Theme validation failed: ${o[0].message}`)}this.updateProgress(t,{stage:"installing",progress:75,message:"Installing theme..."});const n=await this.convertFilesToTheme(i),r=n.metadata.name;if(await this.themeExists(r)){if(!await this.confirmOverwrite(r))throw new Error("Installation cancelled: Theme already exists.");await this.backupExistingTheme(r)}return await this.saveThemeToStorage(n),this.updateProgress(t,{stage:"activating",progress:90,message:"Registering theme..."}),await this.registerTheme(n),this.updateProgress(t,{stage:"complete",progress:100,message:"Theme installed successfully!"}),{success:!0,themeName:r,validation:a}}catch(i){const a=i instanceof Error?i.message:"Unknown error occurred";return this.updateProgress(t,{stage:"error",progress:0,message:"Installation failed",error:a}),{success:!1,error:a}}finally{this.installationCallbacks.delete(t)}}async exportThemeAsZip(e,s={}){const t=new y;if(t.file("theme.json",JSON.stringify(e.metadata,null,2)),e.components){const i=t.folder("components");if(i){const a=i.folder("layout");Object.entries(e.components).forEach(([n,r])=>{const o=typeof r=="function"?this.componentToString(r):r;n==="Header"||n==="Footer"?a==null||a.file(`${n}.tsx`,o):i.file(`${n}.tsx`,o)})}}if(e.assets){if(Array.isArray(e.assets.styles)&&e.assets.styles.length>0){const a=t.folder("styles");e.assets.styles.forEach((n,r)=>{a==null||a.file(`style-${r}.css`,n)})}const i=t.folder("assets");if(e.assets.images&&Object.keys(e.assets.images).length>0){const a=i==null?void 0:i.folder("images");Object.entries(e.assets.images).forEach(([n,r])=>{a==null||a.file(n,r)})}if(e.assets.fonts&&Object.keys(e.assets.fonts).length>0){const a=i==null?void 0:i.folder("fonts");Object.entries(e.assets.fonts).forEach(([n,r])=>{a==null||a.file(n,r)})}}return s.includeReadme!==!1&&t.file("README.md",this.generateReadme(e.metadata)),s.includeChangelog&&t.file("CHANGELOG.md",this.generateChangelog(e.metadata)),s.includeLicense&&t.file("LICENSE",this.generateLicense(e.metadata)),await t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})}async uninstallTheme(e){if(await this.getActiveTheme()===e)throw new Error("Cannot uninstall active theme. Please activate another theme first.");await this.backupExistingTheme(e),await this.removeThemeFromStorage(e),await this.unregisterTheme(e)}async extractZipFile(e){var a;const t=await new y().loadAsync(e),i=[];for(const[n,r]of Object.entries(t.files))if(!r.dir){let o;if(this.isTextFile(n))o=await r.async("text");else{const g=await r.async("blob");o=await this.blobToBase64(g)}i.push({path:this.normalizePath(n),name:n.split("/").pop()||"",content:o,size:((a=r._data)==null?void 0:a.uncompressedSize)||o.length,lastModified:r.date||new Date})}return i}async convertFilesToTheme(e){const s=e.find(c=>c.path==="theme.json");if(!s)throw new Error("theme.json not found in package");const t=JSON.parse(s.content),i={},a=e.filter(c=>c.path.includes("components/")&&(c.path.endsWith(".tsx")||c.path.endsWith(".jsx")));for(const c of a){const v=c.name.replace(/\.(tsx|jsx)$/,"");i[v]=c.content}const r=e.filter(c=>c.path.includes("styles/")&&(c.path.endsWith(".css")||c.path.endsWith(".scss"))).map(c=>c.content),o=e.filter(c=>c.path.includes("assets/images/")&&this.isImageFile(c.path)),g={};for(const c of o)g[c.name]=c.content;const T=e.filter(c=>c.path.includes("assets/fonts/")&&this.isFontFile(c.path)),f={};for(const c of T)f[c.name]=c.content;return{metadata:t,components:i,assets:{styles:r,images:g,fonts:f}}}async saveThemeToStorage(e){await u.saveTheme(e.metadata.name,e)}async registerTheme(e){const{themeManager:s}=await p(async()=>{const{themeManager:t}=await import("./index-Dj8ncPAG.js").then(i=>i.b2);return{themeManager:t}},__vite__mapDeps([0,1,2,3,4]));await s.registerTheme(e.metadata.name,e)}async themeExists(e){return await u.getTheme(e)!==null}async confirmOverwrite(e){return!0}async backupExistingTheme(e){const s=await u.getTheme(e);if(s){const t=`theme_backup_${e}_${Date.now()}`;localStorage.setItem(t,JSON.stringify(s))}}async removeThemeFromStorage(e){await u.deleteTheme(e)}async unregisterTheme(e){const{themeManager:s}=await p(async()=>{const{themeManager:t}=await import("./index-Dj8ncPAG.js").then(i=>i.b2);return{themeManager:t}},__vite__mapDeps([0,1,2,3,4]));await s.unregisterTheme(e)}async getActiveTheme(){const{themeManager:e}=await p(async()=>{const{themeManager:s}=await import("./index-Dj8ncPAG.js").then(t=>t.b2);return{themeManager:s}},__vite__mapDeps([0,1,2,3,4]));return e.getActiveThemeName()}isValidZipFile(e){return e.type==="application/zip"||e.type==="application/x-zip-compressed"||e.name.endsWith(".zip")}isTextFile(e){return[".tsx",".ts",".jsx",".js",".css",".scss",".json",".md",".txt",".html"].some(t=>e.endsWith(t))}isImageFile(e){return[".jpg",".jpeg",".png",".gif",".svg",".webp",".ico"].some(t=>e.toLowerCase().endsWith(t))}isFontFile(e){return[".woff",".woff2",".ttf",".otf",".eot"].some(t=>e.toLowerCase().endsWith(t))}normalizePath(e){const t=e.replace(/\\/g,"/").split("/");return t[0]&&!t[0].includes(".")&&t.shift(),t.join("/")}async blobToBase64(e){return new Promise((s,t)=>{const i=new FileReader;i.onloadend=()=>s(i.result),i.onerror=t,i.readAsDataURL(e)})}componentToString(e){return typeof e=="string"?e:typeof e=="function"?e.toString():"export default function Component() { return null; }"}generateReadme(e){var s;return`# ${e.name}

**Version**: ${e.version}  
**Author**: ${e.author}

## Description

${e.description}

## Installation

1. Upload this theme package through the theme management interface
2. Activate the theme from the themes list
3. Configure theme settings as needed

## Features

${((s=e.supports)==null?void 0:s.map(t=>`- ${t}`).join(`
`))||"No features listed"}

## Customization

Refer to the theme settings page for customization options.

## Support

For support and bug reports, please contact ${e.author}.

## License

${e.license||"All rights reserved"}
`}generateChangelog(e){return`# Changelog

## [${e.version}] - ${new Date().toISOString().split("T")[0]}

### Added
- Initial release

### Changed
- N/A

### Fixed
- N/A
`}generateLicense(e){const s=new Date().getFullYear(),t=e.author,i=e.license||"MIT";return i==="MIT"?`MIT License

Copyright (c) ${s} ${t}

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.`:`${i} License

Copyright (c) ${s} ${t}

All rights reserved.`}updateProgress(e,s){const t=this.installationCallbacks.get(e);t&&t(s)}generateId(){return`install_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const R=new b;export{d as T,R as t};
