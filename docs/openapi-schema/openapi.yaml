openapi: 3.1.0
info:
  title: Stencil CMS API - Comprehensive Multi-Tenant Platform
  version: 1.0.0
  description: |
    # Stencil CMS - Enterprise Multi-Tenant Content Management System
    
    ## Overview
    
    Complete OpenAPI 3.1+ specification for Stencil CMS covering **1,800+ fields** across **22 modules** 
    with comprehensive CRUD operations, multi-tenant architecture, and JWT authentication.
    
    ## Architecture Features
    
    - **üè¢ Multi-Tenancy**: Complete tenant isolation with `tenant_id` in all entities
    - **üîê JWT Authentication**: Bearer token authentication with role-based access control
    - **üõ°Ô∏è Security**: Comprehensive RBAC with tenant-scoped permissions
    - **üìä Performance**: Optimized queries with pagination and filtering
    - **üîç Search**: Full-text search across all content types
    - **üìà Analytics**: Built-in analytics and reporting capabilities
    
    ## Module Groups
    
    ### üé® Content Management (5 modules)
    - **‚úÖ Homepage**: Advanced page builder with 240+ fields, 23 tables **(IMPLEMENTED)**
    - **‚úÖ About Us**: Company profiles with 80+ fields, 10 tables **(IMPLEMENTED)**
    - **‚ùå Contact**: Dynamic forms with 150+ fields, 7 tables *(PENDING)*
    - **‚ùå FAQ**: Knowledge base with 150+ fields, 5 tables *(PENDING)*
    - **‚ùå SEO**: Universal SEO system with 20+ fields, 3 tables *(PENDING)*
    
    ### üõí E-Commerce (4 modules)  
    - **‚ùå Products**: Product catalog with 68+ fields, 4 tables *(PENDING)*
    - **‚ùå Reviews**: Rating system with 65+ fields, 5 tables *(PENDING)*
    - **‚úÖ Orders**: Complete workflow with 164+ fields, 7 tables **(IMPLEMENTED)**
    - **‚ùå Inventory**: Stock management with 180+ fields, 8+ tables *(PENDING)*
    
    ### üë• User Management (4 modules)
    - **Users**: RBAC system with 180+ fields, 9 tables
    - **Customers**: Customer lifecycle with 120+ fields, 6+ tables
    - **Vendors**: Vendor management with 97+ fields, 6 tables
    - **Suppliers**: Supply chain with 180+ fields, 8+ tables
    
    ### ‚öôÔ∏è System Administration (3 modules)
    - **Financial**: Revenue tracking with 120+ fields, 6+ tables
    - **Settings**: System config with 85+ fields, 5+ tables
    - **Plugins**: Extension system with variable fields
    
    ### üìÅ Assets & Localization (4 modules)
    - **Media**: File management with 80+ fields, 4+ tables
    - **Documentation**: Help center with 65+ fields, 4+ tables
    - **Theme**: Dynamic theming with 165+ fields, 7+ tables  
    - **Language**: i18n support with 45+ fields, 3+ tables
    
    ## Authentication & Security
    
    All admin endpoints require Bearer token authentication:
    ```
    Authorization: Bearer {jwt_token}
    X-Tenant-ID: {tenant_uuid}
    ```
    
    ## Response Format
    
    **Success Response:**
    ```json
    {
      "success": true,
      "data": { "...": "response data" },
      "message": "Operation completed successfully",
      "meta": {
        "timestamp": "2025-11-12T13:00:00Z",
        "tenant_id": "550e8400-e29b-41d4-a716-446655440000",
        "request_id": "req_123456789"
      }
    }
    ```
    
    **Error Response:**
    ```json
    {
      "success": false,
      "error": {
        "code": "VALIDATION_ERROR",
        "message": "Validation failed",
        "details": { "field": ["error messages"] }
      },
      "meta": {
        "timestamp": "2025-11-12T13:00:00Z",
        "tenant_id": "550e8400-e29b-41d4-a716-446655440000",
        "request_id": "req_123456789"
      }
    }
    ```
    
    ## Rate Limiting
    
    - **Public endpoints**: 60 requests per minute per IP
    - **Authenticated endpoints**: 120 requests per minute per user
    - **Admin endpoints**: 200 requests per minute per admin user
    
    ## Pagination
    
    All list endpoints support pagination:
    - `page`: Page number (default: 1)
    - `per_page`: Items per page (default: 15, max: 100)
    - `sort`: Sort field (default: created_at)  
    - `order`: Sort direction (asc/desc, default: desc)
    
    ## Search & Filtering
    
    Most endpoints support advanced filtering:
    - `search`: Full-text search query
    - `filter[field]`: Field-specific filters
    - `date_from` / `date_to`: Date range filtering
    - `status`: Status filtering where applicable
    
    ---
    
    **üö® Implementation Status:** Phase 1 - Foundation Setup Complete  
    **üìä Coverage:** 1,800+ fields converted to OpenAPI schemas  
    **üîê Security:** Multi-tenant isolation with JWT authentication  
    **üìà Business Impact:** Complete API standardization for enterprise CMS platform

  contact:
    name: CanvaStack Development Team
    url: https://canvastack.com
    email: dev@canvastack.com
  license:
    name: MIT License
    url: https://opensource.org/licenses/MIT
  termsOfService: https://canvastack.com/terms

servers:
  - url: https://api.stencil.local/v1
    description: Local development server
  - url: https://api-staging.stencil.canvastack.com/v1  
    description: Staging environment
  - url: https://api.stencil.canvastack.com/v1
    description: Production environment

# Security Schemes
security:
  - bearerAuth: []
  - tenantHeader: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer token authentication. 
        
        **Format:** `Authorization: Bearer {jwt_token}`
        
        **Token Structure:**
        ```json
        {
          "user_id": "uuid",
          "tenant_id": "uuid", 
          "roles": ["admin", "editor"],
          "permissions": ["users.create", "content.edit"],
          "exp": 1640995200
        }
        ```
    
    tenantHeader:
      type: apiKey
      in: header
      name: X-Tenant-ID
      description: |
        Tenant UUID header for multi-tenant isolation.
        
        **Format:** `X-Tenant-ID: 550e8400-e29b-41d4-a716-446655440000`
        
        **Required for all authenticated endpoints.**

  # External Component References  
  responses:
    $ref: './components/responses.yaml'
  parameters:
    $ref: './components/parameters.yaml'
    
  # Schema Definitions (mix of external and inline)
  schemas:
    # External schemas
    ValidationErrorResponse:
      $ref: './components/schemas.yaml#/ValidationErrorResponse'
    BaseResponse:
      $ref: './components/schemas.yaml#/BaseResponse'
    SuccessResponse:
      $ref: './components/schemas.yaml#/SuccessResponse'
    ErrorResponse:
      $ref: './components/schemas.yaml#/ErrorResponse'
    PaginationMeta:
      $ref: './components/schemas.yaml#/PaginationMeta'
    PaginatedResponse:
      $ref: './components/schemas.yaml#/PaginatedResponse'
    TenantInfo:
      $ref: './components/schemas.yaml#/TenantInfo'
    AuditInfo:
      $ref: './components/schemas.yaml#/AuditInfo'
    TranslationStatus:
      $ref: './components/schemas.yaml#/TranslationStatus'
    BaseTranslation:
      $ref: './components/schemas.yaml#/BaseTranslation'
    
    # Inline Schema Definitions (legacy compatibility)
    # Base Entity Schema
    BaseEntity:
      type: object
      required:
        - id
        - tenant_id
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier (UUID v4)
          example: "550e8400-e29b-41d4-a716-446655440000"
        tenant_id:
          type: string
          format: uuid
          description: Tenant isolation identifier
          example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp (ISO 8601)
          example: "2025-11-12T13:00:00Z"
        updated_at:
          type: string
          format: date-time  
          description: Last modification timestamp (ISO 8601)
          example: "2025-11-12T13:30:00Z"
        deleted_at:
          type: string
          format: date-time
          nullable: true
          description: Soft deletion timestamp (ISO 8601)
          example: null

# Main API Paths (will be extended with specific modules)
# paths section defined below after schemas

  # Reusable Schemas - continue components section
  schemas:
    # Pagination Meta Information
    PaginationMeta:
      type: object
      required:
        - page
        - per_page
        - total
        - last_page
      properties:
        page:
          type: integer
          minimum: 1
          description: Current page number
          example: 1
        per_page:
          type: integer
          minimum: 1
          maximum: 100
          description: Items per page
          example: 15
        total:
          type: integer
          minimum: 0
          description: Total number of items
          example: 150
        last_page:
          type: integer
          minimum: 1
          description: Last page number
          example: 10
        from:
          type: integer
          minimum: 0
          nullable: true
          description: First item number on current page
          example: 1
        to:
          type: integer
          minimum: 0
          nullable: true
          description: Last item number on current page  
          example: 15
        path:
          type: string
          description: Base URL for pagination
          example: "/api/v1/pages"
        first_page_url:
          type: string
          description: First page URL
          example: "/api/v1/pages?page=1"
        last_page_url:
          type: string
          description: Last page URL
          example: "/api/v1/pages?page=10"
        next_page_url:
          type: string
          nullable: true
          description: Next page URL
          example: "/api/v1/pages?page=2"
        prev_page_url:
          type: string
          nullable: true
          description: Previous page URL
          example: null

    # Paginated Response Template
    PaginatedResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              required:
                - items
                - pagination
              properties:
                items:
                  type: array
                  description: Array of items for current page
                  items:
                    type: object
                pagination:
                  $ref: '#/components/schemas/PaginationMeta'

  # Common Parameters
  parameters:
    TenantHeader:
      name: X-Tenant-ID
      in: header
      required: true
      schema:
        type: string
        format: uuid
      description: Tenant UUID for multi-tenant isolation
      example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"

    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number for pagination
      example: 1

    PerPageParam:
      name: per_page
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 15
      description: Number of items per page
      example: 15

    SortParam:
      name: sort
      in: query
      required: false
      schema:
        type: string
        default: "created_at"
      description: Field to sort by
      example: "name"

    OrderParam:
      name: order
      in: query
      required: false
      schema:
        type: string
        enum: [asc, desc]
        default: desc
      description: Sort direction
      example: "asc"

    SearchParam:
      name: search
      in: query
      required: false
      schema:
        type: string
      description: Full-text search query
      example: "etching services"

    StatusParam:
      name: status
      in: query
      required: false
      schema:
        type: string
      description: Filter by status
      example: "active"

# Main API Paths (will be extended with specific modules)
paths:
  # ===== CONTENT MANAGEMENT ENDPOINTS =====
  
  # About Us Module - Complete implementation
  /api/v1/about/hero:
    $ref: './paths/content-management/about.yaml#/~1about~1hero'
  /api/v1/about/hero/{id}:
    $ref: './paths/content-management/about.yaml#/~1about~1hero~1{id}'
  /api/v1/about/company:
    $ref: './paths/content-management/about.yaml#/~1about~1company'
  /api/v1/about/company/{id}:
    $ref: './paths/content-management/about.yaml#/~1about~1company~1{id}'
  /api/v1/about/mission-vision:
    $ref: './paths/content-management/about.yaml#/~1about~1mission-vision'
  /api/v1/about/mission-vision/{id}:
    $ref: './paths/content-management/about.yaml#/~1about~1mission-vision~1{id}'
  /api/v1/about/team:
    $ref: './paths/content-management/about.yaml#/~1about~1team'
  /api/v1/about/team/{id}:
    $ref: './paths/content-management/about.yaml#/~1about~1team~1{id}'
  /api/v1/about/timeline:
    $ref: './paths/content-management/about.yaml#/~1about~1timeline'
  /api/v1/about/timeline/{id}:
    $ref: './paths/content-management/about.yaml#/~1about~1timeline~1{id}'
  /api/v1/about/certifications:
    $ref: './paths/content-management/about.yaml#/~1about~1certifications'
  /api/v1/about/certifications/{id}:
    $ref: './paths/content-management/about.yaml#/~1about~1certifications~1{id}'
  /api/v1/about/complete:
    $ref: './paths/content-management/about.yaml#/~1about~1complete'
  /api/v1/about/bulk:
    $ref: './paths/content-management/about.yaml#/~1about~1bulk'
  
  # ===== E-COMMERCE ENDPOINTS =====
  
  # Orders Module - Complete implementation
  /api/v1/orders:
    $ref: './paths/content-management/orders.yaml#/~1orders'
  /api/v1/orders/{order_code}/status:
    $ref: './paths/content-management/orders.yaml#/~1orders~1{order_code}~1status'
  /api/v1/admin/orders:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders'
  /api/v1/admin/orders/{id}:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}'
  /api/v1/admin/orders/{id}/assign-vendor:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1assign-vendor'
  /api/v1/admin/orders/{id}/status:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1status'
  /api/v1/admin/orders/{id}/quotations:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1quotations'
  /api/v1/admin/orders/{id}/quotations/{quotation_id}:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1quotations~1{quotation_id}'
  /api/v1/admin/orders/{id}/quotations/{quotation_id}/approve:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1quotations~1{quotation_id}~1approve'
  /api/v1/admin/orders/{id}/negotiations:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1negotiations'
  /api/v1/admin/orders/{id}/payments:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1payments'
  /api/v1/admin/orders/{id}/payments/{payment_id}/verify:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1payments~1{payment_id}~1verify'
  /api/v1/admin/orders/{id}/shipments:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1shipments'
  /api/v1/admin/orders/{id}/profitability:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1{id}~1profitability'
  /api/v1/admin/orders/analytics/dashboard:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1analytics~1dashboard'
  /api/v1/admin/orders/bulk/update-status:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1bulk~1update-status'
  /api/v1/admin/orders/export:
    $ref: './paths/content-management/orders.yaml#/~1admin~1orders~1export'
  
  # Products Module - Complete implementation
  /api/v1/products:
    $ref: './paths/content-management/products.yaml#/~1products'
  /api/v1/products/{slug}:
    $ref: './paths/content-management/products.yaml#/~1products~1{slug}'
  /api/v1/products/categories:
    $ref: './paths/content-management/products.yaml#/~1products~1categories'
  /api/v1/admin/products:
    $ref: './paths/content-management/products.yaml#/~1admin~1products'
  /api/v1/admin/products/{id}:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1{id}'
  /api/v1/admin/products/{id}/restore:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1{id}~1restore'
  /api/v1/admin/products/bulk:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1bulk'
  /api/v1/admin/products/categories:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1categories'
  /api/v1/admin/products/categories/{id}:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1categories~1{id}'
  /api/v1/admin/products/analytics/dashboard:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1analytics~1dashboard'
  /api/v1/admin/products/analytics/export:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1analytics~1export'
  /api/v1/admin/products/{id}/vendor-pricing:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1{id}~1vendor-pricing'
  /api/v1/admin/products/{id}/stock:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1{id}~1stock'
  /api/v1/admin/products/quotation-eligible:
    $ref: './paths/content-management/products.yaml#/~1admin~1products~1quotation-eligible'
  
  # Health Check Endpoint
  /health:
    get:
      tags:
        - System
      summary: API Health Check
      description: Check API server health and status
      security: []
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-11-12T13:00:00Z"
                  version:
                    type: string
                    example: "1.0.0"
                  database:
                    type: string
                    example: "connected"

  # Authentication Endpoints  
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User Login
      description: Authenticate user and receive JWT token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - tenant_id
              properties:
                email:
                  type: string
                  format: email
                  description: User email address
                  example: "admin@stencil.com"
                password:
                  type: string
                  format: password
                  description: User password
                  example: "password123"
                tenant_id:
                  type: string
                  format: uuid
                  description: Tenant UUID
                  example: "6ba7b810-9dad-11d1-80b4-00c04fd430c8"
                remember_me:
                  type: boolean
                  default: false
                  description: Extended token expiration
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          access_token:
                            type: string
                            description: JWT access token
                            example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
                          token_type:
                            type: string
                            example: "Bearer"
                          expires_in:
                            type: integer
                            description: Token expiration in seconds
                            example: 3600
                          user:
                            type: object
                            properties:
                              id:
                                type: string
                                format: uuid
                              name:
                                type: string
                              email:
                                type: string
                                format: email
                              roles:
                                type: array
                                items:
                                  type: string
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication  
      summary: User Logout
      description: Invalidate current JWT token
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

# Tags for API Organization
tags:
  - name: System
    description: System health and status endpoints
  - name: Authentication
    description: User authentication and session management
  - name: Content Management
    description: Homepage, About, Contact, FAQ, and SEO management
  - name: E-Commerce
    description: Products, Reviews, Orders, and Inventory management
  - name: User Management
    description: Users, Customers, Vendors, and Suppliers management
  - name: System Administration
    description: Financial, Settings, and Plugin management
  - name: Assets & Localization
    description: Media, Documentation, Theme, and Language management