openapi: 3.0.3
info:
  title: User Management Module API
  version: 1.0.0

paths:
  /api/v1/admin/users:
    get:
      tags:
        - User Management
      summary: Get all users (Admin)
      description: Retrieve paginated list of all users in current tenant
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../components/parameters/common.yaml#/PageQuery'
        - $ref: '../components/parameters/common.yaml#/PerPageQuery'
        - $ref: '../components/parameters/common.yaml#/SearchQuery'
        - $ref: '../components/parameters/common.yaml#/SortQuery'
        - name: role
          in: query
          schema:
            type: string
          description: Filter by role name
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, suspended]
          description: Filter by user status
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserAdmin'
                  meta:
                    $ref: '../components/schemas/common.yaml#/PaginationMeta'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

    post:
      tags:
        - User Management
      summary: Create new user (Admin)
      description: Create a new user with roles and permissions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserAdmin'
                  message:
                    type: string
                    example: User created successfully
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '422':
          $ref: '../components/responses/common.yaml#/ValidationError'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/users/{id}:
    get:
      tags:
        - User Management
      summary: Get user by ID (Admin)
      description: Retrieve detailed user information
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserDetail'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

    put:
      tags:
        - User Management
      summary: Update user (Admin)
      description: Update user information
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserAdmin'
                  message:
                    type: string
                    example: User updated successfully
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '422':
          $ref: '../components/responses/common.yaml#/ValidationError'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

    delete:
      tags:
        - User Management
      summary: Delete user (Admin)
      description: Soft delete a user
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/SuccessResponse'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/users/{id}/suspend:
    post:
      tags:
        - User Management
      summary: Suspend user (Admin)
      description: Suspend a user account
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: User suspended successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserAdmin'
                  message:
                    type: string
                    example: User suspended successfully
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/users/{id}/activate:
    post:
      tags:
        - User Management
      summary: Activate user (Admin)
      description: Activate a suspended user account
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User activated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserAdmin'
                  message:
                    type: string
                    example: User activated successfully
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/roles:
    get:
      tags:
        - Roles & Permissions
      summary: Get all roles (Admin)
      description: Retrieve all roles for current tenant
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

    post:
      tags:
        - Roles & Permissions
      summary: Create new role (Admin)
      description: Create a new role with permissions
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleRequest'
      responses:
        '201':
          description: Role created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Role'
                  message:
                    type: string
                    example: Role created successfully
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '422':
          $ref: '../components/responses/common.yaml#/ValidationError'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/roles/{id}:
    get:
      tags:
        - Roles & Permissions
      summary: Get role by ID (Admin)
      description: Retrieve role details with permissions
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Role retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/RoleDetail'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

    put:
      tags:
        - Roles & Permissions
      summary: Update role (Admin)
      description: Update role name and permissions
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleRequest'
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Role'
                  message:
                    type: string
                    example: Role updated successfully
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '422':
          $ref: '../components/responses/common.yaml#/ValidationError'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

    delete:
      tags:
        - Roles & Permissions
      summary: Delete role (Admin)
      description: Delete a role (must have no assigned users)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Role deleted successfully
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/SuccessResponse'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '422':
          description: Role has assigned users
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/permissions:
    get:
      tags:
        - Roles & Permissions
      summary: Get all permissions (Admin)
      description: Retrieve all available permissions grouped by module
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Permissions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PermissionGroup'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/customers:
    get:
      tags:
        - Customer Management
      summary: Get all customers (Admin)
      description: Retrieve paginated list of customers (users with customer role)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../components/parameters/common.yaml#/PageQuery'
        - $ref: '../components/parameters/common.yaml#/PerPageQuery'
        - $ref: '../components/parameters/common.yaml#/SearchQuery'
        - $ref: '../components/parameters/common.yaml#/SortQuery'
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
          description: Filter by customer status
      responses:
        '200':
          description: Customers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Customer'
                  meta:
                    $ref: '../components/schemas/common.yaml#/PaginationMeta'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

  /api/v1/admin/customers/{id}:
    get:
      tags:
        - Customer Management
      summary: Get customer by ID (Admin)
      description: Retrieve detailed customer information with order history
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Customer retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/CustomerDetail'
        '401':
          $ref: '../components/responses/common.yaml#/Unauthorized'
        '403':
          $ref: '../components/responses/common.yaml#/Forbidden'
        '404':
          $ref: '../components/responses/common.yaml#/NotFound'
        '500':
          $ref: '../components/responses/common.yaml#/ServerError'

components:
  schemas:
    UserAdmin:
      type: object
      properties:
        id:
          $ref: '../components/schemas/common.yaml#/UUID'
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john.doe@example.com
        avatar:
          type: string
          format: uri
          nullable: true
        phone:
          type: string
          nullable: true
          example: "+62812345678"
        status:
          type: string
          enum: [active, inactive, suspended]
          example: active
        roles:
          type: array
          items:
            type: object
            properties:
              id:
                $ref: '../components/schemas/common.yaml#/UUID'
              name:
                type: string
                example: admin
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserDetail:
      allOf:
        - $ref: '#/components/schemas/UserAdmin'
        - type: object
          properties:
            permissions:
              type: array
              items:
                type: string
                example: products.create
            activityLog:
              type: array
              items:
                type: object
                properties:
                  action:
                    type: string
                    example: login
                  ipAddress:
                    type: string
                    example: 192.168.1.1
                  userAgent:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

    UserCreateRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 255
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        phone:
          type: string
          nullable: true
        avatar:
          type: string
          format: uri
          nullable: true
        roleIds:
          type: array
          items:
            type: string
            format: uuid
        status:
          type: string
          enum: [active, inactive]
          default: active

    UserUpdateRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 255
        email:
          type: string
          format: email
        phone:
          type: string
          nullable: true
        avatar:
          type: string
          format: uri
          nullable: true
        roleIds:
          type: array
          items:
            type: string
            format: uuid
        status:
          type: string
          enum: [active, inactive]

    Role:
      type: object
      properties:
        id:
          $ref: '../components/schemas/common.yaml#/UUID'
        name:
          type: string
          example: product-manager
        displayName:
          type: string
          example: Product Manager
        description:
          type: string
          nullable: true
          example: Can manage products and categories
        usersCount:
          type: integer
          example: 5
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    RoleDetail:
      allOf:
        - $ref: '#/components/schemas/Role'
        - type: object
          properties:
            permissions:
              type: array
              items:
                type: object
                properties:
                  id:
                    $ref: '../components/schemas/common.yaml#/UUID'
                  name:
                    type: string
                    example: products.create
                  displayName:
                    type: string
                    example: Create Products

    RoleRequest:
      type: object
      required:
        - name
        - displayName
      properties:
        name:
          type: string
          pattern: '^[a-z0-9-]+$'
          example: product-manager
        displayName:
          type: string
          minLength: 2
          maxLength: 100
        description:
          type: string
          nullable: true
        permissionIds:
          type: array
          items:
            type: string
            format: uuid

    PermissionGroup:
      type: object
      properties:
        module:
          type: string
          example: Products
        permissions:
          type: array
          items:
            type: object
            properties:
              id:
                $ref: '../components/schemas/common.yaml#/UUID'
              name:
                type: string
                example: products.create
              displayName:
                type: string
                example: Create Products
              description:
                type: string
                nullable: true

    Customer:
      type: object
      properties:
        id:
          $ref: '../components/schemas/common.yaml#/UUID'
        name:
          type: string
          example: Jane Smith
        email:
          type: string
          format: email
        phone:
          type: string
          nullable: true
        avatar:
          type: string
          format: uri
          nullable: true
        status:
          type: string
          enum: [active, inactive]
        totalOrders:
          type: integer
          example: 15
        totalSpent:
          type: number
          format: float
          example: 5750000
        registeredAt:
          type: string
          format: date-time
        lastOrderAt:
          type: string
          format: date-time
          nullable: true

    CustomerDetail:
      allOf:
        - $ref: '#/components/schemas/Customer'
        - type: object
          properties:
            addresses:
              type: array
              items:
                type: object
                properties:
                  id:
                    $ref: '../components/schemas/common.yaml#/UUID'
                  label:
                    type: string
                    example: Home
                  recipientName:
                    type: string
                  phone:
                    type: string
                  address:
                    type: string
                  city:
                    type: string
                  province:
                    type: string
                  postalCode:
                    type: string
                  isDefault:
                    type: boolean
            recentOrders:
              type: array
              items:
                type: object
                properties:
                  id:
                    $ref: '../components/schemas/common.yaml#/UUID'
                  orderNumber:
                    type: string
                  total:
                    type: number
                    format: float
                  status:
                    type: string
                  createdAt:
                    type: string
                    format: date-time
