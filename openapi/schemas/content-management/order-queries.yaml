# Order Query Response Views for Phase 4C
# Read-optimized view schemas for CQRS queries

# Order Details View
OrderDetailsView:
  allOf:
    - $ref: '../common/base.yaml#/BaseEntity'
    - $ref: '../common/base.yaml#/AuditableEntity'
    - type: object
      properties:
        order_code:
          type: string
        customer:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            email:
              type: string
            phone:
              type: string
            company:
              type: string
        vendor:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            specializations:
              type: array
              items:
                type: string
        items:
          type: array
          items:
            type: object
        status:
          type: string
        payment_status:
          type: string
        production_status:
          type: string
        total_amount:
          type: number
          format: double
        payment_received:
          type: number
          format: double
        remaining_payment:
          type: number
          format: double
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

# Order List View (Simplified)
OrderListView:
  type: object
  properties:
    id:
      type: integer
    order_code:
      type: string
    customer_name:
      type: string
    vendor_name:
      type: string
    status:
      type: string
    total_amount:
      type: number
      format: double
    payment_status:
      type: string
    created_at:
      type: string
      format: date-time

# Production Status View
ProductionStatusView:
  type: object
  properties:
    total_in_production:
      type: integer
    by_status:
      type: object
      additionalProperties:
        type: integer
    by_vendor:
      type: object
      additionalProperties:
        type: object
        properties:
          count:
            type: integer
          average_days:
            type: number
    delayed_orders:
      type: integer
    average_production_time_days:
      type: number
    orders_at_risk:
      type: array
      items:
        type: object
        properties:
          order_id:
            type: integer
          order_code:
            type: string
          days_overdue:
            type: integer

# Payment Status View
PaymentStatusView:
  type: object
  properties:
    total_orders:
      type: integer
    payment_breakdown:
      type: object
      properties:
        unpaid:
          type: object
          properties:
            count:
              type: integer
            amount:
              type: number
              format: double
        partial:
          type: object
          properties:
            count:
              type: integer
            amount:
              type: number
              format: double
        verified:
          type: object
          properties:
            count:
              type: integer
            amount:
              type: number
              format: double
    total_collected:
      type: number
      format: double
    total_pending:
      type: number
      format: double
    total_outstanding:
      type: number
      format: double
    overdue_payments:
      type: array
      items:
        type: object

# Vendor Negotiation View
VendorNegotiationView:
  type: object
  properties:
    negotiation_id:
      type: integer
    order_id:
      type: integer
    order_code:
      type: string
    vendor_id:
      type: integer
    vendor_name:
      type: string
    status:
      type: string
      enum: [pending, negotiating, accepted, rejected]
    rounds:
      type: integer
    vendor_price:
      type: number
      format: double
    customer_price:
      type: number
      format: double
    markup_percentage:
      type: number
      format: double
    created_at:
      type: string
      format: date-time
    deadline:
      type: string
      format: date

# Customer Quote View
CustomerQuoteView:
  type: object
  properties:
    quote_id:
      type: integer
    order_id:
      type: integer
    order_code:
      type: string
    customer_id:
      type: integer
    customer_name:
      type: string
    quote_amount:
      type: number
      format: double
    status:
      type: string
      enum: [pending, approved, rejected, expired]
    quote_date:
      type: string
      format: date
    approval_date:
      type: string
      format: date
    valid_until:
      type: string
      format: date

# Order Analytics View
OrderAnalyticsView:
  type: object
  properties:
    period:
      type: object
      properties:
        from:
          type: string
          format: date
        to:
          type: string
          format: date
    summary:
      type: object
      properties:
        total_orders:
          type: integer
        total_revenue:
          type: number
          format: double
        average_order_value:
          type: number
          format: double
        completion_rate:
          type: number
          format: double
          multipleOf: 0.01
    by_status:
      type: object
      additionalProperties:
        type: integer
    by_vendor:
      type: object
      additionalProperties:
        type: object
        properties:
          count:
            type: integer
          total_revenue:
            type: number
    by_customer:
      type: object
      additionalProperties:
        type: object
        properties:
          count:
            type: integer
          total_spent:
            type: number
    time_series:
      type: array
      items:
        type: object
        properties:
          date:
            type: string
            format: date
          orders:
            type: integer
          revenue:
            type: number

# Order Event (History) View
OrderEventView:
  type: object
  properties:
    event_id:
      type: string
      format: uuid
    event_type:
      type: string
      description: Type of event that occurred
    order_id:
      type: integer
    timestamp:
      type: string
      format: date-time
    user:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        role:
          type: string
    description:
      type: string
    changes:
      type: object
      additionalProperties: true
      description: Data changes in this event
    related_entity:
      type: object
      properties:
        type:
          type: string
        id:
          type: integer

# Pagination Metadata
PaginationMeta:
  type: object
  properties:
    total:
      type: integer
    count:
      type: integer
    per_page:
      type: integer
    current_page:
      type: integer
    last_page:
      type: integer
    from:
      type: integer
    to:
      type: integer
