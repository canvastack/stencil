# Plugin Marketplace System API Path Items
# This file contains only path items (no openapi/info/paths wrapper)

# ================================================================
# PLUGIN REGISTRY ENDPOINTS
# ================================================================
/plugins:
  get:
    tags:
      - Plugin Registry
    summary: List All Plugins
    description: |
      Retrieve paginated list of plugins with advanced filtering and search capabilities.
      
      **Admin Features:**
      - Search by name, description, author
      - Filter by type, status, execution model
      - Sort by popularity, rating, date
      - Export functionality
      - Multi-tenant plugin registry
    operationId: listPlugins
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - $ref: '../../components/parameters.yaml#/SortParam'
      - name: search
        in: query
        description: Search in plugin name, description, author
        schema:
          type: string
          maxLength: 255
        example: "stripe payment"
      - name: plugin_type
        in: query
        description: Filter by plugin type
        schema:
          type: string
          enum: [payment, shipping, analytics, crm, theme, widget, integration, utility, marketing, security]
        example: "payment"
      - name: execution_model
        in: query
        description: Filter by execution model
        schema:
          type: string
          enum: [frontend, backend, hybrid]
        example: "backend"
      - name: status
        in: query
        description: Filter by plugin status
        schema:
          type: string
          enum: [draft, under_review, approved, published, deprecated, banned]
        example: "published"
      - name: is_premium
        in: query
        description: Filter by premium status
        schema:
          type: boolean
        example: false
      - name: is_featured
        in: query
        description: Filter by featured status
        schema:
          type: boolean
        example: true
      - name: author
        in: query
        description: Filter by author name
        schema:
          type: string
        example: "PT Custom Etching Xenial"
      - name: min_version
        in: query
        description: Filter plugins compatible with minimum version
        schema:
          type: string
        example: "2.0.0"
    responses:
      '200':
        description: Plugins retrieved successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginListResponse'
            example:
              success: true
              data:
                - id: "550e8400-e29b-41d4-a716-446655440000"
                  name: "Stripe Payment Gateway"
                  slug: "stripe-payment-gateway"
                  version: "1.2.3"
                  plugin_type: "payment"
                  execution_model: "backend"
                  status: "published"
                  is_premium: true
                  price: 49.99
                  rating_average: 4.7
                  install_count: 450
              meta:
                page: 1
                limit: 20
                total: 125
                total_by_type:
                  payment: 15
                  shipping: 8
                  analytics: 12
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Plugin Registry
    summary: Create New Plugin
    description: |
      Create a new plugin entry in the registry.
      
      **Features:**
      - Plugin metadata registration
      - Version management setup
      - Automatic slug generation
      - Author verification
      - Dependency validation
    operationId: createPlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/PluginCreateInput'
          examples:
            payment_plugin:
              summary: Payment gateway plugin
              value:
                name: "Stripe Payment Gateway"
                slug: "stripe-payment-gateway"
                description: "Accept credit card payments via Stripe API"
                short_description: "Secure credit card payments with Stripe"
                author: "PT Custom Etching Xenial"
                author_email: "developer@ptcex.com"
                plugin_type: "payment"
                execution_model: "backend"
                version: "1.0.0"
                min_stencil_version: "2.0.0"
                dependencies: ["payment-core"]
                tags: ["payment", "stripe", "credit-card"]
    responses:
      '201':
        description: Plugin created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/Plugin'
                    message:
                      type: string
                      example: "Plugin created successfully. Submit for review to publish."
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '409':
        description: Plugin slug already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PLUGIN_SLUG_EXISTS"
                message: "Plugin with this slug already exists"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/{id}:
  get:
    tags:
      - Plugin Registry
    summary: Get Plugin Details
    description: |
      Retrieve detailed information about a specific plugin.
      
      **Features:**
      - Complete plugin metadata
      - Version history
      - Dependency information
      - Statistics and ratings
      - Installation requirements
    operationId: getPlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin ID or slug
        schema:
          type: string
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: include
        in: query
        description: Additional data to include
        schema:
          type: array
          items:
            type: string
            enum: [installations, settings, hooks, analytics, files]
        example: ["installations", "analytics"]
    responses:
      '200':
        description: Plugin details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/Plugin'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Plugin Registry
    summary: Update Plugin
    description: |
      Update plugin information and metadata.
      
      **Features:**
      - Version updates
      - Metadata modifications
      - Status changes
      - Changelog management
    operationId: updatePlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/PluginUpdateInput'
    responses:
      '200':
        description: Plugin updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/Plugin'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Plugin Registry
    summary: Delete Plugin
    description: |
      Delete a plugin from the registry.
      
      **Features:**
      - Dependency check before deletion
      - Installation cleanup
      - File cleanup
      - Audit trail
    operationId: deletePlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: force
        in: query
        description: Force delete despite active installations
        schema:
          type: boolean
          default: false
        example: false
    responses:
      '200':
        description: Plugin deleted successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    message:
                      type: string
                      example: "Plugin deleted successfully"
      '400':
        description: Cannot delete plugin with active installations
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PLUGIN_HAS_INSTALLATIONS"
                message: "Cannot delete plugin with active installations"
                details:
                  active_installations: 15
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN INSTALLATION ENDPOINTS
# ================================================================
/plugins/installations:
  get:
    tags:
      - Plugin Installation
    summary: List Plugin Installations
    description: |
      Retrieve paginated list of plugin installations for the current tenant.
      
      **Features:**
      - Tenant-scoped installations
      - Status filtering
      - Health monitoring
      - Performance metrics
    operationId: listPluginInstallations
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - $ref: '../../components/parameters.yaml#/SortParam'
      - name: status
        in: query
        description: Filter by installation status
        schema:
          type: string
          enum: [installed, activated, deactivated, updating, error, uninstalled]
        example: "activated"
      - name: health_status
        in: query
        description: Filter by health status
        schema:
          type: string
          enum: [healthy, warning, error, unknown]
        example: "healthy"
      - name: plugin_type
        in: query
        description: Filter by plugin type
        schema:
          type: string
          enum: [payment, shipping, analytics, crm, theme, widget, integration, utility, marketing, security]
        example: "payment"
    responses:
      '200':
        description: Plugin installations retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PluginInstallation'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Plugin Installation
    summary: Install Plugin
    description: |
      Install a plugin for the current tenant.
      
      **Features:**
      - License validation
      - Dependency checking
      - Version compatibility
      - Automatic configuration
    operationId: installPlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/PluginInstallationInput'
          examples:
            premium_plugin:
              summary: Install premium plugin with license
              value:
                plugin_id: "550e8400-e29b-41d4-a716-446655440000"
                license_key: "PTCEX-STRIPE-PRO-12345"
                auto_update: true
                installation_notes: "Production environment setup"
    responses:
      '201':
        description: Plugin installed successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginInstallationResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '402':
        description: Payment required for premium plugin
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PAYMENT_REQUIRED"
                message: "This is a premium plugin. Please purchase a license."
      '409':
        description: Plugin already installed
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PLUGIN_ALREADY_INSTALLED"
                message: "Plugin is already installed for this tenant"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/installations/{id}:
  get:
    tags:
      - Plugin Installation
    summary: Get Plugin Installation Details
    description: |
      Retrieve detailed information about a specific plugin installation.
      
      **Features:**
      - Installation status
      - Performance metrics
      - Error logs
      - Configuration settings
    operationId: getPluginInstallation
    security:
    
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: include
        in: query
        description: Additional data to include
        schema:
          type: array
          items:
            type: string
            enum: [plugin, settings, hooks, events, analytics]
        example: ["plugin", "settings"]
    responses:
      '200':
        description: Plugin installation details retrieved successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginInstallationResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  patch:
    tags:
      - Plugin Installation
    summary: Update Plugin Installation
    description: |
      Update plugin installation configuration and status.
      
      **Features:**
      - Enable/disable plugin
      - Toggle auto-update
      - Update installation notes
    operationId: updatePluginInstallation
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              is_enabled:
                type: boolean
                description: Enable or disable plugin
                example: true
              auto_update:
                type: boolean
                description: Enable automatic updates
                example: true
              installation_notes:
                type: string
                description: Installation notes
                example: "Updated configuration for production"
    responses:
      '200':
        description: Plugin installation updated successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginInstallationResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Plugin Installation
    summary: Uninstall Plugin
    description: |
      Uninstall a plugin from the current tenant.
      
      **Features:**
      - Clean removal of plugin data
      - Settings cleanup
      - Hook deregistration
      - File cleanup
    operationId: uninstallPlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: keep_data
        in: query
        description: Keep plugin data and settings
        schema:
          type: boolean
          default: false
        example: false
    responses:
      '200':
        description: Plugin uninstalled successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    message:
                      type: string
                      example: "Plugin uninstalled successfully"
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/installations/{id}/activate:
  post:
    tags:
      - Plugin Installation
    summary: Activate Plugin
    description: |
      Activate an installed plugin.
      
      **Features:**
      - Hook registration
      - Configuration validation
      - Health check
      - Event logging
    operationId: activatePlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Plugin activated successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginInstallationResponse'
      '400':
        description: Plugin cannot be activated (missing configuration, etc.)
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "ACTIVATION_FAILED"
                message: "Plugin missing required configuration"
                details:
                  missing_settings: ["stripe_api_key", "webhook_secret"]
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/installations/{id}/deactivate:
  post:
    tags:
      - Plugin Installation
    summary: Deactivate Plugin
    description: |
      Deactivate an active plugin.
      
      **Features:**
      - Hook deregistration
      - Graceful shutdown
      - Event logging
      - State preservation
    operationId: deactivatePlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Plugin deactivated successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginInstallationResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN SETTINGS ENDPOINTS
# ================================================================
/plugins/installations/{id}/settings:
  get:
    tags:
      - Plugin Settings
    summary: Get Plugin Settings
    description: |
      Retrieve all settings for a plugin installation.
      
      **Features:**
      - Tenant-scoped settings
      - Environment filtering
      - Sensitive data masking
      - Category grouping
    operationId: getPluginSettings
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: category
        in: query
        description: Filter by setting category
        schema:
          type: string
        example: "authentication"
      - name: environment
        in: query
        description: Filter by environment
        schema:
          type: string
          enum: [all, development, staging, production]
        example: "production"
    responses:
      '200':
        description: Plugin settings retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PluginSetting'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Plugin Settings
    summary: Create Plugin Setting
    description: |
      Create a new setting for a plugin installation.
      
      **Features:**
      - Value encryption for sensitive data
      - Validation rules enforcement
      - Environment scoping
      - Type-safe storage
    operationId: createPluginSetting
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/PluginSettingInput'
          examples:
            api_key_setting:
              summary: Encrypted API key setting
              value:
                key: "stripe_api_key"
                value: "sk_live_1234567890abcdef"
                category: "authentication"
                description: "Stripe secret API key for production"
                is_required: true
                is_encrypted: true
                environment: "production"
    responses:
      '201':
        description: Plugin setting created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/PluginSetting'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '409':
        description: Setting key already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "SETTING_KEY_EXISTS"
                message: "Setting with this key already exists"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/installations/{installationId}/settings/{settingId}:
  get:
    tags:
      - Plugin Settings
    summary: Get Plugin Setting
    description: |
      Retrieve a specific plugin setting.
      
      **Features:**
      - Individual setting retrieval
      - Sensitive data masking
      - Validation info
    operationId: getPluginSetting
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: installationId
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: settingId
        in: path
        required: true
        description: Plugin setting ID
        schema:
          type: string
          format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
    responses:
      '200':
        description: Plugin setting retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/PluginSetting'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Plugin Settings
    summary: Update Plugin Setting
    description: |
      Update a plugin setting value and configuration.
      
      **Features:**
      - Value updates with validation
      - Encryption handling
      - Change auditing
      - Plugin restart trigger
    operationId: updatePluginSetting
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: installationId
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: settingId
        in: path
        required: true
        description: Plugin setting ID
        schema:
          type: string
          format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              value:
                oneOf:
                  - type: string
                  - type: number
                  - type: boolean
                  - type: object
                description: New setting value
                example: "sk_live_new_api_key"
              description:
                type: string
                description: Setting description
              is_required:
                type: boolean
                description: Whether setting is required
              is_encrypted:
                type: boolean
                description: Whether to encrypt value
    responses:
      '200':
        description: Plugin setting updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/PluginSetting'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Plugin Settings
    summary: Delete Plugin Setting
    description: |
      Delete a plugin setting.
      
      **Features:**
      - Safe removal with validation
      - Required setting protection
      - Change auditing
    operationId: deletePluginSetting
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: installationId
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: settingId
        in: path
        required: true
        description: Plugin setting ID
        schema:
          type: string
          format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
    responses:
      '200':
        description: Plugin setting deleted successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    message:
                      type: string
                      example: "Plugin setting deleted successfully"
      '400':
        description: Cannot delete required setting
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "REQUIRED_SETTING"
                message: "Cannot delete required plugin setting"
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN HOOK SYSTEM ENDPOINTS
# ================================================================
/plugins/hooks:
  get:
    tags:
      - Plugin Hooks
    summary: List Plugin Hooks
    description: |
      Retrieve list of registered plugin hooks for the current tenant.
      
      **Features:**
      - Hook registry overview
      - Performance monitoring
      - Priority ordering
      - Type filtering
    operationId: listPluginHooks
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - name: hook_name
        in: query
        description: Filter by hook name
        schema:
          type: string
        example: "order.created"
      - name: hook_type
        in: query
        description: Filter by hook type
        schema:
          type: string
          enum: [action, filter]
        example: "action"
      - name: plugin_id
        in: query
        description: Filter by plugin ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: is_active
        in: query
        description: Filter by active status
        schema:
          type: boolean
        example: true
    responses:
      '200':
        description: Plugin hooks retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PluginHook'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/installations/{id}/hooks:
  get:
    tags:
      - Plugin Hooks
    summary: Get Plugin Installation Hooks
    description: |
      Retrieve all hooks registered by a specific plugin installation.
      
      **Features:**
      - Plugin-specific hooks
      - Performance metrics
      - Error tracking
    operationId: getPluginInstallationHooks
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Plugin installation hooks retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PluginHook'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Plugin Hooks
    summary: Register Plugin Hook
    description: |
      Register a new hook for a plugin installation.
      
      **Features:**
      - Hook registration
      - Priority management
      - Parameter validation
      - Condition setup
    operationId: registerPluginHook
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - hook_name
              - hook_type
              - callback_function
            properties:
              hook_name:
                type: string
                maxLength: 255
                description: Hook name
                example: "order.created"
              hook_type:
                type: string
                enum: [action, filter]
                description: Hook type
                example: "action"
              callback_function:
                type: string
                maxLength: 255
                description: Callback function name
                example: "handleOrderCreated"
              priority:
                type: integer
                minimum: 1
                maximum: 100
                default: 10
                description: Execution priority
                example: 10
              parameters:
                type: object
                description: Hook parameters schema
              conditions:
                type: object
                description: Hook execution conditions
    responses:
      '201':
        description: Plugin hook registered successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/PluginHook'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# MARKETPLACE ENDPOINTS
# ================================================================
/marketplace/plugins:
  get:
    tags:
      - Plugin Marketplace
    summary: Browse Marketplace Plugins
    description: |
      Browse available plugins in the marketplace.
      
      **Features:**
      - Public plugin catalog
      - Search and filtering
      - Rating and popularity sort
      - Category navigation
      - Featured plugins
    operationId: browseMarketplacePlugins
    security: []
    parameters:
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - $ref: '../../components/parameters.yaml#/SortParam'
      - name: search
        in: query
        description: Search in plugin name, description
        schema:
          type: string
          maxLength: 255
        example: "payment gateway"
      - name: category
        in: query
        description: Filter by plugin category
        schema:
          type: string
          enum: [payment, shipping, analytics, crm, theme, widget, integration, utility, marketing, security]
        example: "payment"
      - name: pricing_model
        in: query
        description: Filter by pricing model
        schema:
          type: string
          enum: [free, one_time, subscription, freemium]
        example: "free"
      - name: min_rating
        in: query
        description: Minimum rating filter
        schema:
          type: number
          format: float
          minimum: 0
          maximum: 5
        example: 4.0
      - name: featured
        in: query
        description: Show only featured plugins
        schema:
          type: boolean
        example: true
    responses:
      '200':
        description: Marketplace plugins retrieved successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/MarketplaceListingResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/marketplace/plugins/{id}:
  get:
    tags:
      - Plugin Marketplace
    summary: Get Marketplace Plugin Details
    description: |
      Retrieve detailed information about a marketplace plugin.
      
      **Features:**
      - Complete plugin information
      - Pricing details
      - Screenshots and media
      - Reviews and ratings
      - Installation instructions
    operationId: getMarketplacePlugin
    security: []
    parameters:
      - name: id
        in: path
        required: true
        description: Plugin ID or slug
        schema:
          type: string
        example: "stripe-payment-gateway"
    responses:
      '200':
        description: Marketplace plugin details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      allOf:
                        - $ref: '../../components/schemas.yaml#/PluginMarketplaceListing'
                        - type: object
                          properties:
                            plugin:
                              $ref: '../../components/schemas.yaml#/Plugin'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN PURCHASE ENDPOINTS
# ================================================================
/marketplace/plugins/{id}/purchase:
  post:
    tags:
      - Plugin Marketplace
    summary: Purchase Plugin
    description: |
      Purchase a premium plugin from the marketplace.
      
      **Features:**
      - Payment processing
      - License generation
      - Automatic installation option
      - Transaction tracking
    operationId: purchasePlugin
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - payment_method
            properties:
              payment_method:
                type: string
                enum: [stripe, paypal, bank_transfer, credits]
                description: Payment method to use
                example: "stripe"
              purchase_type:
                type: string
                enum: [one_time, subscription]
                default: "one_time"
                description: Purchase type
                example: "one_time"
              coupon_code:
                type: string
                maxLength: 50
                description: Discount coupon code
                example: "SAVE10"
              auto_install:
                type: boolean
                default: true
                description: Automatically install after purchase
                example: true
    responses:
      '201':
        description: Plugin purchased successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/PluginPurchase'
                    message:
                      type: string
                      example: "Plugin purchased successfully. License key sent to your email."
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '402':
        description: Payment failed
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PAYMENT_FAILED"
                message: "Payment could not be processed"
      '409':
        description: Plugin already purchased
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "ALREADY_PURCHASED"
                message: "Plugin is already purchased for this tenant"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/purchases:
  get:
    tags:
      - Plugin Marketplace
    summary: List Plugin Purchases
    description: |
      Retrieve list of plugin purchases for the current tenant.
      
      **Features:**
      - Purchase history
      - License information
      - Transaction details
      - Status tracking
    operationId: listPluginPurchases
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - name: status
        in: query
        description: Filter by purchase status
        schema:
          type: string
          enum: [pending, completed, failed, refunded, cancelled]
        example: "completed"
      - name: purchase_type
        in: query
        description: Filter by purchase type
        schema:
          type: string
          enum: [one_time, subscription, trial, upgrade, renewal]
        example: "one_time"
    responses:
      '200':
        description: Plugin purchases retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PluginPurchase'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN ANALYTICS ENDPOINTS
# ================================================================
/plugins/installations/{id}/analytics:
  get:
    tags:
      - Plugin Analytics
    summary: Get Plugin Analytics
    description: |
      Retrieve analytics data for a plugin installation.
      
      **Features:**
      - Usage statistics
      - Performance metrics
      - Error tracking
      - Event analytics
    operationId: getPluginAnalytics
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: start_date
        in: query
        description: Analytics start date
        schema:
          type: string
          format: date
        example: "2025-11-01"
      - name: end_date
        in: query
        description: Analytics end date
        schema:
          type: string
          format: date
        example: "2025-11-12"
      - name: event_type
        in: query
        description: Filter by event type
        schema:
          type: string
          enum: [activation, usage, error, hook_execution, api_call, performance]
        example: "usage"
    responses:
      '200':
        description: Plugin analytics retrieved successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginAnalyticsResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN HEALTH & MONITORING ENDPOINTS
# ================================================================
/plugins/health:
  get:
    tags:
      - Plugin Monitoring
    summary: Plugin Health Check
    description: |
      Perform health check on all installed plugins for the current tenant.
      
      **Features:**
      - Overall system health
      - Individual plugin status
      - Performance monitoring
      - Error detection
    operationId: checkPluginsHealth
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    responses:
      '200':
        description: Plugin health check completed
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/PluginHealthResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/installations/{id}/health:
  get:
    tags:
      - Plugin Monitoring
    summary: Individual Plugin Health Check
    description: |
      Perform health check on a specific plugin installation.
      
      **Features:**
      - Detailed health status
      - Configuration validation
      - Performance metrics
      - Error diagnostics
    operationId: checkPluginHealth
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Plugin health check completed
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        plugin_id:
                          type: string
                          format: uuid
                          example: "550e8400-e29b-41d4-a716-446655440000"
                        health_status:
                          type: string
                          enum: [healthy, warning, error]
                          example: "healthy"
                        last_check:
                          type: string
                          format: date-time
                          example: "2025-11-12T14:30:00Z"
                        issues:
                          type: array
                          items:
                            type: object
                            properties:
                              severity:
                                type: string
                                enum: [info, warning, error]
                              message:
                                type: string
                              details:
                                type: object
                          example: []
                        metrics:
                          type: object
                          properties:
                            cpu_usage:
                              type: number
                              format: float
                              example: 2.5
                            memory_usage:
                              type: number
                              format: float
                              example: 15.2
                            response_time:
                              type: number
                              format: float
                              example: 12.5
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# PLUGIN EVENTS & LOGS ENDPOINTS
# ================================================================
/plugins/installations/{id}/events:
  get:
    tags:
      - Plugin Monitoring
    summary: Get Plugin Events
    description: |
      Retrieve event logs for a plugin installation.
      
      **Features:**
      - Event log retrieval
      - Severity filtering
      - Time range filtering
      - Performance tracking
    operationId: getPluginEvents
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: id
        in: path
        required: true
        description: Plugin installation ID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - name: event_type
        in: query
        description: Filter by event type
        schema:
          type: string
          enum: [hook_executed, error_occurred, setting_changed, health_check, performance_warning]
        example: "hook_executed"
      - name: severity
        in: query
        description: Filter by event severity
        schema:
          type: string
          enum: [debug, info, warning, error, critical]
        example: "error"
      - name: start_date
        in: query
        description: Events from this date
        schema:
          type: string
          format: date-time
        example: "2025-11-01T00:00:00Z"
      - name: end_date
        in: query
        description: Events until this date
        schema:
          type: string
          format: date-time
        example: "2025-11-12T23:59:59Z"
    responses:
      '200':
        description: Plugin events retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PluginEvent'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# BULK OPERATIONS ENDPOINTS
# ================================================================
/plugins/bulk/activate:
  post:
    tags:
      - Plugin Bulk Operations
    summary: Bulk Activate Plugins
    description: |
      Activate multiple plugins at once.
      
      **Features:**
      - Multiple plugin activation
      - Dependency resolution
      - Error handling per plugin
      - Progress tracking
    operationId: bulkActivatePlugins
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - installation_ids
            properties:
              installation_ids:
                type: array
                items:
                  type: string
                  format: uuid
                minItems: 1
                maxItems: 50
                description: List of plugin installation IDs
                example: ["550e8400-e29b-41d4-a716-446655440000", "123e4567-e89b-12d3-a456-426614174000"]
    responses:
      '200':
        description: Bulk activation completed
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        successful:
                          type: array
                          items:
                            type: object
                            properties:
                              installation_id:
                                type: string
                                format: uuid
                              plugin_name:
                                type: string
                              status:
                                type: string
                                example: "activated"
                        failed:
                          type: array
                          items:
                            type: object
                            properties:
                              installation_id:
                                type: string
                                format: uuid
                              plugin_name:
                                type: string
                              error:
                                type: string
                        summary:
                          type: object
                          properties:
                            total:
                              type: integer
                              example: 2
                            successful:
                              type: integer
                              example: 1
                            failed:
                              type: integer
                              example: 1
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/plugins/bulk/deactivate:
  post:
    tags:
      - Plugin Bulk Operations
    summary: Bulk Deactivate Plugins
    description: |
      Deactivate multiple plugins at once.
      
      **Features:**
      - Multiple plugin deactivation
      - Graceful shutdown
      - Error handling per plugin
      - Progress tracking
    operationId: bulkDeactivatePlugins
    security:
      - bearerAuth: []
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - installation_ids
            properties:
              installation_ids:
                type: array
                items:
                  type: string
                  format: uuid
                minItems: 1
                maxItems: 50
                description: List of plugin installation IDs
                example: ["550e8400-e29b-41d4-a716-446655440000"]
    responses:
      '200':
        description: Bulk deactivation completed
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        successful:
                          type: array
                          items:
                            type: object
                            properties:
                              installation_id:
                                type: string
                                format: uuid
                              plugin_name:
                                type: string
                              status:
                                type: string
                                example: "deactivated"
                        failed:
                          type: array
                          items:
                            type: object
                            properties:
                              installation_id:
                                type: string
                                format: uuid
                              plugin_name:
                                type: string
                              error:
                                type: string
                        summary:
                          type: object
                          properties:
                            total:
                              type: integer
                            successful:
                              type: integer
                            failed:
                              type: integer
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
