# Media Library Management API Path Items
# This file contains only path items (no openapi/info/paths wrapper)
# 
# ARCHITECTURE: Platform/Tenant Separated Endpoints
# - Platform endpoints (/platform/media/*): For platform administrators managing tenant media
# - Tenant endpoints (/tenant/media/*): For tenant users managing their own media files
#
# This implements the separated endpoint architecture following authentication patterns:
# - Platform: Bearer token with platform-level permissions  
# - Tenant: Bearer token + X-Tenant-ID header with tenant-level permissions

# ================================================================
# PLATFORM MEDIA FILE ENDPOINTS (Platform Admin)
# ================================================================
/platform/media/upload:
  post:
    tags:
      - Platform Media Files
    summary: Platform - Upload Single Media File for Tenant
    description: |
      Platform admin upload a single media file for any tenant with metadata and optional folder assignment.
      
      **Platform Features:**
      - Cross-tenant media file management
      - Tenant-specific file upload capabilities
      - Advanced security and compliance controls
      - Multi-format support (image, document, video, design files)
      - Automatic file validation and virus scanning
      - Metadata extraction (EXIF for images)
      - Thumbnail generation for images
      - Cloud storage integration
      - Tag assignment during upload
    operationId: platformUploadMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - platform.media.upload
    parameters:
      - name: X-Target-Tenant-ID
        in: header
        required: true
        description: Target tenant ID for file upload
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFileCreateInput'
          examples:
            product_image:
              summary: Upload product image
              value:
                folder_id: "550e8400-e29b-41d4-a716-446655440000"
                alt_text: "Custom etched glass design"
                caption: "High-quality etching work"
                description: "Professional glass etching with company logo"
                tags: ["123e4567-e89b-12d3-a456-426614174000"]
                is_public: false
    responses:
      '201':
        description: File uploaded successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
                    message:
                      type: string
                      example: "File uploaded successfully"
            examples:
              created:
                summary: Single file uploaded
                value:
                  success: true
                  message: "File uploaded successfully"
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    filename: "product-image.jpg"
                    mime_type: "image/jpeg"
                    is_public: false
                    folder_id: "550e8400-e29b-41d4-a716-446655440000"
                    created_at: "2025-02-16T10:00:00Z"
      '400':
        description: Validation error or unsupported file
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            examples:
              file_too_large:
                summary: File size exceeds limit
                value:
                  success: false
                  error:
                    code: "FILE_TOO_LARGE"
                    message: "File size exceeds 10MB limit for images"
              invalid_format:
                summary: Unsupported file format
                value:
                  success: false
                  error:
                    code: "INVALID_FORMAT"
                    message: "File format not supported for this file type"
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        description: Insufficient permissions
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PERMISSION_DENIED"
                message: "media.upload permission required"
      '413':
        description: Request entity too large
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "PAYLOAD_TOO_LARGE"
                message: "File exceeds maximum upload size"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/upload/bulk:
  post:
    tags:
      - Platform Media Files
    summary: Platform - Upload Multiple Media Files for Tenant
    description: |
      Platform admin upload multiple media files for any tenant in a single request with batch processing.
      
      **Platform Features:**
      - Cross-tenant bulk file upload capabilities
      - Batch metadata assignment for tenant files
      - Folder organization across tenant boundaries
      - Advanced error handling per file with tenant context
      - Background processing for large tenant file batches
      - Tenant quota and compliance enforcement
    operationId: platformBulkUploadMediaFiles
    security:
      - bearerAuth: []
    x-permissions:
      - platform.media.upload
    parameters:
      - name: X-Target-Tenant-ID
        in: header
        required: true
        description: Target tenant ID for bulk file upload
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            required:
              - files
            properties:
              files:
                type: array
                items:
                  type: string
                  format: binary
                description: Array of files to upload
              folder_id:
                type: string
                format: uuid
                nullable: true
                description: Target folder for all files
                example: "550e8400-e29b-41d4-a716-446655440000"
              tags:
                type: array
                items:
                  type: string
                  format: uuid
                description: Tags to assign to all files
                example: ["123e4567-e89b-12d3-a456-426614174000"]
              is_public:
                type: boolean
                default: false
                description: Make all files publicly accessible
    responses:
      '201':
        description: Bulk upload completed (may include partial failures)
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        successful:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFile'
                        failed:
                          type: array
                          items:
                            type: object
                            properties:
                              filename:
                                type: string
                              error:
                                type: string
                        summary:
                          type: object
                          properties:
                            total:
                              type: integer
                              example: 10
                            successful:
                              type: integer
                              example: 8
                            failed:
                              type: integer
                              example: 2
            examples:
              created:
                summary: Bulk upload result
                value:
                  success: true
                  data:
                    successful:
                      - id: "111e8400-e29b-41d4-a716-446655440111"
                        filename: "img-1.jpg"
                      - id: "222e8400-e29b-41d4-a716-446655440222"
                        filename: "img-2.jpg"
                    failed:
                      - filename: "bad-file.exe"
                        error: "INVALID_FORMAT"
                    summary:
                      total: 3
                      successful: 2
                      failed: 1
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/files:
  get:
    tags:
      - Platform Media Files
    summary: Platform - List Media Files Across All Tenants
    description: |
      Platform admin retrieve paginated list of media files across all tenants with advanced filtering and search.
      
      **Platform Features:**
      - Cross-tenant file management and visibility
      - Tenant-based filtering and isolation
      - Advanced compliance and audit filtering
      - Global file type and metadata filtering
      - Tag-based search across tenant boundaries
      - Full-text search in metadata with tenant context
      - Sorting by various fields with tenant information
      - Include related data (folder, tags, transformations, tenant)
    operationId: platformListMediaFiles
    security:
      - bearerAuth: []
    x-permissions:
      - platform.media.list
    parameters:
      - name: tenant_id
        in: query
        description: Filter by specific tenant (optional for platform admin)
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - $ref: '../../components/parameters.yaml#/PageParam'
      - $ref: '../../components/parameters.yaml#/PerPageParam'
      - $ref: '../../components/parameters.yaml#/SortParam'
      - name: folder_id
        in: query
        description: Filter by folder (null for root)
        schema:
          type: string
          format: uuid
          nullable: true
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: file_type
        in: query
        description: Filter by file type
        schema:
          type: string
          enum: [image, document, video, audio, design, archive]
        example: "image"
      - name: mime_type
        in: query
        description: Filter by MIME type
        schema:
          type: string
        example: "image/jpeg"
      - name: tags
        in: query
        description: Filter by tag IDs (comma-separated)
        schema:
          type: string
        example: "123e4567-e89b-12d3-a456-426614174000,456e1234-e89b-12d3-a456-426614174000"
      - name: search
        in: query
        description: Search in filename, alt_text, caption, description
        schema:
          type: string
          maxLength: 255
        example: "logo design"
      - name: is_public
        in: query
        description: Filter by public access status
        schema:
          type: boolean
        example: false
      - name: uploaded_by
        in: query
        description: Filter by uploader user ID
        schema:
          type: string
          format: uuid
        example: "123e4567-e89b-12d3-a456-426614174000"
      - name: created_from
        in: query
        description: Filter files created after this date
        schema:
          type: string
          format: date
        example: "2024-01-01"
      - name: created_to
        in: query
        description: Filter files created before this date
        schema:
          type: string
          format: date
        example: "2024-12-31"
      - name: include
        in: query
        description: Include related data (comma-separated)
        schema:
          type: string
        example: "folder,tags,transformations"
    responses:
      '200':
        description: Media files retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/PaginatedResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
                    meta:
                      allOf:
                        - $ref: '../../components/schemas.yaml#/PaginationMeta'
                        - type: object
                          properties:
                            filters:
                              type: object
                              properties:
                                total_size:
                                  type: integer
                                  format: int64
                                  description: Total size of filtered files in bytes
                                  example: 10485760
                                file_types:
                                  type: object
                                  additionalProperties:
                                    type: integer
                                  description: Count by file type
                                  example:
                                    image: 15
                                    document: 8
                                    video: 2
            examples:
              ok:
                summary: Files list
                value:
                  success: true
                  data:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      filename: "logo.jpg"
                      mime_type: "image/jpeg"
                      folder_id: "550e8400-e29b-41d4-a716-446655440000"
                      is_public: false
                    - id: "123e4567-e89b-12d3-a456-426614174000"
                      filename: "manual.pdf"
                      mime_type: "application/pdf"
                      folder_id: null
                      is_public: true
                  meta:
                    page: 1
                    per_page: 10
                    total: 2
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '429':
        $ref: '../../components/responses.yaml#/RateLimitExceeded'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/files/{uuid}:
  get:
    tags:
      - Platform Media Files
    summary: Platform - Get Media File Details Across Tenants
    description: |
      Platform admin retrieve detailed information about a specific media file from any tenant including all related data.
      
      **Platform Includes:**
      - File metadata and properties with tenant context
      - Folder information across tenant boundaries
      - Associated tags with tenant relationships
      - Available transformations with tenant scope
      - Usage tracking across tenant applications
      - Version history with tenant audit trails
      - Compliance and security metadata
    operationId: platformGetMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - platform.media.read
    parameters:
      - name: X-Target-Tenant-ID
        in: header
        required: false
        description: Target tenant ID (auto-detected from file if not provided)
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: include
        in: query
        description: Include related data (comma-separated)
        schema:
          type: string
        example: "folder,tags,transformations,usage,versions"
    responses:
      '200':
        description: Media file details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
            examples:
              ok:
                summary: File detail
                value:
                  success: true
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    filename: "logo.jpg"
                    mime_type: "image/jpeg"
                    is_public: true
                    folder:
                      id: null
                      name: "Root"
                    tags: []
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "MEDIA_FILE_NOT_FOUND"
                message: "Media file not found"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Media Files
    summary: Update Media File Metadata
    description: |
      Update media file metadata, organization, and properties.
      
      **Updatable Fields:**
      - File organization (folder assignment)
      - Content metadata (alt_text, caption, description)
      - Tag assignments
      - Access control (is_public)
      - Custom filename
    operationId: updateMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.update
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFileUpdateInput'
          examples:
            update_metadata:
              summary: Update file metadata
              value:
                alt_text: "Updated alternative text"
                caption: "Updated caption"
                description: "Updated detailed description"
                tags: ["123e4567-e89b-12d3-a456-426614174000"]
            move_and_rename:
              summary: Move file and update name
              value:
                folder_id: "456e1234-e89b-12d3-a456-426614174000"
                filename: "new_filename.jpg"
                is_public: true
    responses:
      '200':
        description: Media file updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
                    message:
                      type: string
                      example: "Media file updated successfully"
            examples:
              ok:
                summary: File updated
                value:
                  success: true
                  message: "Media file updated successfully"
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    filename: "new_filename.jpg"
                    is_public: true
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Media Files
    summary: Delete Media File
    description: |
      Delete a media file and all its associated data (transformations, usage records).
      
      **Safety Features:**
      - Usage validation (prevent deletion of files in use)
      - Force deletion option for admin users
      - Cleanup of all related transformations
      - Audit trail logging
    operationId: deleteMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.delete
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: force
        in: query
        description: Force deletion even if file is in use (requires admin permission)
        schema:
          type: boolean
          default: false
        example: false
    responses:
      '200':
        description: Media file deleted successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    message:
                      type: string
                      example: "Media file deleted successfully"
                    data:
                      type: object
                      properties:
                        cleaned_transformations:
                          type: integer
                          example: 3
                        cleaned_usage_records:
                          type: integer
                          example: 5
            examples:
              ok:
                summary: File deleted
                value:
                  success: true
                  message: "Media file deleted successfully"
                  data:
                    cleaned_transformations: 3
                    cleaned_usage_records: 5
      '400':
        description: File is in use and cannot be deleted
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "FILE_IN_USE"
                message: "Cannot delete file that is currently in use"
                details:
                  usage_count: 3
                  usage_contexts: ["product_image", "gallery_image"]
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/files/move:
  post:
    tags:
      - Platform Media Files
    summary: Platform - Move Multiple Files to Folder Across Tenants
    description: |
      Platform admin move multiple media files across tenant boundaries to different folders in bulk operation.
      
      **Platform Features:**
      - Cross-tenant bulk file movement capabilities
      - Tenant boundary and quota validation
      - Advanced permission checking across tenant folders
      - Atomic operation with full rollback (all or nothing)
      - Compliance and audit trail maintenance
    operationId: platformMoveMediaFiles
    security:
      - bearerAuth: []
    x-permissions:
      - platform.media.move
    parameters:
      - name: X-Target-Tenant-ID
        in: header
        required: true
        description: Target tenant ID for file movement operations
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - file_ids
              - folder_id
            properties:
              file_ids:
                type: array
                items:
                  type: string
                  format: uuid
                description: Array of file UUIDs to move
                example: ["550e8400-e29b-41d4-a716-446655440000", "123e4567-e89b-12d3-a456-426614174000"]
              folder_id:
                type: string
                format: uuid
                nullable: true
                description: Target folder UUID (null for root)
                example: "456e1234-e89b-12d3-a456-426614174000"
    responses:
      '200':
        description: Files moved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        moved_count:
                          type: integer
                          example: 5
                        failed_count:
                          type: integer
                          example: 0
                        failed_files:
                          type: array
                          items:
                            type: object
                            properties:
                              file_id:
                                type: string
                                format: uuid
                              error:
                                type: string
                    message:
                      type: string
                      example: "5 files moved successfully"
            examples:
              ok:
                summary: Move result
                value:
                  success: true
                  message: "5 files moved successfully"
                  data:
                    moved_count: 5
                    failed_count: 0
                    failed_files: []
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/files/{uuid}/download:
  post:
    tags:
      - Platform Media Files
    summary: Platform - Generate Secure Download URL Across Tenants
    description: |
      Generate a secure, time-limited download URL for the media file and track the download.
      
      **Features:**
      - Secure signed URLs with expiration
      - Download analytics tracking
      - Access control validation
      - CDN integration support
    operationId: downloadMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.download
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              transformation:
                type: string
                description: Specific transformation to download
                example: "thumbnail_300x300"
              expires_in:
                type: integer
                minimum: 300
                maximum: 3600
                default: 3600
                description: URL expiration time in seconds
                example: 1800
    responses:
      '200':
        description: Download URL generated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        download_url:
                          type: string
                          format: uri
                          description: Secure download URL
                          example: "https://cdn.example.com/secure/tenant123/file123.jpg?token=abc&expires=1699876543"
                        expires_at:
                          type: string
                          format: date-time
                          description: URL expiration timestamp
                          example: "2024-11-12T16:30:00Z"
                        file_size:
                          type: integer
                          format: int64
                          description: File size in bytes
                          example: 2048576
            examples:
              ok:
                summary: Download URL
                value:
                  success: true
                  data:
                    download_url: "https://cdn.example.com/secure/tenant123/file123.jpg?token=abc&expires=1699876543"
                    expires_at: "2025-02-16T12:30:00Z"
                    file_size: 2048576
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# MEDIA FOLDER ENDPOINTS
# ================================================================
/platform/media/folders:
  get:
    tags:
      - Platform Media Folders
    summary: Platform - List Media Folders Across All Tenants
    description: |
      Retrieve hierarchical list of media folders with optional tree structure.
      
      **Features:**
      - Tree structure with nested folders
      - Breadcrumb path information
      - File count per folder
      - Permission-based filtering
    operationId: listMediaFolders
    security:
      - bearerAuth: []
    x-permissions:
      - media.folder.list
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: parent_id
        in: query
        description: Filter by parent folder (null for root level)
        schema:
          type: string
          format: uuid
          nullable: true
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: tree
        in: query
        description: Return full tree structure
        schema:
          type: boolean
          default: false
        example: true
      - name: include_files
        in: query
        description: Include file counts per folder
        schema:
          type: boolean
          default: false
        example: true
    responses:
      '200':
        description: Media folders retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        allOf:
                          - $ref: '../../components/schemas.yaml#/MediaFolder'
                          - type: object
                            properties:
                              children:
                                type: array
                                items:
                                  $ref: '../../components/schemas.yaml#/MediaFolder'
                              file_count:
                                type: integer
                                example: 15
                              total_size:
                                type: integer
                                format: int64
                                example: 52428800
            examples:
              ok:
                summary: Folders list
                value:
                  success: true
                  data:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      name: "Product Images"
                      is_public: false
                      children: []
                      file_count: 15
                      total_size: 52428800
                    - id: "123e4567-e89b-12d3-a456-426614174000"
                      name: "Documents"
                      is_public: true
                      children: []
                      file_count: 3
                      total_size: 1048576
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '429':
        $ref: '../../components/responses.yaml#/RateLimitExceeded'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Media Folders
    summary: Create Media Folder
    description: |
      Create a new media folder with capacity and hierarchical organization.
    operationId: createMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.folder.create
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFolderCreateInput'
          examples:
            root_folder:
              summary: Create root-level folder
              value:
                name: "Product Images"
                description: "High-resolution product photography"
                is_public: false
            nested_folder:
              summary: Create nested folder
              value:
                parent_id: "550e8400-e29b-41d4-a716-446655440000"
                name: "Glass Etching"
                description: "Glass etching project files"
                sort_order: 1
    responses:
      '201':
        description: Media folder created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFolder'
                    message:
                      type: string
                      example: "Media folder created successfully"
            examples:
              created:
                summary: Folder created
                value:
                  success: true
                  message: "Media folder created successfully"
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Product Images"
                    is_public: false
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '409':
        description: Folder name already exists in parent
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "FOLDER_EXISTS"
                message: "Folder with this name already exists in parent directory"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/folders/{uuid}:
  get:
    tags:
      - Media Folders
    summary: Get Media Folder Details
    description: |
      Retrieve detailed information about a specific media folder.
      
      **Includes:**
      - Folder metadata and properties
      - Breadcrumb path
      - File and subfolder counts
      - Storage usage statistics
    operationId: getMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.folder.read
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Media folder details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      allOf:
                        - $ref: '../../components/schemas.yaml#/MediaFolder'
                        - type: object
                          properties:
                            breadcrumb:
                              type: array
                              items:
                                type: object
                                properties:
                                  uuid:
                                    type: string
                                    format: uuid
                                  name:
                                    type: string
                              example:
                                - uuid: "root"
                                  name: "Root"
                                - uuid: "550e8400-e29b-41d4-a716-446655440000"
                                  name: "Product Images"
                            statistics:
                              type: object
                              properties:
                                file_count:
                                  type: integer
                                  example: 25
                                subfolder_count:
                                  type: integer
                                  example: 3
                                total_size:
                                  type: integer
                                  format: int64
                                  example: 104857600
            examples:
              ok:
                summary: Folder detail
                value:
                  success: true
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Product Images"
                    breadcrumb:
                      - uuid: "root"
                        name: "Root"
                      - uuid: "550e8400-e29b-41d4-a716-446655440000"
                        name: "Product Images"
                    statistics:
                      file_count: 25
                      subfolder_count: 3
                      total_size: 104857600
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media folder not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Media Folders
    summary: Update Media Folder
    description: |
      Update media folder properties and organization.
      
      **Updatable Fields:**
      - Folder hierarchy (parent assignment)
      - Display properties (name, description)
      - Access control settings
      - Sort order
    operationId: updateMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.folder.update
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFolderUpdateInput'
          examples:
            rename_folder:
              summary: Rename folder
              value:
                name: "Updated Folder Name"
                description: "Updated description"
            move_folder:
              summary: Move folder to different parent
              value:
                parent_id: "456e1234-e89b-12d3-a456-426614174000"
                sort_order: 2
    responses:
      '200':
        description: Media folder updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFolder'
                    message:
                      type: string
                      example: "Media folder updated successfully"
            examples:
              ok:
                summary: Folder updated
                value:
                  success: true
                  message: "Media folder updated successfully"
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Updated Folder Name"
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media folder not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Media Folders
    summary: Delete Media Folder
    description: |
      Delete a media folder and optionally its contents.
      
      **Safety Features:**
      - Empty folder validation
      - Recursive deletion option
      - File usage validation
      - Audit trail logging
    operationId: deleteMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.folder.delete
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: recursive
        in: query
        description: Delete folder and all its contents
        schema:
          type: boolean
          default: false
        example: false
      - name: force
        in: query
        description: Force deletion even if files are in use (requires admin permission)
        schema:
          type: boolean
          default: false
        example: false
    responses:
      '200':
        description: Media folder deleted successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    message:
                      type: string
                      example: "Media folder deleted successfully"
                    data:
                      type: object
                      properties:
                        deleted_files:
                          type: integer
                          example: 0
                        deleted_subfolders:
                          type: integer
                          example: 0
            examples:
              ok:
                summary: Folder deleted
                value:
                  success: true
                  message: "Media folder deleted successfully"
                  data:
                    deleted_files: 0
                    deleted_subfolders: 0
      '400':
        description: Folder is not empty or contains files in use
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            examples:
              folder_not_empty:
                summary: Folder contains files
                value:
                  success: false
                  error:
                    code: "FOLDER_NOT_EMPTY"
                    message: "Cannot delete folder that contains files or subfolders"
                    details:
                      file_count: 5
                      subfolder_count: 2
              files_in_use:
                summary: Contains files in use
                value:
                  success: false
                  error:
                    code: "FILES_IN_USE"
                    message: "Cannot delete folder containing files that are currently in use"
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media folder not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/folders/{uuid}/contents:
  get:
    tags:
      - Media Folders
    summary: Get Folder Contents
    description: |
      Retrieve all files and subfolders within a specific folder.
      
      **Features:**
      - Combined file and folder listing
      - Filtering by file types
      - Optional recursive traversal
      - Sorting and pagination
    operationId: getFolderContents
    security:
      - bearerAuth: []
    x-permissions:
      - media.folder.read
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
      - name: include_subfolders
        in: query
        description: Include files from subfolders recursively
        schema:
          type: boolean
          default: false
        example: false
      - name: file_types
        in: query
        description: Filter by file types (comma-separated)
        schema:
          type: string
        example: "image,document"
      - name: sort
        in: query
        description: Sort order
        schema:
          type: string
          enum: [name, created_at, file_size, file_type]
          default: name
        example: "created_at"
      - name: order
        in: query
        description: Sort direction
        schema:
          type: string
          enum: [asc, desc]
          default: asc
        example: "desc"
    responses:
      '200':
        description: Folder contents retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        folders:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFolder'
                        files:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFile'
                        summary:
                          type: object
                          properties:
                            total_folders:
                              type: integer
                              example: 3
                            total_files:
                              type: integer
                              example: 15
                            total_size:
                              type: integer
                              format: int64
                              example: 52428800
            examples:
              ok:
                summary: Folder contents
                value:
                  success: true
                  data:
                    folders:
                      - id: "111e8400-e29b-41d4-a716-446655441111"
                        name: "Logos"
                    files:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        filename: "logo.jpg"
                        mime_type: "image/jpeg"
                    summary:
                      total_folders: 1
                      total_files: 1
                      total_size: 1048576
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media folder not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '429':
        $ref: '../../components/responses.yaml#/RateLimitExceeded'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# MEDIA TAG ENDPOINTS
# ================================================================
/platform/media/tags:
  get:
    tags:
      - Platform Media Tags
    summary: Platform - List Media Tags Across All Tenants
    description: |
      Retrieve list of media tags with usage statistics and filtering options.
      
      **Features:**
      - Category-based filtering
      - Search by tag name
      - Usage count sorting
      - Color-coded organization
    operationId: listMediaTags
    security:
      - bearerAuth: []
    x-permissions:
      - media.tag.list
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: category
        in: query
        description: Filter by tag category
        schema:
          type: string
          maxLength: 50
        example: "materials"
      - name: search
        in: query
        description: Search in tag name and description
        schema:
          type: string
          maxLength: 255
        example: "glass"
      - name: sort
        in: query
        description: Sort field
        schema:
          type: string
          enum: [name, usage_count, created_at, category]
          default: name
        example: "usage_count"
      - name: order
        in: query
        description: Sort direction
        schema:
          type: string
          enum: [asc, desc]
          default: asc
        example: "desc"
    responses:
      '200':
        description: Media tags retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/MediaTag'
                    meta:
                      type: object
                      properties:
                        categories:
                          type: array
                          items:
                            type: object
                            properties:
                              name:
                                type: string
                                example: "materials"
                              count:
                                type: integer
                                example: 8
                        total_tags:
                          type: integer
                          example: 25
            examples:
              ok:
                summary: Tags list
                value:
                  success: true
                  data:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      name: "Glass Etching"
                      color: "#28a745"
                      category: "materials"
                  meta:
                    categories:
                      - name: "materials"
                        count: 1
                    total_tags: 1
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '429':
        $ref: '../../components/responses.yaml#/RateLimitExceeded'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Media Tags
    summary: Create Media Tag
    description: |
      Create a new media tag for file organization and categorization.
      
      **Features:**
      - Unique tag name per tenant
      - Automatic slug generation
      - Color coding for visual organization
      - Category assignment
    operationId: createMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.tag.create
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaTagCreateInput'
          examples:
            material_tag:
              summary: Create material tag
              value:
                name: "Glass Etching"
                description: "Images and designs related to glass etching projects"
                color: "#28a745"
                category: "materials"
            project_tag:
              summary: Create project tag
              value:
                name: "Customer Project A"
                description: "Files for specific customer project"
                color: "#007bff"
                category: "projects"
    responses:
      '201':
        description: Media tag created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaTag'
                    message:
                      type: string
                      example: "Media tag created successfully"
            examples:
              created:
                summary: Tag created
                value:
                  success: true
                  message: "Media tag created successfully"
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Glass Etching"
                    color: "#28a745"
                    category: "materials"
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '409':
        description: Tag name already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "TAG_EXISTS"
                message: "Tag with this name already exists"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/tags/{uuid}:
  get:
    tags:
      - Media Tags
    summary: Get Media Tag Details
    description: |
      Retrieve detailed information about a specific media tag including usage statistics.
    operationId: getMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.tag.read
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media tag UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Media tag details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      allOf:
                        - $ref: '../../components/schemas.yaml#/MediaTag'
                        - type: object
                          properties:
                            recent_files:
                              type: array
                              items:
                                $ref: '../../components/schemas.yaml#/MediaFile'
                              description: Recent files using this tag
            examples:
              ok:
                summary: Tag detail
                value:
                  success: true
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Glass Etching"
                    color: "#28a745"
                    category: "materials"
                    recent_files: []
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media tag not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Media Tags
    summary: Update Media Tag
    description: |
      Update media tag properties and organization.
    operationId: updateMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.tag.update
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media tag UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaTagUpdateInput'
          examples:
            update_tag:
              summary: Update tag properties
              value:
                name: "Updated Tag Name"
                description: "Updated description"
                color: "#dc3545"
                category: "updated_category"
    responses:
      '200':
        description: Media tag updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaTag'
                    message:
                      type: string
                      example: "Media tag updated successfully"
            examples:
              ok:
                summary: Tag updated
                value:
                  success: true
                  message: "Media tag updated successfully"
                  data:
                    id: "550e8400-e29b-41d4-a716-446655440000"
                    name: "Updated Tag Name"
                    color: "#dc3545"
                    category: "updated_category"
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media tag not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Media Tags
    summary: Delete Media Tag
    description: |
      Delete a media tag and remove it from all associated files.
      
      **Features:**
      - Automatic removal from all files
      - Usage count validation
      - Audit trail logging
    operationId: deleteMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.tag.delete
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media tag UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: Media tag deleted successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    message:
                      type: string
                      example: "Media tag deleted successfully"
                    data:
                      type: object
                      properties:
                        removed_from_files:
                          type: integer
                          example: 15
            examples:
              ok:
                summary: Tag deleted
                value:
                  success: true
                  message: "Media tag deleted successfully"
                  data:
                    removed_from_files: 15
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media tag not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# MEDIA TRANSFORMATIONS ENDPOINTS
# ================================================================
/platform/media/files/{uuid}/transformations:
  get:
    tags:
      - Media Transformations
    summary: List File Transformations
    description: |
      Retrieve all available transformations for a specific media file.
      
      **Features:**
      - All transformation variants
      - Size and format information
      - Download URLs for each transformation
    operationId: listFileTransformations
    security:
      - bearerAuth: []
    x-permissions:
      - media.transform.list
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: File transformations retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/MediaTransformation'
            examples:
              ok:
                summary: Transformations list
                value:
                  success: true
                  data:
                    - name: "thumbnail_300x300"
                      width: 300
                      height: 300
                      format: "webp"
                    - name: "large_jpeg"
                      width: 1200
                      height: 800
                      format: "jpeg"
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Media Transformations
    summary: Create File Transformation
    description: |
      Create a new transformation variant of a media file.
      
      **Transformation Types:**
      - Resize with various algorithms
      - Format conversion (WebP, AVIF)
      - Quality optimization
      - Watermark application
      - Crop and aspect ratio adjustment
    operationId: createFileTransformation
    security:
      - bearerAuth: []
    x-permissions:
      - media.transform.create
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - name
              - params
            properties:
              name:
                type: string
                maxLength: 100
                description: Transformation name/identifier
                example: "thumbnail_300x300"
              params:
                type: object
                description: Transformation parameters
                properties:
                  width:
                    type: integer
                    minimum: 1
                    maximum: 4000
                    example: 300
                  height:
                    type: integer
                    minimum: 1
                    maximum: 4000
                    example: 300
                  quality:
                    type: integer
                    minimum: 1
                    maximum: 100
                    default: 85
                    example: 85
                  format:
                    type: string
                    enum: [jpeg, png, webp, avif]
                    default: "webp"
                    example: "webp"
                  crop:
                    type: string
                    enum: [center, top, bottom, left, right, smart]
                    default: "center"
                    example: "center"
                  watermark:
                    type: object
                    properties:
                      enabled:
                        type: boolean
                        default: false
                        example: true
                      position:
                        type: string
                        enum: [top-left, top-right, bottom-left, bottom-right, center]
                        default: "bottom-right"
                        example: "bottom-right"
                      opacity:
                        type: number
                        minimum: 0
                        maximum: 1
                        default: 0.7
                        example: 0.7
          examples:
            thumbnail:
              summary: Create thumbnail transformation
              value:
                name: "thumbnail_300x300"
                params:
                  width: 300
                  height: 300
                  quality: 85
                  format: "webp"
                  crop: "center"
            watermarked:
              summary: Create watermarked version
              value:
                name: "watermarked_large"
                params:
                  width: 1200
                  quality: 90
                  format: "jpeg"
                  watermark:
                    enabled: true
                    position: "bottom-right"
                    opacity: 0.7
    responses:
      '201':
        description: Transformation created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaTransformation'
                    message:
                      type: string
                      example: "Media transformation created successfully"
            examples:
              created:
                summary: Transformation created
                value:
                  success: true
                  message: "Media transformation created successfully"
                  data:
                    name: "thumbnail_300x300"
                    width: 300
                    height: 300
                    format: "webp"
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '409':
        description: Transformation with this name already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: "TRANSFORMATION_EXISTS"
                message: "Transformation with this name already exists for this file"
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# MEDIA ANALYTICS ENDPOINTS
# ================================================================
/platform/media/analytics:
  get:
    tags:
      - Platform Media Analytics
    summary: Platform - Get Media Analytics Summary Across All Tenants
    description: |
      Retrieve comprehensive media analytics and usage statistics.
      
      **Analytics Include:**
      - Total files and storage usage
      - Most viewed/downloaded files
      - Storage usage by file type
      - Activity timeline
      - Performance metrics
    operationId: getMediaAnalytics
    security:
      - bearerAuth: []
    x-permissions:
      - media.analytics
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: period
        in: query
        description: Analytics time period
        schema:
          type: string
          enum: [day, week, month, year]
          default: month
        example: "month"
      - name: file_type
        in: query
        description: Filter by specific file type
        schema:
          type: string
          enum: [image, document, video, audio, design, archive]
        example: "image"
      - name: from_date
        in: query
        description: Start date for analytics period
        schema:
          type: string
          format: date
        example: "2024-10-01"
      - name: to_date
        in: query
        description: End date for analytics period
        schema:
          type: string
          format: date
        example: "2024-11-12"
    responses:
      '200':
        description: Media analytics retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaAnalyticsSummary'
            examples:
              ok:
                summary: Analytics summary
                value:
                  success: true
                  data:
                    totals:
                      files: 2450
                      storage_bytes: 987654321
                    top_files:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        filename: "hero.jpg"
                        downloads: 1200
                      - id: "123e4567-e89b-12d3-a456-426614174000"
                        filename: "brochure.pdf"
                        downloads: 875
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/media/files/{uuid}/usage:
  get:
    tags:
      - Media Analytics
    summary: Get File Usage Information
    description: |
      Retrieve detailed usage information for a specific media file.
      
      **Usage Information:**
      - Where the file is used throughout the system
      - Usage context and metadata
      - Reference to related entities
      - Usage frequency and patterns
    operationId: getFileUsage
    security:
      - bearerAuth: []
    x-permissions:
      - media.analytics.read
    parameters:
      - $ref: '../../components/parameters.yaml#/TenantHeader'
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    responses:
      '200':
        description: File usage information retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        usage_records:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaUsage'
                        summary:
                          type: object
                          properties:
                            total_usage:
                              type: integer
                              example: 8
                            usage_contexts:
                              type: object
                              additionalProperties:
                                type: integer
                              example:
                                product_image: 3
                                gallery_image: 2
                                design_file: 3
                            can_be_deleted:
                              type: boolean
                              example: false
                              description: Whether file can be safely deleted
            examples:
              ok:
                summary: File usage
                value:
                  success: true
                  data:
                    usage_records: []
                    summary:
                      total_usage: 8
                      usage_contexts:
                        product_image: 3
                        gallery_image: 2
                        design_file: 3
                      can_be_deleted: false
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        description: Media file not found
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# ================================================================
# TENANT MEDIA FILE ENDPOINTS (Tenant Users)
# ================================================================
/tenant/media/upload:
  post:
    tags:
      - Tenant Media Files
    summary: Tenant - Upload Single Media File
    description: |
      Tenant user uploads a single media file with metadata and optional folder assignment.
      
      **Tenant Features:**
      - File upload within tenant scope
      - Metadata assignment
      - Folder organization
      - Tag management
      - Multi-format support (image, document, video, design files)
      - Automatic file validation
      - Thumbnail generation for images
      - EXIF data extraction
    operationId: tenantUploadMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.upload
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFileCreateInput'
          examples:
            product_image:
              summary: Upload product image
              value:
                folder_id: "550e8400-e29b-41d4-a716-446655440000"
                alt_text: "Custom etched glass design"
                caption: "High-quality etching work"
                description: "Professional glass etching with company logo"
                tags: ["123e4567-e89b-12d3-a456-426614174000"]
                is_public: false
    responses:
      '201':
        description: File uploaded successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
                    message:
                      type: string
                      example: "File uploaded successfully"
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '413':
        $ref: '../../components/responses.yaml#/PayloadTooLarge'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/upload/bulk:
  post:
    tags:
      - Tenant Media Files
    summary: Tenant - Upload Multiple Media Files
    description: |
      Tenant user uploads multiple media files with individual metadata settings.
      
      **Features:**
      - Batch upload within tenant scope
      - Individual metadata per file
      - Folder assignment per file
      - Progress tracking for large batches
    operationId: tenantBulkUploadMediaFiles
    security:
      - bearerAuth: []
    x-permissions:
      - media.upload
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            $ref: '../../components/schemas.yaml#/BulkMediaFileCreateInput'
    responses:
      '201':
        description: Files uploaded successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        uploaded_files:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
                        failed_files:
                          type: array
                          items:
                            type: object
                            properties:
                              filename:
                                type: string
                              error:
                                type: string
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '413':
        $ref: '../../components/responses.yaml#/PayloadTooLarge'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/files:
  get:
    tags:
      - Tenant Media Files
    summary: Tenant - List Media Files
    description: |
      Retrieve a paginated list of media files within tenant scope with filtering options.
    operationId: tenantListMediaFiles
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: page
        in: query
        description: Page number (1-based)
        schema:
          type: integer
          minimum: 1
          default: 1
      - name: limit
        in: query
        description: Items per page
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      - name: folder_id
        in: query
        description: Filter by folder ID
        schema:
          type: string
          format: uuid
      - name: mime_type
        in: query
        description: Filter by MIME type
        schema:
          type: string
      - name: search
        in: query
        description: Search in filename, alt_text, caption, and description
        schema:
          type: string
      - name: tags
        in: query
        description: Filter by tag IDs (comma-separated)
        schema:
          type: string
      - name: is_public
        in: query
        description: Filter by public status
        schema:
          type: boolean
    responses:
      '200':
        description: Media files retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - $ref: '../../components/schemas.yaml#/PaginatedResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/files/{uuid}:
  get:
    tags:
      - Tenant Media Files
    summary: Tenant - Get Media File Details
    description: Retrieve detailed information about a specific media file within tenant scope.
    operationId: tenantGetMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Media file details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Tenant Media Files
    summary: Tenant - Update Media File
    description: Update metadata and properties of a media file within tenant scope.
    operationId: tenantUpdateMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.update
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFileUpdateInput'
    responses:
      '200':
        description: Media file updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Tenant Media Files
    summary: Tenant - Delete Media File
    description: Delete a media file and its associated data within tenant scope.
    operationId: tenantDeleteMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.delete
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Media file deleted successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/BaseResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '409':
        description: File is in use and cannot be deleted
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/files/move:
  put:
    tags:
      - Tenant Media Files
    summary: Tenant - Move Multiple Files
    description: |
      Move multiple media files to a different folder within tenant scope, with optional metadata updates.
    operationId: tenantMoveMediaFiles
    security:
      - bearerAuth: []
    x-permissions:
      - media.update
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/BulkMediaFilesMoveInput'
    responses:
      '200':
        description: Files moved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        moved_files:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
                        failed_files:
                          type: array
                          items:
                            type: object
                            properties:
                              file_id:
                                type: string
                                format: uuid
                              error:
                                type: string
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/files/{uuid}/download:
  get:
    tags:
      - Tenant Media Files
    summary: Tenant - Get Secure Download URL
    description: |
      Generate a secure, time-limited download URL for a media file within tenant scope.
    operationId: tenantGetMediaFileDownloadUrl
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
      - name: expires_in
        in: query
        description: URL expiration time in seconds (default 3600, max 86400)
        schema:
          type: integer
          minimum: 60
          maximum: 86400
          default: 3600
    responses:
      '200':
        description: Download URL generated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        download_url:
                          type: string
                          format: uri
                        expires_at:
                          type: string
                          format: date-time
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/folders:
  get:
    tags:
      - Tenant Media Folders
    summary: Tenant - List Media Folders
    description: |
      Retrieve a hierarchical list of media folders within tenant scope with optional filtering.
    operationId: tenantListMediaFolders
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: parent_id
        in: query
        description: Filter by parent folder ID (null for root folders)
        schema:
          type: string
          format: uuid
      - name: include_files_count
        in: query
        description: Include count of files in each folder
        schema:
          type: boolean
          default: false
    responses:
      '200':
        description: Media folders retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/MediaFolderWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Tenant Media Folders
    summary: Tenant - Create Media Folder
    description: Create a new media folder within tenant scope for organizing media files.
    operationId: tenantCreateMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.create
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFolderCreateInput'
    responses:
      '201':
        description: Media folder created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFolderWithRelations'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/folders/{uuid}:
  get:
    tags:
      - Tenant Media Folders
    summary: Tenant - Get Media Folder Details
    description: Retrieve detailed information about a specific media folder within tenant scope.
    operationId: tenantGetMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Media folder details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFolderWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Tenant Media Folders
    summary: Tenant - Update Media Folder
    description: Update the properties of a media folder within tenant scope.
    operationId: tenantUpdateMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.update
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFolderUpdateInput'
    responses:
      '200':
        description: Media folder updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFolderWithRelations'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Tenant Media Folders
    summary: Tenant - Delete Media Folder
    description: Delete a media folder and optionally its contents within tenant scope.
    operationId: tenantDeleteMediaFolder
    security:
      - bearerAuth: []
    x-permissions:
      - media.delete
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
      - name: force
        in: query
        description: Force delete folder with contents
        schema:
          type: boolean
          default: false
    responses:
      '200':
        description: Media folder deleted successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/BaseResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '409':
        description: Folder contains files and force=false
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/folders/{uuid}/contents:
  get:
    tags:
      - Tenant Media Folders
    summary: Tenant - List Folder Contents
    description: |
      Retrieve the contents of a media folder (subfolders and files) within tenant scope with pagination.
    operationId: tenantListMediaFolderContents
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media folder UUID
        schema:
          type: string
          format: uuid
      - name: page
        in: query
        description: Page number (1-based)
        schema:
          type: integer
          minimum: 1
          default: 1
      - name: limit
        in: query
        description: Items per page
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      - name: type
        in: query
        description: Filter by content type
        schema:
          type: string
          enum: [all, folders, files]
          default: all
    responses:
      '200':
        description: Folder contents retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - $ref: '../../components/schemas.yaml#/PaginatedResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        folders:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFolderWithRelations'
                        files:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/tags:
  get:
    tags:
      - Tenant Media Tags
    summary: Tenant - List Media Tags
    description: |
      Retrieve a list of media tags within tenant scope for organizing and categorizing media files.
    operationId: tenantListMediaTags
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: search
        in: query
        description: Search tags by name
        schema:
          type: string
      - name: color
        in: query
        description: Filter by tag color
        schema:
          type: string
    responses:
      '200':
        description: Media tags retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/MediaTagWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Tenant Media Tags
    summary: Tenant - Create Media Tag
    description: Create a new media tag within tenant scope for organizing media files.
    operationId: tenantCreateMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.create
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaTagCreateInput'
    responses:
      '201':
        description: Media tag created successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaTagWithRelations'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/tags/{uuid}:
  get:
    tags:
      - Tenant Media Tags
    summary: Tenant - Get Media Tag Details
    description: Retrieve detailed information about a specific media tag within tenant scope.
    operationId: tenantGetMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media tag UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Media tag details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaTagWithRelations'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  put:
    tags:
      - Tenant Media Tags
    summary: Tenant - Update Media Tag
    description: Update the properties of a media tag within tenant scope.
    operationId: tenantUpdateMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.update
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media tag UUID
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaTagUpdateInput'
    responses:
      '200':
        description: Media tag updated successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaTagWithRelations'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  delete:
    tags:
      - Tenant Media Tags
    summary: Tenant - Delete Media Tag
    description: Delete a media tag within tenant scope.
    operationId: tenantDeleteMediaTag
    security:
      - bearerAuth: []
    x-permissions:
      - media.delete
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media tag UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Media tag deleted successfully
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/BaseResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/files/{uuid}/transformations:
  get:
    tags:
      - Tenant Media Files
    summary: Tenant - Get File Transformation Options
    description: |
      Retrieve available transformation options for a media file within tenant scope.
    operationId: tenantGetMediaFileTransformations
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Transformation options retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        supported_formats:
                          type: array
                          items:
                            type: string
                        resize_options:
                          type: object
                        quality_options:
                          type: object
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

  post:
    tags:
      - Tenant Media Files
    summary: Tenant - Transform Media File
    description: |
      Apply transformations to a media file within tenant scope (resize, format conversion, etc.).
    operationId: tenantTransformMediaFile
    security:
      - bearerAuth: []
    x-permissions:
      - media.update
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/MediaFileTransformationInput'
    responses:
      '200':
        description: File transformation completed successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaFileWithRelations'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/analytics:
  get:
    tags:
      - Tenant Media Analytics
    summary: Tenant - Get Media Analytics
    description: |
      Retrieve comprehensive analytics about media files within tenant scope including usage statistics.
    operationId: tenantGetMediaAnalytics
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: period
        in: query
        description: Analytics period
        schema:
          type: string
          enum: [daily, weekly, monthly, yearly]
          default: monthly
      - name: start_date
        in: query
        description: Start date for analytics (ISO 8601)
        schema:
          type: string
          format: date
      - name: end_date
        in: query
        description: End date for analytics (ISO 8601)
        schema:
          type: string
          format: date
    responses:
      '200':
        description: Analytics data retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      $ref: '../../components/schemas.yaml#/MediaAnalytics'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/media/files/{uuid}/usage:
  get:
    tags:
      - Tenant Media Files
    summary: Tenant - Get File Usage Information
    description: |
      Retrieve usage information for a specific media file within tenant scope.
    operationId: tenantGetMediaFileUsage
    security:
      - bearerAuth: []
    x-permissions:
      - media.read
    parameters:
      - name: X-Tenant-ID
        in: header
        required: true
        description: Tenant ID for scoped access
        schema:
          type: string
          format: uuid
      - name: uuid
        in: path
        required: true
        description: Media file UUID
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: File usage information retrieved successfully
        content:
          application/json:
            schema:
              allOf:
                - $ref: '../../components/schemas.yaml#/BaseResponse'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        usage_records:
                          type: array
                          items:
                            $ref: '../../components/schemas.yaml#/MediaUsage'
                        summary:
                          type: object
                          properties:
                            total_usage:
                              type: integer
                            usage_contexts:
                              type: object
                              additionalProperties:
                                type: integer
                            can_be_deleted:
                              type: boolean
                              description: Whether file can be safely deleted
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
