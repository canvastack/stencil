# Users & RBAC Management API Paths for Stencil CMS
# Complete CRUD operations for Users & RBAC Management System (40+ endpoints)
  # ================================================================
  # AUTHENTICATION ENDPOINTS
  # ================================================================
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register New User Account
      description: |
        Register a new user account with email verification workflow.
        
        **Features:**
        - Automatic email verification link
        - Password strength validation
        - Duplicate email prevention
        - Multi-tenant support
      operationId: registerUser
      security: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/UserCreateInput'
            examples:
              new_user:
                summary: New user registration
                value:
                  email: "newuser@ptcex.com"
                  password: "SecurePass123!"
                  name: "John Doe"
                  first_name: "John"
                  last_name: "Doe"
                  phone: "+62812345678"
                  language: "en"
                  send_invitation: true
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/User'
                      message:
                        type: string
                        example: "User registered successfully. Please check your email for verification."
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              example:
                success: false
                error:
                  code: "EMAIL_EXISTS"
                  message: "Email address already registered"
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /auth/login:
    post:
      tags:
        - Authentication  
      summary: User Login
      description: |
        Authenticate user with email and password, returning JWT token and user profile.
        
        **Features:**
        - JWT token generation
        - Account lockout protection
        - 2FA support
        - Tenant list included
        - Login attempt tracking
      operationId: loginUser
      security: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: User email address
                  example: "admin@ptcex.com"
                password:
                  type: string
                  description: User password
                  example: "password123"
                two_factor_code:
                  type: string
                  pattern: '^[0-9]{6}$'
                  description: 2FA code (if 2FA enabled)
                  example: "123456"
                remember_me:
                  type: boolean
                  default: false
                  description: Extended token expiry
                  example: false
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '../../schemas/content-management/users.yaml#/AuthResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          description: Invalid credentials or account locked
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              examples:
                invalid_credentials:
                  summary: Invalid email or password
                  value:
                    success: false
                    error:
                      code: "INVALID_CREDENTIALS"
                      message: "Invalid email or password"
                account_locked:
                  summary: Account temporarily locked
                  value:
                    success: false
                    error:
                      code: "ACCOUNT_LOCKED"
                      message: "Account locked due to too many failed attempts"
                      locked_until: "2025-11-12T15:30:00Z"
        '423':
          description: 2FA verification required
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              example:
                success: false
                error:
                  code: "2FA_REQUIRED"
                  message: "Two-factor authentication code required"
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User Logout
      description: |
        Revoke current authentication token and log user activity.
      operationId: logoutUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Logged out successfully"
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /auth/verify-email:
    post:
      tags:
        - Authentication
      summary: Verify Email Address
      description: |
        Verify user email address using verification token sent via email.
      operationId: verifyEmail
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Email verification token
                  example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Email verified successfully"
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              example:
                success: false
                error:
                  code: "INVALID_TOKEN"
                  message: "Verification token is invalid or expired"
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request Password Reset
      description: |
        Send password reset link to user's email address.
      operationId: forgotPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: User email address
                  example: "user@ptcex.com"
      responses:
        '200':
          description: Password reset email sent (returns success even if email not found for security)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "If the email address exists, a password reset link has been sent"
        '429':
          $ref: '../../components/responses.yaml#/RateLimitExceeded'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset Password
      description: |
        Reset user password using reset token from email.
      operationId: resetPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
                - password_confirmation
              properties:
                token:
                  type: string
                  description: Password reset token
                  example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9..."
                password:
                  type: string
                  minLength: 8
                  description: New password
                  example: "NewSecurePass123!"
                password_confirmation:
                  type: string
                  description: Password confirmation
                  example: "NewSecurePass123!"
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Password reset successfully"
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  # ================================================================
  # USER MANAGEMENT ENDPOINTS  
  # ================================================================
  /users:
    get:
      tags:
        - User Management
      summary: List Users
      description: |
        Retrieve paginated list of users with advanced filtering and search capabilities.
        
        **Admin Features:**
        - Search by name, email, phone
        - Filter by status, tenant, role
        - Sort by multiple fields
        - Export functionality
        - Tenant-scoped results
      operationId: listUsers
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - $ref: '../../components/parameters.yaml#/PageParam'
        - $ref: '../../components/parameters.yaml#/PerPageParam'
        - $ref: '../../components/parameters.yaml#/SortParam'
        - name: search
          in: query
          description: Search in name, email, phone
          schema:
            type: string
            maxLength: 255
          example: "john"
        - name: status
          in: query
          description: Filter by user status
          schema:
            type: string
            enum: [active, inactive, suspended, banned]
          example: "active"
        - name: is_verified
          in: query
          description: Filter by email verification status
          schema:
            type: boolean
          example: true
        - name: role_id
          in: query
          description: Filter by role assignment
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: created_from
          in: query
          description: Filter users created after this date
          schema:
            type: string
            format: date
          example: "2025-01-01"
        - name: created_to
          in: query
          description: Filter users created before this date
          schema:
            type: string
            format: date
          example: "2025-12-31"
        - name: include
          in: query
          description: Include related data
          schema:
            type: array
            items:
              type: string
              enum: [tenants, roles, permissions, statistics]
          style: form
          explode: false
          example: ["tenants", "roles"]
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '../../schemas/content-management/users.yaml#/UserProfile'
                      meta:
                        allOf:
                          - $ref: '../../components/schemas.yaml#/PaginationMeta'
                          - type: object
                            properties:
                              statistics:
                                $ref: '../../schemas/content-management/users.yaml#/UserStatistics'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    post:
      tags:
        - User Management
      summary: Create New User
      description: |
        Create a new user account with optional tenant assignment and role setup.
        
        **Admin Features:**
        - Auto-generate secure password
        - Send email invitation
        - Assign to tenant with roles
        - Set initial preferences
      operationId: createUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/UserCreateInput'
            examples:
              basic_user:
                summary: Basic user creation
                value:
                  email: "newuser@ptcex.com"
                  password: "TempPassword123!"
                  name: "Jane Doe"
                  first_name: "Jane"
                  last_name: "Doe"
                  phone: "+62812345678"
                  send_invitation: true
              admin_user:
                summary: Admin user with full details
                value:
                  email: "admin@ptcex.com"
                  password: "AdminPass123!"
                  name: "System Administrator"
                  first_name: "System"
                  last_name: "Administrator"
                  phone: "+62812345679"
                  language: "en"
                  timezone: "Asia/Jakarta"
                  send_invitation: false
      responses:
        '201':
          $ref: '../../components/responses.yaml#/CreatedResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /users/{id}:
    get:
      tags:
        - User Management
      summary: Get User Details
      description: |
        Retrieve detailed user information including profile, roles, permissions, and tenant assignments.
      operationId: getUserDetails
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: include
          in: query
          description: Include related data
          schema:
            type: array
            items:
              type: string
              enum: [tenants, roles, permissions, activity_log, security_log]
          style: form
          explode: false
          example: ["tenants", "roles", "permissions"]
      responses:
        '200':
          description: User details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/UserProfile'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    put:
      tags:
        - User Management
      summary: Update User Details
      description: |
        Update user profile information and preferences.
        
        **Admin Features:**
        - Update profile fields
        - Change user status
        - Modify preferences
        - Avatar upload
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/UserUpdateInput'
            examples:
              profile_update:
                summary: Profile information update
                value:
                  name: "John Smith Updated"
                  phone: "+62812345679"
                  language: "en"
                  timezone: "Asia/Singapore"
              status_change:
                summary: User status change
                value:
                  status: "suspended"
      responses:
        '200':
          $ref: '../../components/responses.yaml#/UpdatedResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    delete:
      tags:
        - User Management
      summary: Delete User
      description: |
        Soft delete user account with validation checks.
        
        **Validation:**
        - Check for active tenant assignments
        - Verify no active orders/transactions
        - Audit trail preservation
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: force
          in: query
          description: Force delete even if user has active assignments
          schema:
            type: boolean
            default: false
          example: false
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "User deleted successfully"
        '400':
          description: Cannot delete user with active assignments
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              example:
                success: false
                error:
                  code: "USER_HAS_ACTIVE_ASSIGNMENTS"
                  message: "Cannot delete user with active tenant assignments"
                  details:
                    active_tenants: 2
                    active_orders: 3
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /users/{id}/tenant-assignments:
    post:
      tags:
        - User Management
      summary: Assign User to Tenant
      description: |
        Assign user to current tenant with specified roles.
        
        **Features:**
        - Multi-role assignment
        - Email invitation sending
        - Access level configuration
        - Audit trail logging
      operationId: assignUserToTenant
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/TenantUserAssignInput'
            examples:
              basic_assignment:
                summary: Basic user assignment
                value:
                  user_id: "550e8400-e29b-41d4-a716-446655440000"
                  role_ids: ["123e4567-e89b-12d3-a456-426614174000"]
                  can_access_admin_panel: true
                  send_invitation: true
              manager_assignment:
                summary: Manager with notes
                value:
                  user_id: "550e8400-e29b-41d4-a716-446655440000"
                  role_ids: ["123e4567-e89b-12d3-a456-426614174000", "456e7890-e89b-12d3-a456-426614174000"]
                  can_access_admin_panel: true
                  notes: "Finance team manager - budget approval authority"
                  send_invitation: false
      responses:
        '201':
          description: User assigned to tenant successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/TenantUser'
                      message:
                        type: string
                        example: "User assigned to tenant successfully"
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '409':
          description: User already assigned to tenant
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    delete:
      tags:
        - User Management
      summary: Remove User from Tenant
      description: |
        Remove user's assignment from current tenant.
      operationId: removeUserFromTenant
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: User removed from tenant successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "User removed from tenant successfully"
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /users/me:
    get:
      tags:
        - User Management
      summary: Get Current User Profile
      description: |
        Retrieve current authenticated user's profile with permissions and tenant information.
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      responses:
        '200':
          description: Current user profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/UserProfile'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    put:
      tags:
        - User Management
      summary: Update Own Profile
      description: |
        Update current user's profile information and preferences.
      operationId: updateOwnProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 255
                first_name:
                  type: string
                  maxLength: 100
                last_name:
                  type: string
                  maxLength: 100
                phone:
                  type: string
                  maxLength: 50
                avatar_url:
                  type: string
                  format: uri
                language:
                  type: string
                  maxLength: 10
                timezone:
                  type: string
                  maxLength: 100
                date_format:
                  type: string
                  maxLength: 50
                time_format:
                  type: string
                  enum: ["12h", "24h"]
            examples:
              profile_update:
                summary: Update profile
                value:
                  name: "John Doe Updated"
                  phone: "+62812345680"
                  language: "id"
                  timezone: "Asia/Jakarta"
      responses:
        '200':
          $ref: '../../components/responses.yaml#/UpdatedResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /users/me/password:
    put:
      tags:
        - User Management
      summary: Change Own Password
      description: |
        Change current user's password with current password verification.
      operationId: changeOwnPassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - current_password
                - new_password
                - new_password_confirmation
              properties:
                current_password:
                  type: string
                  description: Current password for verification
                  example: "OldPassword123!"
                new_password:
                  type: string
                  minLength: 8
                  description: New password
                  example: "NewSecurePass123!"
                new_password_confirmation:
                  type: string
                  description: New password confirmation
                  example: "NewSecurePass123!"
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Password changed successfully"
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          description: Current password incorrect
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              example:
                success: false
                error:
                  code: "INVALID_PASSWORD"
                  message: "Current password is incorrect"
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  # ================================================================
  # ROLE MANAGEMENT ENDPOINTS
  # ================================================================
  /roles:
    get:
      tags:
        - Role Management
      summary: List Roles
      description: |
        Retrieve list of roles with optional filtering by scope and tenant.
        
        **Features:**
        - Tenant-scoped and platform roles
        - Role hierarchy information
        - Permission counts
        - User assignment counts
      operationId: listRoles
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - $ref: '../../components/parameters.yaml#/PageParam'
        - $ref: '../../components/parameters.yaml#/PerPageParam'
        - name: scope
          in: query
          description: Filter by role scope
          schema:
            type: string
            enum: [platform, tenant, hybrid]
          example: "tenant"
        - name: include_system
          in: query
          description: Include system roles
          schema:
            type: boolean
            default: true
          example: true
        - name: assignable_only
          in: query
          description: Only show assignable roles
          schema:
            type: boolean
            default: false
          example: false
        - name: include
          in: query
          description: Include related data
          schema:
            type: array
            items:
              type: string
              enum: [permissions, users, parent, children]
          style: form
          explode: false
          example: ["permissions", "users"]
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '../../schemas/content-management/users.yaml#/RoleDetail'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    post:
      tags:
        - Role Management
      summary: Create New Role
      description: |
        Create a new role with permissions assignment.
        
        **Features:**
        - Hierarchical role structure
        - Permission assignment
        - Display customization
        - Tenant-scoped creation
      operationId: createRole
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/RoleCreateInput'
            examples:
              basic_role:
                summary: Basic role creation
                value:
                  code: "product_manager"
                  name: "Product Manager"
                  description: "Manages product catalog and specifications"
                  scope: "tenant"
                  color: "#17a2b8"
                  icon: "box"
                  permission_ids: ["550e8400-e29b-41d4-a716-446655440000"]
              hierarchical_role:
                summary: Role with parent inheritance
                value:
                  code: "senior_manager"
                  name: "Senior Manager"
                  description: "Senior management role with extended permissions"
                  parent_role_id: "123e4567-e89b-12d3-a456-426614174000"
                  scope: "tenant"
                  color: "#28a745"
                  permission_ids: ["550e8400-e29b-41d4-a716-446655440000", "123e4567-e89b-12d3-a456-426614174000"]
      responses:
        '201':
          $ref: '../../components/responses.yaml#/CreatedResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '409':
          description: Role code already exists
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /roles/{id}:
    get:
      tags:
        - Role Management
      summary: Get Role Details
      description: |
        Retrieve detailed role information including permissions and user assignments.
      operationId: getRoleDetails
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Role details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/RoleDetail'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    put:
      tags:
        - Role Management
      summary: Update Role
      description: |
        Update role information and permissions.
      operationId: updateRole
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 255
                description:
                  type: string
                color:
                  type: string
                  maxLength: 20
                icon:
                  type: string
                  maxLength: 100
                permission_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
            examples:
              role_update:
                summary: Update role details
                value:
                  name: "Product Manager Updated"
                  description: "Updated product management role"
                  color: "#6f42c1"
                  permission_ids: ["550e8400-e29b-41d4-a716-446655440000", "123e4567-e89b-12d3-a456-426614174000"]
      responses:
        '200':
          $ref: '../../components/responses.yaml#/UpdatedResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

    delete:
      tags:
        - Role Management
      summary: Delete Role
      description: |
        Delete role with validation checks.
        
        **Validation:**
        - Cannot delete system roles
        - Cannot delete roles with assigned users
        - Cannot delete roles with child roles
      operationId: deleteRole
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: Role ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Role deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "Role deleted successfully"
        '400':
          description: Cannot delete role
          content:
            application/json:
              schema:
                $ref: '../../components/schemas.yaml#/ErrorResponse'
              examples:
                system_role:
                  summary: Cannot delete system role
                  value:
                    success: false
                    error:
                      code: "CANNOT_DELETE_SYSTEM_ROLE"
                      message: "System roles cannot be deleted"
                has_users:
                  summary: Role has assigned users
                  value:
                    success: false
                    error:
                      code: "ROLE_HAS_USERS"
                      message: "Cannot delete role with assigned users"
                      details:
                        user_count: 5
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  # ================================================================
  # PERMISSION MANAGEMENT ENDPOINTS
  # ================================================================
  /permissions:
    get:
      tags:
        - Permission Management
      summary: List All Permissions
      description: |
        Retrieve complete list of system permissions organized by category.
        
        **Features:**
        - Hierarchical category structure
        - Usage statistics
        - Search and filtering
        - Group organization
      operationId: listPermissions
      security:
        - bearerAuth: []
      parameters:
        - name: category
          in: query
          description: Filter by permission category
          schema:
            type: string
          example: "E-Commerce"
        - name: resource_type
          in: query
          description: Filter by resource type
          schema:
            type: string
          example: "Product"
        - name: scope
          in: query
          description: Filter by permission scope
          schema:
            type: string
            enum: [platform, tenant, global]
          example: "tenant"
        - name: include_system
          in: query
          description: Include system permissions
          schema:
            type: boolean
            default: true
          example: true
        - name: group_by
          in: query
          description: Group permissions by field
          schema:
            type: string
            enum: [category, resource_type, group_name]
            default: "category"
          example: "category"
      responses:
        '200':
          description: Permissions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        additionalProperties:
                          type: array
                          items:
                            $ref: '../../schemas/content-management/users.yaml#/PermissionDetail'
                        example:
                          "E-Commerce":
                            - id: "550e8400-e29b-41d4-a716-446655440000"
                              code: "products.create"
                              name: "Create Products"
                              category: "E-Commerce"
                              resource_type: "Product"
                              action: "create"
                          "User Management":
                            - id: "123e4567-e89b-12d3-a456-426614174000"
                              code: "users.view"
                              name: "View Users"
                              category: "User Management"
                              resource_type: "User"
                              action: "view"
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /permissions/check:
    post:
      tags:
        - Permission Management
      summary: Check User Permission
      description: |
        Check if user has specific permission with optional resource-level validation.
        
        **Features:**
        - Role-based permission checking
        - Resource-level ACL validation
        - Inheritance calculation
        - Conditional permissions
      operationId: checkPermission
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/PermissionCheckInput'
            examples:
              basic_check:
                summary: Basic permission check
                value:
                  permission_code: "products.create"
              resource_check:
                summary: Resource-level permission check
                value:
                  permission_code: "products.edit"
                  resource_type: "Product"
                  resource_id: "550e8400-e29b-41d4-a716-446655440000"
              user_check:
                summary: Check permission for specific user
                value:
                  user_id: "123e4567-e89b-12d3-a456-426614174000"
                  permission_code: "orders.approve"
      responses:
        '200':
          description: Permission check completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/PermissionCheckResult'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /users/{id}/permissions:
    get:
      tags:
        - Permission Management
      summary: Get User's Effective Permissions
      description: |
        Retrieve user's effective permissions including role-based, direct, and resource-specific permissions.
      operationId: getUserPermissions
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        - name: include_inherited
          in: query
          description: Include permissions from parent roles
          schema:
            type: boolean
            default: true
          example: true
        - name: include_resource_acl
          in: query
          description: Include resource-level permissions
          schema:
            type: boolean
            default: false
          example: false
      responses:
        '200':
          description: User permissions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          role_permissions:
                            type: array
                            description: Permissions from assigned roles
                            items:
                              type: object
                              properties:
                                permission:
                                  $ref: '../../schemas/content-management/users.yaml#/Permission'
                                granted_by_role:
                                  type: string
                                  example: "product_manager"
                                is_inherited:
                                  type: boolean
                                  example: false
                          direct_permissions:
                            type: array
                            description: Directly assigned permissions
                            items:
                              allOf:
                                - $ref: '../../schemas/content-management/users.yaml#/Permission'
                                - type: object
                                  properties:
                                    is_granted:
                                      type: boolean
                                      example: true
                                    expires_at:
                                      type: string
                                      format: date-time
                                      nullable: true
                          resource_permissions:
                            type: array
                            description: Resource-specific permissions (if requested)
                            items:
                              $ref: '../../schemas/content-management/users.yaml#/ResourcePermission'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /user-permissions:
    post:
      tags:
        - Permission Management
      summary: Grant Direct User Permission
      description: |
        Grant direct permission to user, overriding role permissions.
        
        **Use Cases:**
        - Temporary permission grants
        - Exception-based access
        - Time-limited permissions
        - Permission overrides
      operationId: grantUserPermission
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - permission_id
              properties:
                user_id:
                  type: string
                  format: uuid
                  description: User ID
                  example: "550e8400-e29b-41d4-a716-446655440000"
                permission_id:
                  type: string
                  format: uuid
                  description: Permission ID
                  example: "123e4567-e89b-12d3-a456-426614174000"
                is_granted:
                  type: boolean
                  default: true
                  description: Grant or deny permission
                  example: true
                expires_at:
                  type: string
                  format: date-time
                  nullable: true
                  description: Permission expiry time
                  example: "2025-12-31T23:59:59Z"
                reason:
                  type: string
                  nullable: true
                  description: Reason for granting permission
                  example: "Temporary access for project ABC"
                conditions:
                  type: object
                  nullable: true
                  description: Permission conditions
                  example:
                    ip_restrictions: ["192.168.1.0/24"]
                    time_restrictions:
                      start: "09:00"
                      end: "17:00"
            examples:
              temporary_access:
                summary: Temporary permission grant
                value:
                  user_id: "550e8400-e29b-41d4-a716-446655440000"
                  permission_id: "123e4567-e89b-12d3-a456-426614174000"
                  is_granted: true
                  expires_at: "2025-12-31T23:59:59Z"
                  reason: "Temporary access for Q4 project"
              permission_override:
                summary: Override role permission (deny)
                value:
                  user_id: "550e8400-e29b-41d4-a716-446655440000"
                  permission_id: "123e4567-e89b-12d3-a456-426614174000"
                  is_granted: false
                  reason: "Security restriction per management directive"
      responses:
        '201':
          $ref: '../../components/responses.yaml#/CreatedResponse'
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /user-permissions/{id}:
    delete:
      tags:
        - Permission Management
      summary: Revoke Direct User Permission
      description: |
        Remove direct user permission assignment.
      operationId: revokeUserPermission
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: id
          in: path
          required: true
          description: User Permission ID
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: User permission revoked successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      message:
                        type: string
                        example: "User permission revoked successfully"
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '404':
          $ref: '../../components/responses.yaml#/NotFound'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  # ================================================================
  # BULK OPERATIONS & UTILITIES
  # ================================================================
  /users/bulk:
    post:
      tags:
        - User Management
      summary: Bulk User Operations
      description: |
        Perform bulk operations on multiple users simultaneously.
        
        **Supported Operations:**
        - activate: Activate user accounts
        - deactivate: Deactivate user accounts  
        - suspend: Suspend user accounts
        - delete: Soft delete user accounts
        - verify_email: Mark emails as verified
      operationId: bulkUserOperation
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../../schemas/content-management/users.yaml#/BulkUserOperationInput'
            examples:
              activate_users:
                summary: Activate multiple users
                value:
                  user_ids: ["550e8400-e29b-41d4-a716-446655440000", "123e4567-e89b-12d3-a456-426614174000"]
                  action: "activate"
                  reason: "Monthly user review completed"
              suspend_users:
                summary: Suspend inactive users
                value:
                  user_ids: ["789e0123-e89b-12d3-a456-426614174000"]
                  action: "suspend"
                  reason: "Inactive for over 90 days"
      responses:
        '200':
          description: Bulk operation completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          processed:
                            type: integer
                            description: Number of users processed
                            example: 5
                          succeeded:
                            type: integer
                            description: Number of successful operations
                            example: 4
                          failed:
                            type: integer
                            description: Number of failed operations
                            example: 1
                          failures:
                            type: array
                            description: Details of failed operations
                            items:
                              type: object
                              properties:
                                user_id:
                                  type: string
                                  format: uuid
                                  example: "123e4567-e89b-12d3-a456-426614174000"
                                error:
                                  type: string
                                  example: "User has active orders and cannot be deleted"
        '400':
          $ref: '../../components/responses.yaml#/ValidationError'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'

  /users/statistics:
    get:
      tags:
        - User Management
      summary: Get User Statistics
      description: |
        Retrieve comprehensive user statistics and analytics.
        
        **Statistics Include:**
        - Total user counts by status
        - Registration trends
        - Login activity
        - Verification status
        - Platform admin counts
      operationId: getUserStatistics
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../../components/parameters.yaml#/TenantHeader'
        - name: period
          in: query
          description: Statistics period
          schema:
            type: string
            enum: [day, week, month, quarter, year]
            default: "month"
          example: "month"
      responses:
        '200':
          description: User statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '../../components/schemas.yaml#/BaseResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '../../schemas/content-management/users.yaml#/UserStatistics'
        '401':
          $ref: '../../components/responses.yaml#/Unauthorized'
        '403':
          $ref: '../../components/responses.yaml#/Forbidden'
        '500':
          $ref: '../../components/responses.yaml#/ServerError'