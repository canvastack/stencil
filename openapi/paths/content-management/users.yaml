# =============================================================================
# PLATFORM USER MANAGEMENT ENDPOINTS
# =============================================================================
/platform/users:
  get:
    tags:
    - Platform User Management
    summary: List All Platform Users (Platform Admin)
    description: 'Retrieve paginated list of all platform users with advanced filtering and cross-tenant search capabilities.

      **Platform Admin Features:**
      - Search across all tenants
      - Filter by tenant, status, role
      - Export functionality
      - Global user analytics
      '
    operationId: listPlatformUsers
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/PageParam'
    - $ref: '../../components/parameters.yaml#/PerPageParam'
    - $ref: '../../components/parameters.yaml#/SortParam'
    - name: search
      in: query
      description: Search in name, email, phone
      schema:
        type: string
        maxLength: 255
      example: john
    - name: tenant_id
      in: query
      description: Filter by specific tenant
      schema:
        type: string
        format: uuid
      example: 6ba7b810-9dad-11d1-80b4-00c04fd430c8
    - name: status
      in: query
      description: Filter by user status
      schema:
        type: string
        enum:
        - active
        - inactive
        - suspended
        - banned
      example: active
    - name: account_type
      in: query
      description: Filter by account type
      schema:
        type: string
        enum:
        - platform
        - tenant
      example: platform
    - name: include
      in: query
      description: Include related data
      schema:
        type: array
        items:
          type: string
          enum:
          - tenants
          - roles
          - permissions
          - statistics
      style: form
      explode: false
      example:
      - tenants
      - roles
    responses:
      '200':
        description: Platform users retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '../../components/schemas.yaml#/UserProfile'
                  meta:
                    allOf:
                    - $ref: '../../components/schemas.yaml#/PaginationMeta'
                    - type: object
                      properties:
                        statistics:
                          $ref: '../../components/schemas.yaml#/UserStatistics'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  post:
    tags:
    - Platform User Management
    summary: Create New Platform Admin
    description: 'Create a new platform administrator account.

      **Platform Features:**
      - Create super admin accounts
      - Assign platform-level permissions
      - Cross-tenant access setup
      '
    operationId: createPlatformUser
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/UserCreateInput'
          examples:
            platform_admin:
              summary: Platform administrator creation
              value:
                email: admin@ptcex.com
                password: AdminPass123!
                name: Platform Administrator
                first_name: Platform
                last_name: Administrator
                phone: '+62812345679'
                language: en
                timezone: Asia/Jakarta
                account_type: platform
                send_invitation: false
    responses:
      '201':
        $ref: '../../components/responses.yaml#/CreatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '409':
        description: Email already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/users/{id}:
  get:
    tags:
    - Platform User Management
    summary: Get Platform User Details
    description: 'Retrieve detailed platform user information including cross-tenant access.'
    operationId: getPlatformUserDetails
    security:
    - bearerAuth: []
    parameters:
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    - name: include
      in: query
      description: Include related data
      schema:
        type: array
        items:
          type: string
          enum:
          - tenants
          - roles
          - permissions
          - activity_log
          - security_log
      style: form
      explode: false
    responses:
      '200':
        description: Platform user details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/UserProfile'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  put:
    tags:
    - Platform User Management
    summary: Update Platform User
    description: 'Update platform user profile and permissions.'
    operationId: updatePlatformUser
    security:
    - bearerAuth: []
    parameters:
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/UserUpdateInput'
    responses:
      '200':
        $ref: '../../components/responses.yaml#/UpdatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  delete:
    tags:
    - Platform User Management
    summary: Delete Platform User
    description: 'Delete platform user with validation checks.'
    operationId: deletePlatformUser
    security:
    - bearerAuth: []
    parameters:
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    responses:
      '200':
        description: Platform user deleted successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Platform user deleted successfully
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/platform/roles:
  get:
    tags:
    - Platform Role Management
    summary: List Platform Roles
    description: 'Retrieve list of platform-level roles.'
    operationId: listPlatformRoles
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/PageParam'
    - $ref: '../../components/parameters.yaml#/PerPageParam'
    - name: scope
      in: query
      description: Filter by role scope
      schema:
        type: string
        enum:
        - platform
        - global
      example: platform
    responses:
      '200':
        description: Platform roles retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '../../components/schemas.yaml#/RoleDetail'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  post:
    tags:
    - Platform Role Management
    summary: Create Platform Role
    description: 'Create a new platform-level role.'
    operationId: createPlatformRole
    security:
    - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/RoleCreateInput'
    responses:
      '201':
        $ref: '../../components/responses.yaml#/CreatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

# =============================================================================
# TENANT USER MANAGEMENT ENDPOINTS
# =============================================================================
/tenant/auth/register:
  post:
    tags:
    - Tenant Authentication
    summary: Register New Tenant User Account
    description: 'Register a new tenant user account with email verification workflow.

      **Features:**
      - Automatic email verification link
      - Password strength validation
      - Duplicate email prevention
      - Tenant-scoped registration
      '
    operationId: registerTenantUser
    security: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/UserCreateInput'
          examples:
            new_tenant_user:
              summary: New tenant user registration
              value:
                email: newuser@ptcex.com
                password: SecurePass123!
                name: John Doe
                first_name: John
                last_name: Doe
                phone: '+62812345678'
                language: en
                send_invitation: true
    responses:
      '201':
        description: Tenant user registered successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/User'
                  message:
                    type: string
                    example: User registered successfully. Please check your email for verification.
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '409':
        description: Email already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            example:
              success: false
              error:
                code: EMAIL_EXISTS
                message: Email address already registered
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/auth/login:
  post:
    tags:
    - Tenant Authentication
    summary: Tenant User Login
    description: 'Authenticate tenant user with email and password.

      **Features:**
      - JWT token generation
      - Account lockout protection
      - 2FA support
      - Tenant context validation
      '
    operationId: loginTenantUser
    security: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
            - email
            - password
            properties:
              email:
                type: string
                format: email
                description: User email address
                example: user@ptcex.com
              password:
                type: string
                description: User password
                example: password123
              two_factor_code:
                type: string
                pattern: ^[0-9]{6}$
                description: 2FA code (if 2FA enabled)
                example: '123456'
              remember_me:
                type: boolean
                default: false
                description: Extended token expiry
    responses:
      '200':
        description: Login successful
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/AuthResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        description: Invalid credentials or account locked
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
            examples:
              invalid_credentials:
                summary: Invalid email or password
                value:
                  success: false
                  error:
                    code: INVALID_CREDENTIALS
                    message: Invalid email or password
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/auth/logout:
  post:
    tags:
    - Tenant Authentication
    summary: Tenant User Logout
    description: 'Revoke current authentication token and log user activity.'
    operationId: logoutTenantUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    responses:
      '200':
        description: Logout successful
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/auth/verify-email:
  post:
    tags:
    - Tenant Authentication
    summary: Verify Email Address
    description: 'Verify tenant user email address using verification token sent via email.'
    operationId: verifyTenantEmail
    security: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
            - token
            properties:
              token:
                type: string
                description: Email verification token
                example: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...
    responses:
      '200':
        description: Email verified successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Email verified successfully
      '400':
        description: Invalid or expired token
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/auth/forgot-password:
  post:
    tags:
    - Tenant Authentication
    summary: Request Password Reset
    description: 'Send password reset link to tenant user email address.'
    operationId: forgotTenantPassword
    security: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
            - email
            properties:
              email:
                type: string
                format: email
                description: User email address
                example: user@ptcex.com
    responses:
      '200':
        description: Password reset email sent
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: If the email address exists, a password reset link has been sent
      '429':
        $ref: '../../components/responses.yaml#/RateLimitExceeded'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/auth/reset-password:
  post:
    tags:
    - Tenant Authentication
    summary: Reset Password
    description: 'Reset tenant user password using reset token from email.'
    operationId: resetTenantPassword
    security: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
            - token
            - password
            - password_confirmation
            properties:
              token:
                type: string
                description: Password reset token
                example: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...
              password:
                type: string
                minLength: 8
                description: New password
                example: NewSecurePass123!
              password_confirmation:
                type: string
                description: Password confirmation
                example: NewSecurePass123!
    responses:
      '200':
        description: Password reset successful
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Password reset successfully
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users:
  get:
    tags:
    - Tenant User Management
    summary: List Tenant Users
    description: 'Retrieve paginated list of users within current tenant scope.

      **Tenant Features:**
      - Search by name, email, phone
      - Filter by status, role within tenant
      - Sort by multiple fields
      - Export tenant users
      - Tenant-scoped results only
      '
    operationId: listTenantUsers
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - $ref: '../../components/parameters.yaml#/PageParam'
    - $ref: '../../components/parameters.yaml#/PerPageParam'
    - $ref: '../../components/parameters.yaml#/SortParam'
    - name: search
      in: query
      description: Search in name, email, phone
      schema:
        type: string
        maxLength: 255
      example: john
    - name: status
      in: query
      description: Filter by user status
      schema:
        type: string
        enum:
        - active
        - inactive
        - suspended
        - banned
      example: active
    - name: is_verified
      in: query
      description: Filter by email verification status
      schema:
        type: boolean
      example: true
    - name: role_id
      in: query
      description: Filter by role assignment
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    - name: include
      in: query
      description: Include related data
      schema:
        type: array
        items:
          type: string
          enum:
          - roles
          - permissions
          - statistics
      style: form
      explode: false
    responses:
      '200':
        description: Tenant users retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '../../components/schemas.yaml#/UserProfile'
                  meta:
                    allOf:
                    - $ref: '../../components/schemas.yaml#/PaginationMeta'
                    - type: object
                      properties:
                        statistics:
                          $ref: '../../components/schemas.yaml#/UserStatistics'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  post:
    tags:
    - Tenant User Management
    summary: Create New Tenant User
    description: 'Create a new user account within current tenant scope.

      **Admin Features:**
      - Auto-generate secure password
      - Send email invitation
      - Assign to tenant with roles
      - Set initial preferences
      '
    operationId: createTenantUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/UserCreateInput'
          examples:
            basic_user:
              summary: Basic tenant user creation
              value:
                email: newuser@ptcex.com
                password: TempPassword123!
                name: Jane Doe
                first_name: Jane
                last_name: Doe
                phone: '+62812345678'
                send_invitation: true
    responses:
      '201':
        $ref: '../../components/responses.yaml#/CreatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '409':
        description: Email already exists
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/{id}:
  get:
    tags:
    - Tenant User Management
    summary: Get Tenant User Details
    description: 'Retrieve detailed user information within tenant scope.'
    operationId: getTenantUserDetails
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    - name: include
      in: query
      description: Include related data
      schema:
        type: array
        items:
          type: string
          enum:
          - roles
          - permissions
          - activity_log
          - security_log
      style: form
      explode: false
    responses:
      '200':
        description: Tenant user details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/UserProfile'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  put:
    tags:
    - Tenant User Management
    summary: Update Tenant User Details
    description: 'Update user profile information within tenant scope.'
    operationId: updateTenantUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/UserUpdateInput'
    responses:
      '200':
        $ref: '../../components/responses.yaml#/UpdatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  delete:
    tags:
    - Tenant User Management
    summary: Delete Tenant User
    description: 'Soft delete user account within tenant scope with validation checks.'
    operationId: deleteTenantUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    responses:
      '200':
        description: Tenant user deleted successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: User deleted successfully
      '400':
        description: Cannot delete user with active assignments
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/me:
  get:
    tags:
    - Tenant User Management
    summary: Get Current User Profile
    description: 'Retrieve current authenticated tenant user profile with permissions and tenant information.'
    operationId: getCurrentTenantUser
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    responses:
      '200':
        description: Current user profile retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/UserProfile'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  put:
    tags:
    - Tenant User Management
    summary: Update Own Profile
    description: 'Update current tenant user profile information and preferences.'
    operationId: updateOwnTenantProfile
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                maxLength: 255
              first_name:
                type: string
                maxLength: 100
              last_name:
                type: string
                maxLength: 100
              phone:
                type: string
                maxLength: 50
              avatar_url:
                type: string
                format: uri
              language:
                type: string
                maxLength: 10
              timezone:
                type: string
                maxLength: 100
              date_format:
                type: string
                maxLength: 50
              time_format:
                type: string
                enum:
                - 12h
                - 24h
    responses:
      '200':
        $ref: '../../components/responses.yaml#/UpdatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/me/password:
  put:
    tags:
    - Tenant User Management
    summary: Change Own Password
    description: 'Change current tenant user password with current password verification.'
    operationId: changeOwnTenantPassword
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
            - current_password
            - new_password
            - new_password_confirmation
            properties:
              current_password:
                type: string
                description: Current password for verification
                example: OldPassword123!
              new_password:
                type: string
                minLength: 8
                description: New password
                example: NewSecurePass123!
              new_password_confirmation:
                type: string
                description: New password confirmation
                example: NewSecurePass123!
    responses:
      '200':
        description: Password changed successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Password changed successfully
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        description: Current password incorrect
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/roles:
  get:
    tags:
    - Tenant Role Management
    summary: List Tenant Roles
    description: 'Retrieve list of roles within tenant scope with optional filtering.'
    operationId: listTenantRoles
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - $ref: '../../components/parameters.yaml#/PageParam'
    - $ref: '../../components/parameters.yaml#/PerPageParam'
    - name: scope
      in: query
      description: Filter by role scope
      schema:
        type: string
        enum:
        - tenant
        - hybrid
      example: tenant
    - name: include_system
      in: query
      description: Include system roles
      schema:
        type: boolean
        default: true
      example: true
    - name: assignable_only
      in: query
      description: Only show assignable roles
      schema:
        type: boolean
        default: false
      example: false
    responses:
      '200':
        description: Tenant roles retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '../../components/schemas.yaml#/RoleDetail'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  post:
    tags:
    - Tenant Role Management
    summary: Create New Tenant Role
    description: 'Create a new role within tenant scope with permissions assignment.'
    operationId: createTenantRole
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/RoleCreateInput'
    responses:
      '201':
        $ref: '../../components/responses.yaml#/CreatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/roles/{id}:
  get:
    tags:
    - Tenant Role Management
    summary: Get Tenant Role Details
    description: 'Retrieve detailed role information within tenant scope.'
    operationId: getTenantRoleDetails
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: Role ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    responses:
      '200':
        description: Tenant role details retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/RoleDetail'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  put:
    tags:
    - Tenant Role Management
    summary: Update Tenant Role
    description: 'Update role information and permissions within tenant scope.'
    operationId: updateTenantRole
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: Role ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                maxLength: 255
              description:
                type: string
              color:
                type: string
                maxLength: 20
              icon:
                type: string
                maxLength: 100
              permission_ids:
                type: array
                items:
                  type: string
                  format: uuid
    responses:
      '200':
        $ref: '../../components/responses.yaml#/UpdatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  delete:
    tags:
    - Tenant Role Management
    summary: Delete Tenant Role
    description: 'Delete role within tenant scope with validation checks.'
    operationId: deleteTenantRole
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: Role ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    responses:
      '200':
        description: Tenant role deleted successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: Role deleted successfully
      '400':
        description: Cannot delete role
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/permissions:
  get:
    tags:
    - Tenant Permission Management
    summary: List Tenant Permissions
    description: 'Retrieve tenant-scoped permissions organized by category.'
    operationId: listTenantPermissions
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: category
      in: query
      description: Filter by permission category
      schema:
        type: string
      example: E-Commerce
    - name: resource_type
      in: query
      description: Filter by resource type
      schema:
        type: string
      example: Product
    - name: scope
      in: query
      description: Filter by permission scope
      schema:
        type: string
        enum:
        - tenant
        - global
      example: tenant
    responses:
      '200':
        description: Tenant permissions retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        $ref: '../../components/schemas.yaml#/PermissionDetail'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/permissions/check:
  post:
    tags:
    - Tenant Permission Management
    summary: Check User Permission
    description: 'Check if user has specific permission within tenant scope with resource-level validation.'
    operationId: checkTenantPermission
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/PermissionCheckInput'
    responses:
      '200':
        description: Permission check completed
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/PermissionCheckResult'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/{id}/permissions:
  get:
    tags:
    - Tenant Permission Management
    summary: Get User's Effective Permissions
    description: 'Retrieve user effective permissions within tenant scope.'
    operationId: getTenantUserPermissions
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    - name: include_inherited
      in: query
      description: Include permissions from parent roles
      schema:
        type: boolean
        default: true
      example: true
    responses:
      '200':
        description: User permissions retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      role_permissions:
                        type: array
                        items:
                          type: object
                          properties:
                            permission:
                              $ref: '../../components/schemas.yaml#/Permission'
                            granted_by_role:
                              type: string
                            is_inherited:
                              type: boolean
                      direct_permissions:
                        type: array
                        items:
                          $ref: '../../components/schemas.yaml#/Permission'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/{id}/tenant-assignments:
  post:
    tags:
    - Tenant User Management
    summary: Assign User to Tenant
    description: 'Assign user to current tenant with specified roles.'
    operationId: assignUserToCurrentTenant
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/TenantUserAssignInput'
    responses:
      '201':
        description: User assigned to tenant successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/TenantUser'
                  message:
                    type: string
                    example: User assigned to tenant successfully
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '409':
        description: User already assigned to tenant
        content:
          application/json:
            schema:
              $ref: '../../components/schemas.yaml#/ErrorResponse'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'
  delete:
    tags:
    - Tenant User Management
    summary: Remove User from Tenant
    description: 'Remove user assignment from current tenant.'
    operationId: removeUserFromCurrentTenant
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    responses:
      '200':
        description: User removed from tenant successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: User removed from tenant successfully
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/user-permissions:
  post:
    tags:
    - Tenant Permission Management
    summary: Grant Direct User Permission
    description: 'Grant direct permission to user within tenant scope.'
    operationId: grantTenantUserPermission
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
            - user_id
            - permission_id
            properties:
              user_id:
                type: string
                format: uuid
                description: User ID
                example: 550e8400-e29b-41d4-a716-446655440000
              permission_id:
                type: string
                format: uuid
                description: Permission ID
                example: 123e4567-e89b-12d3-a456-426614174000
              is_granted:
                type: boolean
                default: true
                description: Grant or deny permission
                example: true
              expires_at:
                type: string
                format: date-time
                nullable: true
                description: Permission expiry time
                example: '2025-12-31T23:59:59Z'
              reason:
                type: string
                nullable: true
                description: Reason for granting permission
                example: Temporary access for project ABC
    responses:
      '201':
        $ref: '../../components/responses.yaml#/CreatedResponse'
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/user-permissions/{id}:
  delete:
    tags:
    - Tenant Permission Management
    summary: Revoke Direct User Permission
    description: 'Remove direct user permission assignment within tenant scope.'
    operationId: revokeTenantUserPermission
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: id
      in: path
      required: true
      description: User Permission ID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000
    responses:
      '200':
        description: User permission revoked successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  message:
                    type: string
                    example: User permission revoked successfully
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '404':
        $ref: '../../components/responses.yaml#/NotFound'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/bulk:
  post:
    tags:
    - Tenant User Management
    summary: Bulk Tenant User Operations
    description: "Perform bulk operations on multiple tenant users simultaneously."
    operationId: bulkTenantUserOperation
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../../components/schemas.yaml#/BulkUserOperationInput'
    responses:
      '200':
        description: Bulk operation completed
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      processed:
                        type: integer
                        description: Number of users processed
                        example: 5
                      succeeded:
                        type: integer
                        description: Number of successful operations
                        example: 4
                      failed:
                        type: integer
                        description: Number of failed operations
                        example: 1
                      failures:
                        type: array
                        description: Details of failed operations
                        items:
                          type: object
                          properties:
                            user_id:
                              type: string
                              format: uuid
                            error:
                              type: string
      '400':
        $ref: '../../components/responses.yaml#/ValidationError'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'

/tenant/users/statistics:
  get:
    tags:
    - Tenant User Management
    summary: Get Tenant User Statistics
    description: 'Retrieve comprehensive user statistics for current tenant.'
    operationId: getTenantUserStatistics
    security:
    - bearerAuth: []
    parameters:
    - $ref: '../../components/parameters.yaml#/TenantHeader'
    - name: period
      in: query
      description: Statistics period
      schema:
        type: string
        enum:
        - day
        - week
        - month
        - quarter
        - year
        default: month
      example: month
    responses:
      '200':
        description: Tenant user statistics retrieved successfully
        content:
          application/json:
            schema:
              allOf:
              - $ref: '../../components/schemas.yaml#/BaseResponse'
              - type: object
                properties:
                  data:
                    $ref: '../../components/schemas.yaml#/UserStatistics'
      '401':
        $ref: '../../components/responses.yaml#/Unauthorized'
      '403':
        $ref: '../../components/responses.yaml#/Forbidden'
      '500':
        $ref: '../../components/responses.yaml#/ServerError'