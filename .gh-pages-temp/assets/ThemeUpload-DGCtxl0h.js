import{j as e}from"./ui-vendor-CzLWDOsI.js";import{r as f,c as B}from"./react-vendor-92AQlTAG.js";import{ar as M,C as v,a as w,b,c as U,d as N,B as o,X as Z,L as O,I as $,as as L,aq as P,ai as D,i as R,a0 as W,p as q}from"./index-CA1Fui7q.js";import{A as k,a as T}from"./alert-ByRl8DZI.js";import{P as J}from"./progress-DGMfyAj_.js";import{J as Y}from"./jszip.min-VaQned3v.js";import{U as y}from"./upload-DcuZlmhL.js";import{F as H}from"./file-archive-hjVCq-KR.js";import{F as X}from"./file-Bbbn6BNp.js";import{I as G}from"./info-D97ENJ6t.js";import"./three-vendor-CaHj5NkI.js";function K({onUploadComplete:h,onUploadError:d}){var C;const[s,t]=f.useState({file:null,isUploading:!1,uploadProgress:0,validationResult:null,extractedFiles:null,previewData:null}),x=()=>{t({file:null,isUploading:!1,uploadProgress:0,validationResult:null,extractedFiles:null,previewData:null})},m=f.useCallback(async i=>{var r;const n=(r=i.target.files)==null?void 0:r[0];if(n){if(!n.name.endsWith(".zip")){t(a=>({...a,validationResult:{isValid:!1,errors:["Only ZIP files are supported"],warnings:[]}}));return}t(a=>({...a,file:n,uploadProgress:10}));try{const c=await new Y().loadAsync(n);t(l=>({...l,uploadProgress:30}));const u={},F=[];c.forEach((l,g)=>{g.dir||F.push(g.async("text").then(E=>{u[l]=E}))}),await Promise.all(F),t(l=>({...l,extractedFiles:u,uploadProgress:60}));let j=null,S="";const z=["theme.json","manifest.json","package.json","index.js","index.ts"];for(const l of z)if(u[l]){S=l;try{l.endsWith(".json")?j=JSON.parse(u[l]):j={name:"Custom Theme",version:"1.0.0"};break}catch(g){console.warn(`Failed to parse ${l}:`,g)}}t(l=>({...l,uploadProgress:80}));const V=M({manifest:j,theme:j,files:u});t(l=>({...l,validationResult:V,previewData:j,uploadProgress:100}))}catch(a){console.error("Failed to process ZIP file:",a),t(c=>({...c,validationResult:{isValid:!1,errors:[`Failed to process ZIP file: ${a}`],warnings:[]},uploadProgress:0}))}}},[]),p=async()=>{var i,n;if(!(!s.file||!s.extractedFiles||!((i=s.validationResult)!=null&&i.isValid))){t(r=>({...r,isUploading:!0,uploadProgress:0}));try{for(let a=0;a<=100;a+=10)t(c=>({...c,uploadProgress:a})),await new Promise(c=>setTimeout(c,100));const r=((n=s.previewData)==null?void 0:n.name)||"Uploaded Theme";h==null||h(r),x()}catch(r){console.error("Upload failed:",r);const a=r instanceof Error?r:new Error(String(r));d==null||d(a),t(c=>({...c,isUploading:!1}))}}},I=f.useCallback(i=>{i.preventDefault(),i.stopPropagation()},[]),A=f.useCallback(i=>{i.preventDefault(),i.stopPropagation();const r=Array.from(i.dataTransfer.files).find(a=>a.name.endsWith(".zip"));r&&m({target:{files:[r]}})},[m]);return e.jsxs(v,{className:"w-full max-w-2xl mx-auto",children:[e.jsxs(w,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Upload Theme Package"]}),e.jsx(U,{children:"Upload a ZIP file containing your theme files and assets"})]}),e.jsxs(N,{className:"space-y-6",children:[e.jsx("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${s.file?"border-green-300 bg-green-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:I,onDrop:A,children:s.file?e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"h-12 w-12 text-green-600 mx-auto"}),e.jsx("div",{className:"font-medium",children:s.file.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[(s.file.size/1024/1024).toFixed(2)," MB"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:x,className:"mt-2",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Remove"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium",children:"Drop your theme ZIP file here"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"or click to browse"})]}),e.jsxs(O,{htmlFor:"theme-upload",className:"cursor-pointer",children:[e.jsx($,{id:"theme-upload",type:"file",accept:".zip",onChange:m,className:"hidden"}),e.jsxs(o,{variant:"outline",className:"mt-2",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Choose File"]})]})]})}),s.uploadProgress>0&&s.uploadProgress<100&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Processing..."}),e.jsxs("span",{children:[s.uploadProgress,"%"]})]}),e.jsx(J,{value:s.uploadProgress,className:"h-2"})]}),s.validationResult&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[s.validationResult.isValid?e.jsx(P,{className:"h-4 w-4 text-green-600"}):e.jsx(D,{className:"h-4 w-4 text-red-600"}),"Validation Results"]}),s.validationResult.errors.length>0&&e.jsxs(k,{variant:"destructive",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Errors found:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.validationResult.errors.map((i,n)=>e.jsx("li",{className:"text-sm",children:i},n))})]})})]}),s.validationResult.warnings.length>0&&e.jsxs(k,{children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:s.validationResult.warnings.map((i,n)=>e.jsx("li",{className:"text-sm",children:i},n))})]})})]}),s.previewData&&e.jsxs(v,{children:[e.jsx(w,{children:e.jsx(b,{className:"text-base",children:"Theme Preview"})}),e.jsxs(N,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("p",{children:s.previewData.name||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Version:"}),e.jsx("p",{children:s.previewData.version||"1.0.0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Author:"}),e.jsx("p",{children:s.previewData.author||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Files:"}),e.jsxs("p",{children:[Object.keys(s.extractedFiles||{}).length," files"]})]})]}),s.previewData.description&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Description:"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.previewData.description})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(R,{variant:"outline",children:s.validationResult.isValid?"Valid":"Invalid"}),s.validationResult.warnings.length>0&&e.jsxs(R,{variant:"secondary",children:[s.validationResult.warnings.length," warnings"]})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:x,disabled:s.isUploading,children:"Cancel"}),e.jsx(o,{onClick:p,disabled:!((C=s.validationResult)!=null&&C.isValid)||s.isUploading,children:s.isUploading?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4 mr-2 animate-spin"}),"Installing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Install Theme"]})})]})]})]})}function oe(){const h=B(),[d,s]=f.useState({type:null,message:""}),t=p=>{s({type:"success",message:`Theme "${p}" has been successfully installed and is ready to use.`})},x=p=>{s({type:"error",message:`Upload failed: ${p.message}`})},m=()=>{h("/admin/themes")};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Back to Themes"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Upload Theme"}),e.jsx("p",{className:"text-muted-foreground",children:"Install a new theme from a ZIP package"})]})]}),d.type&&e.jsxs(k,{variant:d.type==="error"?"destructive":"default",children:[d.type==="success"?e.jsx(P,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"}),e.jsx(T,{children:d.message})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(b,{children:"Before You Upload"}),e.jsx(U,{children:"Please ensure your theme package meets the following requirements"})]}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Required Files"}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"theme.json"})," or ",e.jsx("code",{children:"manifest.json"})," - Theme metadata"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"index.ts"})," or ",e.jsx("code",{children:"index.js"})," - Main theme file"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"components/"})," - React components directory"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("code",{children:"assets/"})," - Images, fonts, and other assets"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Package Structure"}),e.jsxs("div",{className:"text-sm text-muted-foreground font-mono bg-muted/50 p-3 rounded",children:[e.jsx("div",{children:"theme-name.zip"}),e.jsx("div",{children:"â”œâ”€â”€ theme.json"}),e.jsx("div",{children:"â”œâ”€â”€ index.ts"}),e.jsx("div",{children:"â”œâ”€â”€ components/"}),e.jsx("div",{children:"â”‚   â”œâ”€â”€ Header.tsx"}),e.jsx("div",{children:"â”‚   â””â”€â”€ Footer.tsx"}),e.jsx("div",{children:"â”œâ”€â”€ assets/"}),e.jsx("div",{children:"â”‚   â”œâ”€â”€ images/"}),e.jsx("div",{children:"â”‚   â””â”€â”€ styles/"}),e.jsx("div",{children:"â””â”€â”€ README.md"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Theme Metadata (theme.json)"}),e.jsx("div",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded font-mono",children:e.jsx("pre",{children:`{
  "name": "My Custom Theme",
  "version": "1.0.0",
  "description": "A beautiful custom theme",
  "author": "Your Name",
  "license": "MIT",
  "compatibility": {
    "minVersion": "1.0.0"
  }
}`})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"ðŸ’¡ Pro Tips"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Test your theme locally before uploading"}),e.jsx("li",{children:"â€¢ Use TypeScript for better development experience"}),e.jsx("li",{children:"â€¢ Follow the existing component interfaces"}),e.jsx("li",{children:"â€¢ Include a README.md with installation instructions"}),e.jsx("li",{children:"â€¢ Optimize images and assets for web performance"})]})]})]})})]}),e.jsx(K,{onUploadComplete:t,onUploadError:x}),d.type==="success"&&e.jsx(v,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(P,{className:"h-12 w-12 text-green-600 mx-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Theme Installed Successfully!"}),e.jsx("p",{className:"text-muted-foreground",children:"Your theme has been installed and is ready to use."})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(o,{onClick:m,children:"View All Themes"}),e.jsx(o,{variant:"outline",onClick:()=>s({type:null,message:""}),children:"Upload Another Theme"})]})]})})})]})}export{oe as default};
