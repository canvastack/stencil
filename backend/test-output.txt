
Warning: Module "openssl" is already loaded in Unknown on line 0

Warning: Module "openssl" is already loaded in Unknown on line 0
PHP Warning:  Module "openssl" is already loaded in Unknown on line 0

   PASS  Tests\Unit\Application\Order\AssignVendorUseCaseTest
  ✓ it assigns vendor to order successfully                                                                      4.99s  
  ✓ it fails when order not found                                                                                0.27s  
  ✓ it fails when order belongs to different tenant                                                              0.09s  
  ✓ it fails when vendor not found                                                                               0.12s  
  ✓ it fails when order status does not allow vendor assignment                                                  0.12s  
  ✓ it fails when tenant id is empty                                                                             0.12s  
  ✓ it fails when order id is empty                                                                              0.10s  
  ✓ it fails when vendor id is empty                                                                             0.09s  

   PASS  Tests\Unit\Application\Order\CreatePurchaseOrderUseCaseTest
  ✓ it creates order successfully                                                                                2.19s  
  ✓ it fails when order number already exists                                                                    0.12s  
  ✓ it fails when tenant id is empty                                                                             0.10s  
  ✓ it fails when customer id is empty                                                                           0.10s  
  ✓ it fails when total amount is negative                                                                       0.10s  
  ✓ it fails when items array is empty                                                                           0.10s  
  ✓ it fails when item missing required fields                                                                   0.10s  
  ✓ it fails when item quantity is zero                                                                          0.10s  
  ✓ it fails when item unit price is negative                                                                    0.12s  
  ✓ it creates order with shipping and billing address                                                           0.09s  
  ✓ it creates order with default currency                                                                       0.10s  

   PASS  Tests\Unit\Application\Order\Handlers\CommandHandlersTest
  ✓ assign vendor handler delegates to use case                                                                  0.14s  
  ✓ negotiate with vendor handler delegates to use case                                                          0.22s  
  ✓ complete order handler delegates to use case                                                                 0.32s  

   PASS  Tests\Unit\Application\Order\Handlers\CreatePurchaseOrderHandlerTest
  ✓ it handles create purchase order command                                                                     0.13s  
  ✓ it returns order from use case                                                                               0.10s  

   PASS  Tests\Unit\Application\Order\Handlers\QueryHandlersTest
  ✓ get order query handler returns order by id                                                                  0.24s  
  ✓ get orders by status query handler returns paginated orders                                                  0.27s  
  ✓ get orders by status query handler handles pagination                                                        0.10s  
  ✓ get orders by customer query handler returns customer orders                                                 0.20s  
  ✓ get order analytics query handler returns analytics                                                          0.17s  
  ✓ get order history query handler returns recent orders                                                        0.32s  

   PASS  Tests\Unit\Application\Order\NegotiateWithVendorUseCaseTest
  ✓ it negotiates with vendor successfully                                                                       0.11s  
  ✓ it fails when order not found                                                                                0.10s  
  ✓ it fails when order status does not allow negotiation                                                        0.11s  
  ✓ it fails when quoted price is negative                                                                       0.11s  
  ✓ it fails when lead time is invalid                                                                           0.24s  
  ✓ it fails when vendor not found                                                                               0.12s  

   PASS  Tests\Unit\Application\Order\Services\ApplicationServicesTest
  ✓ order application service creates order with transaction                                                     0.55s  
  ✓ payment service verifies payment successfully                                                                0.16s  
  ✓ payment service validates payment amount                                                                     0.10s  
  ✓ payment service calculates down payment                                                                      0.10s  
  ✓ payment service generates invoice number                                                                     0.14s  
  ✓ vendor negotiation service starts negotiation                                                                0.15s  
  ✓ vendor negotiation service requests quote                                                                    0.13s  
  ✓ vendor negotiation service validates quote price                                                             0.14s  
  ✓ vendor negotiation service compares quotes                                                                   0.12s  
  ✓ vendor negotiation service sets deadline                                                                     0.15s  
  ✓ vendor negotiation service sets urgent deadline                                                              0.13s  
  ✓ vendor negotiation service concludes negotiation                                                             0.10s  

   PASS  Tests\Unit\Application\Order\Subscribers\EventSubscribersTest
  ✓ order workflow subscriber registered correctly                                                               5.06s  
  ✓ order workflow subscriber handles vendor assigned                                                            0.80s  
  ✓ order workflow subscriber handles quote requested                                                            0.20s  
  ✓ order workflow subscriber handles quote approved                                                             0.19s  
  ✓ order workflow subscriber handles order shipped                                                              0.20s  
  ✓ order workflow subscriber handles order completed                                                            2.15s  
  ✓ payment workflow subscriber registered correctly                                                             0.14s  
  ✓ payment workflow subscriber handles payment received                                                         0.69s  
  ✓ payment workflow subscriber handles refund processed                                                         0.21s  
  ✓ notification subscriber registered correctly                                                                 0.13s  
  ✓ notification subscriber handles order created                                                                0.30s  
  ✓ notification subscriber handles order status changed                                                         0.16s  
  ✓ notification subscriber handles payment received                                                             0.45s  
  ✓ notification subscriber handles order shipped                                                                0.17s  
  ✓ notification subscriber handles order delivered                                                              0.14s  
  ✓ notification subscriber handles order cancelled                                                              0.21s  
  ✓ subscribers maintain event mapping                                                                           0.14s  
  ✓ subscribers properly delegate to listeners                                                                   0.13s  
  ✓ multiple subscribers can handle same event                                                                   0.13s  
  ✓ event subscriber isolation                                                                                   0.20s  

   PASS  Tests\Unit\Application\Product\CreateProductCategoryUseCaseTest
  ✓ it creates root category successfully                                                                        0.39s  
  ✓ it creates child category successfully                                                                       0.10s  
  ✓ it throws exception when slug already exists                                                                 0.20s  
  ✓ it throws exception when parent not found                                                                    0.10s  
  ✓ it creates category with allowed materials                                                                   0.14s  
  ✓ it creates category with quality levels                                                                      0.15s  
  ✓ it creates category with customization options                                                               0.12s  
  ✓ it creates category with seo information                                                                     0.10s  
  ✓ it creates category with pricing configuration                                                               0.09s  
  ✓ it validates invalid material values                                                                         0.09s  
  ✓ it validates invalid quality values                                                                          0.10s  
  ✓ it validates markup percentage range                                                                         0.10s  
  ✓ it creates featured category                                                                                 0.12s  
  ✓ it creates hidden menu category                                                                              0.17s  
  ✓ it creates category with media information                                                                   0.13s  
  ✓ it creates category with custom sort order                                                                   0.10s  

   PASS  Tests\Unit\Application\Product\CreateProductVariantUseCaseTest
  ✓ it creates product variant successfully                                                                      0.54s  
  ✓ it creates variant with pricing information                                                                  0.11s  
  ✓ it creates variant with stock information                                                                    0.15s  
  ✓ it creates variant with dimensions                                                                           0.14s  
  ✓ it creates variant with custom sku                                                                           0.18s  
  ✓ it creates variant with etching specifications                                                               0.15s  
  ✓ it throws exception when category not found                                                                  0.13s  
  ✓ it throws exception when variant already exists                                                              0.11s  
  ✓ it throws exception when custom sku already exists                                                           0.11s  
  ✓ it validates invalid material                                                                                0.10s  
  ✓ it validates invalid quality                                                                                 0.10s  
  ✓ it validates negative dimensions                                                                             0.11s  
  ✓ it validates negative weight                                                                                 0.10s  
  ✓ it validates negative stock                                                                                  0.10s  
  ✓ it validates invalid pricing                                                                                 0.10s  
  ✓ it calculates price with material and quality multipliers                                                    0.12s  

   PASS  Tests\Unit\Domain\CustomerEntityTest
  ✓ it can be created with valid data                                                                            0.33s  
  ✓ it can be created as business customer                                                                       0.10s  
  ✓ business customer requires company name                                                                      0.10s  
  ✓ it can update name                                                                                           0.10s  
  ✓ it can update email                                                                                          0.11s  
  ✓ it can add and remove tags                                                                                   0.11s  
  ✓ it prevents duplicate tags                                                                                   0.10s  
  ✓ it can suspend and activate                                                                                  0.10s  
  ✓ it can update last order date                                                                                0.10s  
  ✓ it can calculate days since last order                                                                       0.10s  
  ✓ it returns null for days since last order when no orders                                                     0.10s  
  ✓ it generates correct display name for individual                                                             0.10s  
  ✓ it generates correct display name for business                                                               0.13s  
  ✓ it can update phone                                                                                          0.13s  
  ✓ it can update address                                                                                        0.13s  
  ✓ it can convert to array                                                                                      0.10s  
ℹ️  No duplicate categories found

   PASS  Tests\Unit\Domain\Customer\Services\CustomerSegmentationServiceTest
  ✓ calculate rfm score for champion customer                                                                   17.74s  
  ✓ calculate rfm score for new customer                                                                         0.14s  
  ✓ segment all customers returns collection                                                                     0.16s  
  ✓ get segment distribution returns valid data                                                                  0.17s  
  ✓ get lifetime value calculates correctly                                                                      0.17s  
  ✓ get churn risk identifies at risk customer                                                                   0.26s  
  ✓ get churn risk identifies low risk customer                                                                  0.28s  
  ✓ get high value customers filters correctly                                                                   0.39s  
  ✓ get at risk customers returns high churn risk                                                                0.20s  

   PASS  Tests\Unit\Domain\Order\Jobs\OrderSlaMonitorJobTest
  ✓ job handles order sla monitoring                                                                             0.52s  
  ✓ sla breach detection                                                                                         0.16s  
  ✓ multi level escalation slack channel                                                                         0.16s  
  ✓ multi level escalation email channel                                                                         0.14s  
  ✓ role based routing procurement lead                                                                          0.16s  
  ✓ threshold configuration sourcing vendor                                                                      0.16s  
  ✓ threshold configuration vendor negotiation                                                                   0.16s  
  ✓ notification dispatch on escalation                                                                          0.16s  
  ✓ job returns early if order not found                                                                         0.10s  
  ✓ job returns early if status mismatch                                                                         0.14s  
  ✓ escalation index null with threshold check                                                                   0.16s  
  ✓ multiple escalation levels triggered sequentially                                                            0.14s  
  ✓ sla metadata updated after job execution                                                                     0.14s  
  ✓ job handles in production state                                                                              0.14s  
  ✓ job handles quality check state                                                                              0.14s  
  ✓ sla not breached if within threshold                                                                         0.14s  
  ✓ tenant scoping respected in job                                                                              0.18s  

   PASS  Tests\Unit\Domain\Order\Listeners\EventListenersTest
  ✓ send vendor assignment email listener                                                                        0.15s  
  ✓ send quote request to vendor listener                                                                        0.14s  
  ✓ send quote approval to customer listener                                                                     0.14s  
  ✓ update inventory on order complete listener                                                                  0.14s  
  ✓ trigger invoice generation on payment received                                                               0.15s  
  ✓ trigger invoice generation on order completed                                                                0.14s  
  ✓ send shipping notification listener                                                                          0.13s  
  ✓ process order completion listener                                                                            0.15s  
  ✓ handle refund workflow listener                                                                              0.15s  
  ✓ listener handles missing customer gracefully                                                                 1.68s  
  ✓ listener handles missing vendor gracefully                                                                   0.31s  
  ✓ listener handles exceptions gracefully                                                                       0.16s  
  ✓ invoice number generation format                                                                             0.14s  
  ✓ refund updates order status                                                                                  0.17s  
  ✓ process order completion updates customer metrics                                                            0.18s  
  ✓ listeners maintain multi tenant isolation                                                                    0.22s  
  ✓ invoice generation idempotent                                                                                0.20s  

   PASS  Tests\Unit\Domain\Order\Notifications\NotificationPreferencesTest
  ✓ channel preference management whatsapp enabled                                                               0.18s  
  ✓ channel preference management sms enabled                                                                    0.15s  
  ✓ disabled channel filtering whatsapp                                                                          0.13s  
  ✓ disabled channel filtering sms                                                                               0.27s  
  ✓ disabled channel filtering multiple channels                                                                 0.19s  
  ✓ customer notification opt out complete disable                                                               0.13s  
  ✓ customer notification opt out via metadata                                                                   0.13s  
  ✓ phone number validation valid indonesian number                                                              0.13s  
  ✓ phone number validation international format                                                                 0.13s  
  ✓ phone number formatting local to international                                                               0.13s  
  ✓ phone number validation returns null for invalid                                                             0.14s  
  ✓ notification not sent when phone empty                                                                       0.13s  
  ✓ notification not sent when phone null                                                                        0.13s  
  ✓ whatsapp channel disabled by config                                                                          0.13s  
  ✓ sms channel disabled by config                                                                               0.13s  
  ✓ channel preference specific channels                                                                         0.15s  
  ✓ database notification channel always included                                                                0.16s  
  ✓ mail channel always included                                                                                 0.13s  
  ✓ multiple notification types respect preferences                                                              0.15s  
  ✓ metadata notification channels array                                                                         0.13s  
  ✓ fallback to default preferences when none set                                                                0.13s  
  ✓ preference priority metadata over preferences                                                                0.13s  
  ✓ sms payload contains phone number                                                                            0.14s  
  ✓ sms payload contains message body                                                                            0.16s  
  ✓ notification context includes order id                                                                       0.13s  
  ✓ notification context includes order number                                                                   0.14s  

   PASS  Tests\Unit\Domain\Order\Notifications\OrderNotificationChannelsTest
  ✓ via includes whatsapp and sms when enabled                                                                   0.12s  
  ✓ via excludes whatsapp when customer disables channel                                                         0.14s  
  ✓ whatsapp payload contains expected context                                                                   0.21s  

   PASS  Tests\Unit\Domain\Order\Services\OrderPaymentServiceTest
  ✓ record customer payment with valid amount                                                                    0.20s  
  ✓ record down payment detection                                                                                0.15s  
  ✓ record partial payment handling                                                                              0.15s  
  ✓ final payment detection when amount equals remaining                                                         0.16s  
  ✓ payment amount capped to remaining                                                                           0.18s  
  ✓ throw exception when order already paid                                                                      0.14s  
  ✓ throw exception with zero or negative amount                                                                 0.14s  
  ✓ payment method validation                                                                                    0.14s  
  ✓ duplicate payment prevention through reference                                                               0.15s  
  ✓ vendor disbursement recording                                                                                0.14s  
  ✓ multiple vendor disbursements                                                                                0.19s  
  ✓ throw exception when disbursing without vendor                                                               0.21s  
  ✓ throw exception with zero disbursement amount                                                                0.28s  
  ✓ payment metadata tracking                                                                                    0.16s  
  ✓ vendor disbursement metadata tracking                                                                        0.16s  
  ✓ payment with custom currency                                                                                 0.36s  
  ✓ payment with due date                                                                                        0.16s  
  ✓ down payment amount stored in order                                                                          0.15s  
  ✓ transaction tenant scoping                                                                                   0.14s  

   PASS  Tests\Unit\Domain\Order\Services\OrderStateMachineTest
  ✓ can transition from new to sourcing vendor                                                                   0.15s  
  ✓ cannot transition from new to completed                                                                      0.10s  
  ✓ cannot transition to same status                                                                             0.11s  
  ✓ get available transitions returns valid next states                                                          0.12s  
  ✓ validate transition requires vendor for negotiation                                                          0.12s  
  ✓ validate transition requires quotation amount                                                                0.13s  
  ✓ validate transition requires tracking number for shipped                                                     0.13s  
  ✓ validate transition requires cancellation reason                                                             0.22s  
  ✓ transition updates order status successfully                                                                 0.38s  
  ✓ transition throws exception for invalid transition                                                           0.13s  
  ✓ transition to payment received updates payment info                                                          0.18s  
  ✓ partial payment sets partially paid status                                                                   0.16s  
  ✓ additional payment during production completes balance                                                       0.26s  
  ✓ vendor disbursement is recorded during production transition                                                 0.17s  
  ✓ transition to shipped records tracking number                                                                0.16s  
  ✓ transition to cancelled stores reason in metadata                                                            0.13s  
  ✓ transition to vendor negotiation creates negotiation record                                                  0.22s  
  ✓ transition initializes sla timer for status with policy                                                      0.15s  
  ✓ transition records sla history and triggers escalation on breach                                             0.16s  
  ✓ initialize sla schedules monitor jobs                                                                        0.30s  
  ✓ sla escalation job updates metadata and dispatches event                                                     0.15s  
  ✓ sla threshold job marks breach and dispatches event                                                          0.20s  

   PASS  Tests\Unit\Domain\Order\Services\RefundCalculationEngineTest
  ✓ it calculates customer initiated pre production refund correctly                                             0.60s  
  ✓ it calculates customer initiated mid production refund correctly                                             0.17s  
  ✓ it calculates quality issue full refund with vendor liability                                                0.25s  
  ✓ it calculates partial quality issue refund correctly                                                         0.16s  
  ✓ it calculates vendor failure with full recovery                                                              0.15s  
  ✓ it calculates timeline delay compensation                                                                    0.14s  
  ✓ it calculates production error with company liability                                                        0.15s  
  ✓ it calculates production progress correctly                                                                  0.29s  
  ✓ it determines fault party correctly                                                                          0.22s  
  ✓ it applies insurance fund coverage for quality issues                                                        0.16s  
  ✓ it handles edge case zero amounts                                                                            0.15s  
  ✓ it validates calculation metadata                                                                            0.17s  
  ✓ it enforces business rule minimum refund zero                                                                0.17s  
  ✓ it calculates risk assessment based on amount and reason                                                     0.21s  

   PASS  Tests\Unit\Domain\Order\Services\VendorNegotiationServiceTest
  ✓ start negotiation creates new negotiation                                                                    0.17s  
  ✓ negotiation workflow open to countered                                                                       0.16s  
  ✓ round tracking in negotiation                                                                                0.16s  
  ✓ counter offer recording with history                                                                         0.16s  
  ✓ expiration enforcement                                                                                       0.15s  
  ✓ negotiation approved conclusion                                                                              0.16s  
  ✓ negotiation rejected conclusion                                                                              0.27s  
  ✓ negotiation expired conclusion                                                                               0.16s  
  ✓ negotiation cancelled conclusion                                                                             0.15s  
  ✓ throw exception for invalid conclusion status                                                                0.15s  
  ✓ throw exception when starting without vendor                                                                 0.14s  
  ✓ existing open negotiation returns without creating new                                                       0.16s  
  ✓ negotiation history audit trail                                                                              0.16s  
  ✓ negotiation terms tracking                                                                                   0.23s  
  ✓ order metadata updated during negotiation                                                                    0.31s  
  ✓ metadata updated after counter offer                                                                         0.16s  
  ✓ negotiation currency tracking                                                                                0.18s  
  ✓ multiple vendor negotiations on same order                                                                   0.16s  
  ✓ negotiation tenant scoping                                                                                   0.16s  
  ✓ history entry timestamp format                                                                               0.15s  
  ✓ negotiation conclusion with final amount                                                                     0.16s  

   PASS  Tests\Unit\Domain\Order\StateTransition\EdgeCaseTest
  ✓ invalid state transition from new to completed                                                               0.15s  
  ✓ invalid state transition from completed backward                                                             0.15s  
  ✓ invalid state transition to self                                                                             0.15s  
  ✓ concurrent transition attempts                                                                               0.17s  
  ✓ transition with missing required field                                                                       0.25s  
  ✓ transition with empty metadata                                                                               0.16s  
  ✓ transition with corrupted metadata                                                                           0.17s  
  ✓ rapid sequential transitions                                                                                 0.14s  
  ✓ transition with null vendor                                                                                  0.17s  
  ✓ transition with extreme currency values                                                                      0.19s  
  ✓ transition with zero amount                                                                                  0.17s  
  ✓ transition with negative amount                                                                              0.17s  
  ✓ rollback on transition failure                                                                               0.16s  
  ✓ validation error handling missing tracking number                                                            0.18s  
  ✓ validation error handling missing cancellation reason                                                        0.15s  
  ✓ order with special characters in metadata                                                                    0.14s  
  ✓ transition with unicode characters                                                                           0.15s  
  ✓ transition maintains timestamps                                                                              0.16s  
  ✓ transition with very old order                                                                               0.25s  
  ✓ transition with future timestamps                                                                            0.17s  
  ✓ cannot transition with invalid enum value                                                                    0.15s  
  ✓ get available transitions for all states                                                                     0.15s  
  ✓ state machine handles concurrent orders                                                                      0.19s  
  ✓ transition isolation between tenants                                                                         0.27s  
  ✓ transition with minimal metadata payload                                                                     0.16s  
  ✓ transition with deeply nested metadata                                                                       0.16s  
  ✓ validation with multiple errors                                                                              0.16s  

   PASS  Tests\Unit\Domain\Order\ValueObjects\OrderStatusTransitionTest
  ✓ can transition validates allowed transitions                                                                 0.10s  
  ✓ get required fields returns correct fields
  ✓ validate transition data identifies missing fields
  ✓ validate transition data passes with complete data
  ✓ validate payment type
  ✓ validate payment amount
  ✓ validate full payment
  ✓ validate pricing

   PASS  Tests\Unit\Domain\Product\Enums\ProductMaterialTest
  ✓ it has all expected material values                                                                          0.15s  
  ✓ it returns correct string values                                                                             0.11s  
  ✓ it returns correct display names                                                                             0.10s  
  ✓ it returns correct descriptions                                                                              0.13s  
  ✓ it returns correct pricing multipliers                                                                       0.13s  
  ✓ it identifies metal materials correctly                                                                      0.11s  
  ✓ it identifies plastic materials correctly                                                                    0.11s  
  ✓ it returns correct density values                                                                            0.10s  
  ✓ it returns correct melting points                                                                            0.21s  
  ✓ it returns correct hardness levels                                                                           0.12s  
  ✓ it returns correct corrosion resistance                                                                      0.12s  
  ✓ it returns correct workability levels                                                                        0.13s  
  ✓ it returns correct etching suitability                                                                       0.10s  
  ✓ it returns available thickness options                                                                       0.10s  
  ✓ it returns available finishes                                                                                0.10s  
  ✓ it calculates weight correctly                                                                               0.10s  
  ✓ it can be created from string                                                                                0.11s  
  ✓ it throws exception for invalid string                                                                       0.10s  
  ✓ it returns all materials as options                                                                          0.12s  
  ✓ it returns metal materials only                                                                              0.10s  
  ✓ it returns plastic materials only                                                                            0.10s  
  ✓ it returns materials suitable for etching                                                                    0.10s  
  ✓ it can compare materials by price                                                                            0.10s  
  ✓ it can get compatible finishes for material                                                                  0.10s  
  ✓ it validates thickness availability                                                                          0.10s  
  ✓ it validates finish availability                                                                             0.12s  

   PASS  Tests\Unit\Domain\Product\Enums\ProductQualityTest
  ✓ it has all expected quality values                                                                           0.12s  
  ✓ it returns correct string values                                                                             0.21s  
  ✓ it returns correct display names                                                                             0.10s  
  ✓ it returns correct descriptions                                                                              0.10s  
  ✓ it returns correct pricing multipliers                                                                       0.11s  
  ✓ it returns correct precision levels                                                                          0.10s  
  ✓ it returns correct surface finish quality                                                                    0.10s  
  ✓ it returns correct inspection levels                                                                         0.09s  
  ✓ it returns correct lead times                                                                                0.10s  
  ✓ it returns correct minimum order quantities                                                                  0.10s  
  ✓ it returns available finishes per quality                                                                    0.10s  
  ✓ it returns correct quality certifications                                                                    0.12s  
  ✓ it checks if requires special tooling                                                                        0.10s  
  ✓ it checks if requires quality approval                                                                       0.14s  
  ✓ it checks if includes documentation                                                                          0.16s  
  ✓ it returns correct etching depth precision                                                                   0.11s  
  ✓ it returns correct edge quality levels                                                                       0.12s  
  ✓ it calculates price with multiplier                                                                          0.11s  
  ✓ it can be created from string                                                                                0.12s  
  ✓ it throws exception for invalid string                                                                       0.17s  
  ✓ it returns all qualities as options                                                                          0.15s  
  ✓ it can compare quality levels                                                                                0.10s  
  ✓ it can check if is lower quality                                                                             0.10s  
  ✓ it returns quality level numeric value                                                                       0.10s  
  ✓ it can sort qualities by level                                                                               0.10s  
  ✓ it returns qualities above level                                                                             0.12s  
  ✓ it returns qualities below level                                                                             0.10s  
  ✓ it calculates quality upgrade cost                                                                           0.10s  
  ✓ it returns compatible materials per quality                                                                  0.10s  
  ✓ it checks if quality is suitable for application                                                             0.11s  
  ✓ it returns recommended applications                                                                          0.12s  

   PASS  Tests\Unit\Domain\Product\ProductCategoryEntityTest
  ✓ it can be created with valid data                                                                            0.19s  
  ✓ it can be created as child category                                                                          0.14s  
  ✓ it can update basic information                                                                              0.13s  
  ✓ it can be activated and deactivated                                                                          0.14s  
  ✓ it can be featured and unfeatured                                                                            0.15s  
  ✓ it can toggle menu visibility                                                                                0.13s  
  ✓ it can set allowed materials                                                                                 0.10s  
  ✓ it can set quality levels                                                                                    0.12s  
  ✓ it can set customization options                                                                             0.10s  
  ✓ it can update sort order                                                                                     0.10s  
  ✓ it can set media information                                                                                 0.10s  
  ✓ it can set seo information                                                                                   0.10s  
  ✓ it can set pricing configuration                                                                             0.10s  
  ✓ it validates markup percentage range                                                                         0.10s  
  ✓ it can check if has etching materials                                                                        0.12s  
  ✓ it can get hierarchy path                                                                                    0.10s  
  ✓ it can convert to array                                                                                      0.10s  
  ✓ it generates correct breadcrumb                                                                              0.10s  
  ✓ it validates parent relationship prevents circular reference                                                 0.10s  

   PASS  Tests\Unit\Domain\Product\ProductVariantEntityTest
  ✓ it can be created with valid data                                                                            0.11s  
  ✓ it generates sku automatically                                                                               0.13s  
  ✓ it can update pricing information                                                                            0.10s  
  ✓ it calculates profit margin correctly                                                                        0.10s  
  ✓ it handles zero base price for profit margin                                                                 0.10s  
  ✓ it can update stock quantity                                                                                 0.10s  
  ✓ it can increase stock                                                                                        0.10s  
  ✓ it can decrease stock                                                                                        0.10s  
  ✓ it prevents negative stock decrease                                                                          0.12s  
  ✓ it can set low stock threshold                                                                               0.10s  
  ✓ it can check stock status                                                                                    0.22s  
  ✓ it can set dimensions                                                                                        0.10s  
  ✓ it validates positive dimensions                                                                             0.10s  
  ✓ it can set weight                                                                                            0.22s  
  ✓ it validates positive weight                                                                                 0.10s  
  ✓ it can be activated and deactivated                                                                          0.12s  
  ✓ it can set custom sku                                                                                        0.10s  
  ✓ it validates unique sku format                                                                               0.10s  
  ✓ it can set etching specifications                                                                            0.10s  
  ✓ it can check material properties                                                                             0.10s  
  ✓ it can check quality level                                                                                   0.13s  
  ✓ it applies material and quality pricing multipliers                                                          0.11s  
  ✓ it can convert to array                                                                                      0.14s  
  ✓ it generates variant display name                                                                            0.10s  

   PASS  Tests\Unit\Domain\Product\ValueObjects\ProductCategoryNameTest
  ✓ it can be created with valid name                                                                            0.12s  
  ✓ it trims whitespace from name                                                                                0.10s  
  ✓ it validates minimum length                                                                                  0.10s  
  ✓ it validates maximum length                                                                                  0.11s  
  ✓ it rejects empty name                                                                                        0.10s  
  ✓ it rejects only whitespace name                                                                              0.10s  
  ✓ it allows valid special characters                                                                           0.10s  
  ✓ it rejects invalid special characters                                                                        0.10s  
  ✓ it allows unicode characters                                                                                 0.22s  
  ✓ it handles mixed case properly                                                                               0.11s  
  ✓ it can check equality                                                                                        0.10s  
  ✓ it is case sensitive for equality                                                                            0.12s  
  ✓ it can generate slug suggestion                                                                              0.20s  
  ✓ it handles unicode in slug generation                                                                        0.10s  
  ✓ it can check if contains etching keywords                                                                    0.10s  
  ✓ it can get character count                                                                                   0.10s  
  ✓ it can get word count                                                                                        0.20s  
  ✓ it can convert to title case                                                                                 0.10s  
  ✓ it can truncate with ellipsis                                                                                0.12s  
  ✓ it does not truncate short names                                                                             0.10s  
  ✓ it can check if contains word                                                                                0.10s  

   PASS  Tests\Unit\Domain\Product\ValueObjects\ProductCategorySlugTest
  ✓ it can be created with valid slug                                                                            0.11s  
  ✓ it validates minimum length                                                                                  0.10s  
  ✓ it validates maximum length                                                                                  0.11s  
  ✓ it rejects empty slug                                                                                        0.10s  
  ✓ it rejects slug with spaces                                                                                  0.10s  
  ✓ it rejects slug with uppercase letters                                                                       0.09s  
  ✓ it rejects slug with special characters                                                                      0.10s  
  ✓ it allows valid slug formats                                                                                 0.10s  
  ✓ it rejects slug starting with hyphen                                                                         0.10s  
  ✓ it rejects slug ending with hyphen                                                                           0.10s  
  ✓ it rejects slug with consecutive hyphens                                                                     0.12s  
  ✓ it can check equality                                                                                        0.10s  
  ✓ it can generate from name                                                                                    0.20s  
  ✓ it handles unicode characters in generation                                                                  0.10s  
  ✓ it removes stopwords when generating from name                                                               0.10s  
  ✓ it can get parent slug from path                                                                             0.10s  
  ✓ it can check if etching related                                                                              0.10s  
  ✓ it can check if material related                                                                             0.12s  
  ✓ it can get slug depth                                                                                        0.10s  
  ✓ it can append suffix                                                                                         0.09s  
  ✓ it validates suffix format                                                                                   0.10s  
  ✓ it can prepend prefix                                                                                        0.10s  
  ✓ it validates prefix format                                                                                   0.10s  
  ✓ it can check if contains word                                                                                0.10s  
  ✓ it generates unique variation                                                                                0.12s  
  ✓ it returns original if no conflicts                                                                          0.10s  

   PASS  Tests\Unit\Domain\TenantEntityTest
  ✓ it can be created with valid data                                                                            0.31s  
  ✓ it can be activated                                                                                          0.10s  
  ✓ it can be suspended                                                                                          0.10s  
  ✓ it can start trial                                                                                           0.11s  
  ✓ it can end trial                                                                                             0.10s  
  ✓ it can update subscription                                                                                   0.10s  
  ✓ it can expire subscription                                                                                   0.10s  
  ✓ it can set custom domain                                                                                     0.20s  
  ✓ it can remove custom domain                                                                                  0.10s  
  ✓ it generates correct public url with custom domain                                                           0.10s  
  ✓ it generates correct public url with slug                                                                    0.12s  
  ✓ it generates correct admin url                                                                               0.10s  
  ✓ it can check if subscription is active                                                                       0.19s  
  ✓ it validates trial status correctly                                                                          0.10s  
  ✓ it can convert to array                                                                                      0.10s  

   PASS  Tests\Unit\Domain\Vendor\Services\VendorClassificationServiceTest
  ✓ classifies vendor as small with low orders                                                                   0.01s  
  ✓ classifies vendor as medium with moderate orders
  ✓ classifies vendor as large with high orders
  ✓ classifies vendor as small when total orders is null
  ✓ uses custom thresholds
  ✓ boundary case medium threshold
  ✓ boundary case large threshold
  ✓ just below medium threshold
  ✓ just below large threshold
  ✓ get default thresholds
  ✓ set and get custom thresholds
  ✓ classify multiple vendors
  ✓ get classification stats
  ✓ classification stats with empty vendors
  ✓ edge case zero orders
  ✓ edge case negative orders treated as small
  ✓ edge case very large order count
  ✓ custom threshold overrides only specified values
  ✓ set thresholds persists across multiple calls
  ✓ classify multiple vendors includes threshold info
  ✓ classification stats calculates correct percentages with uneven distribution
  ✓ multiple vendors with same order count

   PASS  Tests\Unit\Domain\Vendor\Services\VendorPerformanceTest
  ✓ vendor sla compliance tracking                                                                               0.29s  
  ✓ quality score calculation                                                                                    0.23s  
  ✓ on time delivery metrics                                                                                     0.24s  
  ✓ rating updates                                                                                               0.34s  
  ✓ performance ranking                                                                                          0.57s  
  ✓ top performing vendors                                                                                       2.36s  
  ✓ underperforming vendors identification                                                                       0.36s  
  ✓ vendor trend analysis                                                                                        0.29s  
  ✓ vendor comparison                                                                                            0.43s  
  ✓ sla metrics calculation                                                                                      0.21s  
  ✓ sla compliance rate                                                                                          0.23s  
  ✓ sla status determination                                                                                     0.26s  
  ✓ sla violations identification                                                                                0.18s  
  ✓ vendor evaluation includes all metrics                                                                       0.24s  
  ✓ vendor evaluation score range                                                                                0.24s  
  ✓ performance recommendations generation                                                                       0.31s  
  ✓ vendor reliability score calculation                                                                         0.29s  
  ✓ price competitiveness scoring                                                                                0.23s  
  ✓ response time scoring                                                                                        0.26s  
  ✓ empty vendor evaluation                                                                                      0.14s  
  ✓ trend summary calculation                                                                                    0.28s  
  ✓ tenant scoping in evaluation                                                                                 0.36s  

   PASS  Tests\Unit\ExampleTest
  ✓ that true is true                                                                                            0.03s  

   PASS  Tests\Unit\Http\Controllers\Platform\AuthControllerTest
  ✓ it can authenticate platform account with valid credentials                                                  0.80s  
  ✓ it rejects invalid credentials                                                                               0.15s  
  ✓ it rejects non existent account                                                                              0.11s  
  ✓ it rejects inactive account                                                                                  0.12s  
  ✓ it validates required fields                                                                                 0.17s  
  ✓ it validates email format                                                                                    0.22s  
  ✓ it enforces rate limiting                                                                                    0.15s  
  ✓ it can logout successfully                                                                                   0.23s  
  ✓ it can get authenticated user info                                                                           0.13s  
  ✓ it requires authentication for protected endpoints                                                           0.15s  
  ✓ it rejects invalid tokens                                                                                    0.12s  
  ✓ it handles suspended account login                                                                           0.12s  
  ✓ it updates last login timestamp on successful authentication                                                 0.12s  
  ✓ it includes proper expiration time                                                                           0.12s  
  ✓ it includes bearer token type                                                                                0.13s  

   PASS  Tests\Unit\Http\Controllers\Tenant\AuthControllerTest
  ✓ it can authenticate tenant user with valid credentials                                                       0.24s  
  ✓ it rejects invalid credentials                                                                               0.24s  
  ✓ it rejects non existent user                                                                                 0.14s  
  ✓ it rejects user from wrong tenant                                                                            0.20s  
  ✓ it rejects inactive tenant                                                                                   0.17s  
  ✓ it rejects expired subscription                                                                              0.14s  
  ✓ it rejects inactive user                                                                                     0.17s  
  ✓ it validates required fields                                                                                 0.16s  
  ✓ it validates tenant context required                                                                         0.26s  
  ✓ it validates email format                                                                                    0.13s  
  ✓ it enforces rate limiting per tenant                                                                         0.17s  
  ✓ it can logout successfully                                                                                   0.17s  
  ✓ it can get authenticated user info                                                                           0.16s  
  ✓ it includes user permissions in response                                                                     0.15s  
  ✓ it handles suspended user login                                                                              0.14s  
  ✓ it prevents login to trial expired tenant                                                                    0.13s  
  ✓ it allows login to active trial tenant                                                                       0.15s  
  ✓ it includes tenant context in response                                                                       0.16s  

   PASS  Tests\Unit\Http\Middleware\PlatformAccessMiddlewareTest
  ✓ it allows authenticated platform account                                                                     0.13s  
  ✓ it rejects unauthenticated requests                                                                          0.10s  
  ✓ it rejects tenant user accessing platform routes                                                             0.12s  
  ✓ it rejects inactive platform account                                                                         0.12s  
  ✓ it rejects suspended platform account                                                                        0.11s  
  ✓ it allows different platform account types                                                                   0.11s  
  ✓ it handles invalid token gracefully                                                                          0.10s  
  ✓ it sets correct guard context                                                                                0.11s  
  ✓ it logs security events                                                                                      0.10s  

   PASS  Tests\Unit\Http\Middleware\TenantContextMiddlewareTest
  ✓ it identifies tenant from subdomain                                                                          0.14s  
  ✓ it identifies tenant from custom domain                                                                      0.11s  
  ✓ it identifies tenant from path parameter                                                                     0.12s  
  ✓ it rejects request for nonexistent tenant                                                                    0.12s  
  ✓ it rejects request for inactive tenant                                                                       0.12s  
  ✓ it rejects request for expired subscription                                                                  0.12s  
  ✓ it allows trial tenant within trial period                                                                   0.13s  
  ✓ it rejects expired trial tenant                                                                              0.12s  
  ✓ it enforces tenant scoped authentication                                                                     0.13s  
  ✓ it rejects user from different tenant                                                                        0.12s  
  ✓ it sets tenant context in application                                                                        0.12s  
  ✓ it handles suspended tenant                                                                                  0.12s  
  ✓ it prioritizes custom domain over subdomain                                                                  0.13s  
  ✓ it handles www prefix in custom domain                                                                       0.12s  

   PASS  Tests\Unit\Infrastructure\Product\Models\ProductCategoryModelTest
  ✓ it has correct fillable attributes                                                                           0.27s  
  ✓ it casts attributes correctly                                                                                0.17s  
  ✓ it can create product category with basic attributes                                                         0.13s  
  ✓ it auto generates uuid on creation                                                                           0.25s  
  ✓ it updates hierarchy when parent changes                                                                     0.15s  
  ✓ it has tenant relationship                                                                                   0.16s  
  ✓ it has parent relationship                                                                                   0.14s  
  ✓ it has children relationship                                                                                 0.13s  
  ✓ it has descendants relationship                                                                              0.15s  
  ✓ it has products relationship                                                                                 0.15s  
  ✓ it scopes active categories                                                                                  0.16s  
  ✓ it scopes featured categories                                                                                0.13s  
  ✓ it scopes root categories                                                                                    0.12s  
  ✓ it scopes categories by level                                                                                0.12s  
  ✓ it scopes categories shown in menu                                                                           0.12s  
  ✓ it scopes ordered categories                                                                                 0.14s  
  ✓ it checks if category has children                                                                           0.14s  
  ✓ it checks if category has products                                                                           0.17s  
  ✓ it generates full path                                                                                       0.15s  
  ✓ it generates breadcrumb                                                                                      0.14s  
  ✓ it stores allowed materials as array                                                                         0.14s  
  ✓ it stores quality levels as array                                                                            0.14s  
  ✓ it stores customization options as array                                                                     0.14s  
  ✓ it stores seo keywords as array                                                                              0.14s  
  ✓ it casts base markup percentage as decimal                                                                   0.14s  
  ✓ it uses soft deletes                                                                                         0.19s  

   PASS  Tests\Unit\Infrastructure\Product\Models\ProductVariantModelTest
  ✓ it has correct fillable attributes                                                                           0.17s  
  ✓ it casts attributes correctly                                                                                0.13s  
  ✓ it can create product variant with basic attributes                                                          0.34s  
  ✓ it auto generates uuid on creation                                                                           0.16s  
  ✓ it has tenant relationship                                                                                   0.10s  
  ✓ it has category relationship                                                                                 0.10s  
  ✓ it scopes active variants                                                                                    0.16s  
  ✓ it scopes variants by material                                                                               0.15s  
  ✓ it scopes variants by quality                                                                                0.19s  
  ✓ it scopes variants in stock                                                                                  0.30s  
  ✓ it scopes variants out of stock                                                                              0.26s  
  ✓ it scopes variants low stock                                                                                 0.17s  
  ✓ it scopes variants by price range                                                                            0.15s  
  ✓ it checks if variant has stock                                                                               0.17s  
  ✓ it checks if variant is low stock                                                                            0.16s  
  ✓ it calculates profit margin                                                                                  0.16s  
  ✓ it handles zero base price in margin calculation                                                             0.14s  
  ✓ it calculates dimensions                                                                                     0.15s  
  ✓ it generates display name                                                                                    0.15s  
  ✓ it stores etching specifications as array                                                                    0.15s  
  ✓ it casts prices as decimal                                                                                   0.15s  
  ✓ it casts dimensions as decimal                                                                               0.16s  
  ✓ it uses soft deletes                                                                                         0.15s  
  ✓ it maintains category relationship                                                                           0.15s  

   PASS  Tests\Unit\Infrastructure\Product\ProductCategoryEloquentRepositoryTest
  ✓ it can save product category                                                                                 0.23s  
  ✓ it can find category by id                                                                                   0.12s  
  ✓ it returns null when category not found by id                                                                0.11s  
  ✓ it can find category by slug                                                                                 0.12s  
  ✓ it returns null when category not found by slug                                                              0.21s  
  ✓ it can find root categories                                                                                  0.14s  
  ✓ it can find children categories                                                                              0.15s  
  ✓ it can find active categories                                                                                0.13s  
  ✓ it can find featured categories                                                                              0.14s  
  ✓ it can find categories by material                                                                           0.13s  
  ✓ it can find categories by level                                                                              0.14s  
  ✓ it can search categories by name                                                                             0.13s  
  ✓ it can count categories by tenant                                                                            0.13s  
  ✓ it can check if slug exists                                                                                  0.12s  
  ✓ it can get category hierarchy                                                                                0.15s  
  ✓ it can delete category                                                                                       0.13s  
  ✓ it returns false when deleting non existent category                                                         0.11s  
  ✓ it can update category                                                                                       0.13s  
  ✓ it maintains tenant isolation                                                                                0.13s  
  ✓ it can find categories with pagination                                                                       0.20s  
  ✓ it can find categories with sorting                                                                          0.18s  

   PASS  Tests\Unit\Infrastructure\Product\ProductVariantEloquentRepositoryTest
  ✓ it can save product variant                                                                                  0.29s  
  ✓ it can find variant by id                                                                                    0.18s  
  ✓ it returns null when variant not found by id                                                                 0.13s  
  ✓ it can find variant by sku                                                                                   0.23s  
  ✓ it returns null when variant not found by sku                                                                0.12s  
  ✓ it can find variant by category material quality                                                             0.17s  
  ✓ it can find variants by category                                                                             0.18s  
  ✓ it can find variants by material                                                                             0.20s  
  ✓ it can find variants by quality                                                                              0.20s  
  ✓ it can find active variants                                                                                  0.18s  
  ✓ it can find variants in stock                                                                                0.20s  
  ✓ it can find low stock variants                                                                               0.18s  
  ✓ it can find variants by price range                                                                          0.20s  
  ✓ it can update stock quantity                                                                                 0.18s  
  ✓ it can increase stock                                                                                        0.17s  
  ✓ it can decrease stock                                                                                        0.17s  
  ✓ it can update pricing                                                                                        0.18s  
  ✓ it can count variants by tenant                                                                              0.19s  
  ✓ it can count variants by category                                                                            0.18s  
  ✓ it can check if sku exists                                                                                   0.17s  
  ✓ it can delete variant                                                                                        0.16s  
  ✓ it returns false when deleting non existent variant                                                          0.10s  
  ✓ it maintains tenant isolation                                                                                0.19s  
  ✓ it can find variants with pagination                                                                         0.41s  
  ✓ it can find variants with sorting                                                                            0.19s  
  ✓ it can search variants                                                                                       0.19s  
  ✓ it can get stock summary                                                                                     0.19s  

   PASS  Tests\Unit\Infrastructure\TenantAware\TenantAwareTraitTest
  ✓ customer model implements tenant aware interface                                                             0.19s  
  ✓ it returns correct tenant id                                                                                 0.17s  
  ✓ it has tenant relationship                                                                                   0.13s  
  ✓ it scopes to current tenant                                                                                  0.15s  
  ✓ it scopes to specific tenant                                                                                 0.22s  
  ✓ it checks belongs to current tenant                                                                          0.17s  
  ✓ it checks belongs to specific tenant                                                                         0.13s  
  ✓ it auto assigns tenant id on creation                                                                        0.12s  
  ✓ global scope filters by tenant automatically                                                                 0.13s  
  ✓ can query across tenants with scope removal                                                                  0.14s  
  ✓ uuid field is auto generated                                                                                 0.17s  

   PASS  Tests\Unit\Services\Auth\JwtServiceTest
  ✓ it can generate jwt token for platform account                                                               0.16s  
  ✓ it can generate jwt token for tenant user                                                                    0.15s  
  ✓ it fails authentication with invalid platform credentials                                                    0.26s  
  ✓ it fails authentication with invalid tenant credentials                                                      0.20s  
  ✓ it fails authentication for inactive platform account                                                        0.17s  
  ✓ it fails authentication for inactive tenant                                                                  0.14s  
  ✓ it fails authentication for expired tenant subscription                                                      0.14s  
  ✓ it prevents cross tenant authentication                                                                      0.14s  
  ✓ it includes proper user permissions in token                                                                 0.21s  
  ✓ platform and tenant tokens have different structures                                                         0.18s  
  ✓ it handles case insensitive email lookup                                                                     0.17s  
  ✓ it validates nonexistent email                                                                               0.16s  
  ✓ it validates nonexistent tenant                                                                              0.16s  
  ✓ it includes proper token expiration times                                                                    0.20s  
  ✓ it includes account type in response                                                                         0.20s  
  ✓ it includes bearer token type                                                                                0.17s  

   PASS  Tests\Feature\Api\Public\ProductDataCompletenessTest
  ✓ product resource returns uuid not integer id                                                                 0.29s  
  ✓ product list returns uuid as id field                                                                        0.44s  
  ✓ type filter returns products with matching business type                                                     0.27s  
  ✓ size filter returns products with matching size                                                              0.36s  
  ✓ category filter returns correct products                                                                     0.28s  
  ✓ product resource includes all required fields                                                                0.30s  
  ✓ material filter returns products with matching material                                                      0.21s  
  ✓ multiple filters work together                                                                               0.17s  
  ✓ search works with product name and description                                                               0.20s  

   PASS  Tests\Feature\Api\Public\PublicProductsReviewAggregationTest
  ✓ it includes review summary in product list                                                                   0.39s  
  ✓ it returns zero rating for products without reviews                                                          0.15s  
  ✓ it only counts approved reviews                                                                              0.21s  
  ✓ it filters by minimum rating using aggregated data                                                           0.24s  
  ✓ it includes review summary in featured products                                                              0.19s  
  ✓ it includes review summary in search results                                                                 0.17s  

   PASS  Tests\Feature\Api\Public\PublicProductsTest
  ✓ it returns paginated products                                                                                0.24s  
  ✓ it filters products by search                                                                                0.16s  
  ✓ it filters products by type                                                                                  0.15s  
  ✓ it sorts products by name                                                                                    0.20s  
  ✓ it sorts products by price                                                                                   0.19s  
  ✓ it only returns published products                                                                           0.17s  
  ✓ it filters by minimum rating                                                                                 0.60s  
  ✓ it filters by stock availability                                                                             0.17s  
  ✓ it filters by price range                                                                                    0.15s  
  ✓ it exposes uuid not integer id                                                                               0.14s  
  ✓ it filters by featured status                                                                                0.15s  
  ✓ it returns empty array when no products found                                                                0.13s  
  ✓ it validates pagination parameters                                                                           0.11s  
  ✓ it validates rating parameter                                                                                0.17s  

   PASS  Tests\Feature\Api\RefundManagementApiTest
  ✓ create refund request success                                                                                0.49s  
  ✓ create quality issue refund                                                                                  0.17s  
  ✓ create refund request validation errors                                                                      0.19s  
  ✓ create refund unauthorized                                                                                   0.15s  
  ✓ list refund requests                                                                                         0.24s  
  ✓ list refunds with filters                                                                                    0.19s  
  ✓ search refunds                                                                                               0.19s  
  ✓ get refund request details                                                                                   0.20s  
  ✓ get nonexistent refund request                                                                               0.15s  
  ✓ update refund request                                                                                        0.17s  
  ✓ cannot update approved refund                                                                                0.17s  
  ✓ submit approval decision                                                                                     0.22s  
  ✓ reject refund request                                                                                        0.21s  
  ✓ unauthorized approval                                                                                        0.17s  
  ✓ get approval history                                                                                         0.23s  
  ✓ get refund statistics                                                                                        0.23s  
  ✓ invalid order id                                                                                             0.18s  
  ✓ order not eligible for refund                                                                                0.20s  
  ✓ duplicate refund request                                                                                     0.22s  
  ✓ refunds pagination                                                                                           0.44s  
  ✓ refunds sorting                                                                                              0.19s  

   PASS  Tests\Feature\Auth\EmailVerificationTest
  ✓ can send verification email for tenant user                                                                  0.28s  
  ✓ can send verification email for platform user                                                                0.14s  
  ✓ can verify email with valid token                                                                            0.13s  
  ✓ cannot verify email with invalid token                                                                       0.12s  
  ✓ cannot verify email with expired token                                                                       0.12s  
  ✓ cannot verify already verified token                                                                         0.12s  
  ✓ can resend verification email                                                                                0.13s  
  ✓ cannot resend verification if already verified                                                               0.13s  
  ✓ rate limiting prevents frequent resend requests                                                              0.12s  
  ✓ can check email verification status                                                                          0.12s  
  ✓ cleanup expired tokens                                                                                       0.13s  
  ✓ send tenant verification api endpoint                                                                        0.18s  
  ✓ send platform verification api endpoint                                                                      0.13s  
  ✓ verify email api endpoint                                                                                    0.14s  
  ✓ check verification status api endpoint                                                                       0.13s  
  ✓ api validation errors                                                                                        0.13s  

   PASS  Tests\Feature\Auth\PasswordResetTest
  ✓ tenant user can request password reset                                                                       0.46s  
  ✓ platform user can request password reset                                                                     0.14s  
  ✓ tenant user can reset password with valid token                                                              0.30s  
  ✓ platform user can reset password with valid token                                                            0.16s  
  ✓ reset fails with invalid token                                                                               0.14s  
  ✓ reset fails with mismatched passwords                                                                        0.14s  
  ✓ rate limiting prevents spam requests                                                                         0.15s  
  ✓ token validation works correctly                                                                             0.22s  
  ✓ expired tokens are rejected                                                                                  0.20s  
  ✓ nonexistent email returns same response for security                                                         0.15s  

   PASS  Tests\Feature\Auth\SimpleEmailVerificationTest
  ✓ simple mail sending                                                                                          0.22s  
  ✓ service sends email                                                                                          0.20s  

   PASS  Tests\Feature\Auth\UserRegistrationTest
  ✓ can register tenant user                                                                                     0.29s  
  ✓ can register platform account                                                                                0.26s  
  ✓ can register tenant with admin                                                                               0.14s  
  ✓ cannot register duplicate tenant user email                                                                  0.12s  
  ✓ cannot register duplicate platform account email                                                             0.21s  
  ✓ can check email availability                                                                                 0.13s  
  ✓ tenant user limit enforcement                                                                                0.14s  
  ✓ get registration stats                                                                                       0.13s  
  ✓ validation rules                                                                                             0.11s  
  ✓ tenant user registration api                                                                                 0.20s  
  ✓ platform account registration api                                                                            0.14s  
  ✓ tenant with admin registration api                                                                           0.15s  
  ✓ check email availability api                                                                                 0.14s  
  ✓ get registration stats api                                                                                   0.13s  
  ✓ api validation errors                                                                                        0.12s  

   WARN  Tests\Feature\Authentication\DataIsolationInfrastructureTest
  ✓ tenant can only access own customers                                                                         0.46s  
  ✓ tenant cannot access other tenant customers                                                                  0.25s  
  ✓ tenant can only access own products                                                                          0.20s  
  ✓ tenant cannot access other tenant products                                                                   0.20s  
  ✓ tenant can only access own orders                                                                            0.50s  
  ✓ tenant cannot access other tenant orders                                                                     0.31s  
  ✓ tenant can only access own vendors                                                                           0.34s  
  ✓ tenant cannot access other tenant vendors                                                                    0.22s  
  ✓ platform account cannot access tenant specific data                                                          0.20s  
  ✓ platform account can access platform specific data                                                           0.24s  
  ✓ tenant cannot create data for other tenants                                                                  0.33s  
  ✓ tenant cannot update data from other tenants                                                                 0.31s  
  ✓ tenant cannot delete data from other tenants                                                                 0.19s  
  - api endpoint segregation is enforced → Sanctum token resolution issue - platform access control works in pr… 1.03s  
  ✓ middleware prevents tenant context manipulation                                                              0.19s  
  - database schema isolation prevents cross tenant queries → Known issue with tenant scope caching in test env… 0.14s  

   PASS  Tests\Feature\Authentication\PlatformAuthenticationFlowTest
  ✓ complete platform authentication flow works                                                                  0.27s  
  ✓ platform manager has limited permissions                                                                     0.15s  
  ✓ rate limiting prevents brute force attacks                                                                   0.16s  
  ✓ inactive account cannot login                                                                                0.14s  
  ✓ suspended account cannot login                                                                               0.13s  
  ✓ last login timestamp is updated                                                                              0.17s  
  ✓ token refresh works                                                                                          0.17s  
  ✓ invalid email format is rejected                                                                             0.17s  
  ✓ empty credentials are rejected                                                                               0.12s  
  ✓ case insensitive email login works                                                                           0.14s  
  ✓ concurrent logins are allowed                                                                                0.18s  

   WARN  Tests\Feature\Authentication\PlatformTenantContextSeparationTest
  ✓ platform authentication returns platform context                                                             0.14s  
  ✓ tenant authentication returns tenant context                                                                 0.14s  
  ✓ platform token cannot access tenant endpoints                                                                0.14s  
  ✓ tenant token cannot access platform endpoints                                                                0.29s  
  ✓ platform me endpoint returns platform account info                                                           0.28s  
  ✓ tenant me endpoint returns tenant user info                                                                  0.16s  
  ✓ authentication contexts are completely isolated                                                              0.18s  
  ✓ cross authentication attempts are rejected                                                                   0.13s  
  - platform logout invalidates platform token only → Sanctum test environment limitation - token caching acros… 0.12s  
  - tenant logout invalidates tenant token only → Sanctum test environment limitation - token caching across re… 0.11s  
  - token validation respects context boundaries → Sanctum test environment limitation - token caching across r… 0.14s  

   WARN  Tests\Feature\Authentication\RoutingAndMiddlewareTest
  ✓ platform routes are properly structured                                                                      0.16s  
  ✓ tenant routes are properly structured                                                                        0.14s  
  ✓ platform routes require platform authentication                                                              0.27s  
  ✓ tenant routes require tenant authentication                                                                  0.24s  
  ✓ platform middleware validates account type                                                                   0.19s  
  ✓ tenant middleware validates account type                                                                     0.19s  
  ✓ tenant middleware enforces tenant context                                                                    0.29s  
  ✓ cors headers are properly set                                                                                0.16s  
  - rate limiting is applied per context → Sanctum token resolution issue in test environment - production work… 0.24s  
  ✓ route model binding respects tenant scope                                                                    0.32s  
  ✓ api versioning is consistent                                                                                 0.11s  
  ✓ options requests are handled for cors                                                                        0.12s  
  ✓ content type validation is enforced                                                                          0.12s  
  ✓ middleware execution order is correct                                                                        0.16s  
  ✓ error responses maintain context separation                                                                  0.15s  
"Permissions received:" // tests\Feature\Authentication\TenantAuthenticationFlowTest.php:182
array:17 [
  0 => "dashboard.read"
  1 => "products.create"
  2 => "products.read"
  3 => "products.update"
  4 => "products.delete"
  5 => "orders.create"
  6 => "orders.read"
  7 => "orders.update"
  8 => "orders.delete"
  9 => "customers.create"
  10 => "customers.read"
  11 => "customers.update"
  12 => "customers.delete"
  13 => "users.create"
  14 => "users.read"
  15 => "users.update"
  16 => "users.delete"
] // tests\Feature\Authentication\TenantAuthenticationFlowTest.php:182

   PASS  Tests\Feature\Authentication\TenantAuthenticationFlowTest
  ✓ complete tenant authentication flow works                                                                    0.32s  
  ✓ manager has limited permissions                                                                              0.20s  
  ✓ sales user has minimal permissions                                                                           0.21s  
  ✓ cross tenant authentication is prevented                                                                     0.20s  
  ✓ inactive tenant prevents login                                                                               0.23s  
  ✓ expired subscription prevents login                                                                          0.21s  
  ✓ trial period allows login                                                                                    0.18s  
  ✓ expired trial prevents login                                                                                 0.17s  
  ✓ context based login works                                                                                    0.26s  
  ✓ rate limiting is per tenant                                                                                  0.22s  
  ✓ inactive user cannot login                                                                                   0.18s  
  ✓ suspended user cannot login                                                                                  0.14s  
  ✓ last login timestamp is updated                                                                              0.16s  
  ✓ user with multiple roles gets combined permissions                                                           0.20s  

   PASS  Tests\Feature\ExampleTest
  ✓ the application returns a successful response                                                                2.28s  

   PASS  Tests\Feature\Notifications\MultiChannelDeliveryTest
  ✓ email fallback when sms fails                                                                                0.24s  
  ✓ email fallback when whatsapp fails                                                                           0.13s  
  ✓ retry logic for failed deliveries                                                                            0.15s  
  ✓ rate limiting per channel whatsapp                                                                           0.15s  
  ✓ rate limiting per channel sms                                                                                0.29s  
  ✓ batch notification sending                                                                                   0.25s  
  ✓ multi channel delivery all channels enabled                                                                  0.22s  
  ✓ multi channel delivery whatsapp only                                                                         0.15s  
  ✓ multi channel delivery sms only                                                                              0.14s  
  ✓ multi channel delivery no sms channels                                                                       0.14s  
  ✓ channel priority order                                                                                       0.16s  
  ✓ notification delivery tracking                                                                               0.26s  
  ✓ different notification types multi channel                                                                   0.13s  
  ✓ whatsapp payload structure                                                                                   0.14s  
  ✓ sms payload structure                                                                                        0.13s  
  ✓ email payload structure                                                                                      0.23s  
  ✓ database notification structure                                                                              0.15s  
  ✓ fallback to email when phone invalid                                                                         0.14s  
  ✓ channel delivery with customer preferences                                                                   0.14s  
  ✓ retry on transient failure                                                                                   0.14s  
  ✓ batch delivery performance                                                                                   1.11s  
  ✓ notification queuing                                                                                         0.26s  
  ✓ multiple customers batch delivery                                                                            0.26s  
  ✓ channel disable preserves others                                                                             0.16s  
  ✓ rollout new notification channel                                                                             0.17s  
  ✓ gradual channel migration                                                                                    0.20s  

   PASS  Tests\Feature\Order\CompleteOrderLifecycleTest
  ✓ complete order workflow from creation to completion                                                          0.58s  
  ✓ order can be cancelled at pending stage                                                                      0.24s  
  ✓ order can be cancelled after approval                                                                        0.34s  
  ✓ multiple products in single order                                                                            0.25s  
  ✓ order lifecycle respects tenant isolation                                                                    0.34s  
  ✓ concurrent orders for different customers                                                                    0.27s  

   PASS  Tests\Feature\Order\ErrorHandlingAndRecoveryTest
  ✓ invalid order id throws exception                                                                            0.23s  
  ✓ payment exceeding order total throws exception                                                               0.19s  
  ✓ negative payment amount throws exception                                                                     0.19s  
  ✓ invalid percentage in downpayment throws exception                                                           0.18s  
  ✓ invalid quote price throws exception                                                                         0.16s  
  ✓ missing lead time throws exception                                                                           0.16s  
  ✓ invalid negotiation deadline throws exception                                                                0.17s  
  ✓ invalid concluded price throws exception                                                                     0.14s  
  ✓ invalid concluded lead time throws exception                                                                 0.15s  
  ✓ empty quote comparison throws exception                                                                      0.25s  
  ✓ cross tenant order access throws exception                                                                   0.16s  
  ✓ cross vendor assignment throws exception                                                                     0.15s  
  ✓ order recovery after partial failure                                                                         0.20s  
  ✓ order cancellation on error condition                                                                        0.28s  
  ✓ multiple payment attempts with error recovery                                                                0.16s  
  ✓ negotiation recovery from validation errors                                                                  0.18s  

   PASS  Tests\Feature\Order\MultiVendorNegotiationTest
  ✓ negotiate with multiple vendors sequentially                                                                 0.28s  
  ✓ compare quotes from multiple vendors                                                                         0.23s  
  ✓ vendor with lowest price selected                                                                            0.14s  
  ✓ vendor with best lead time selected                                                                          0.15s  
  ✓ price negotiation round escalation                                                                           0.31s  
  ✓ negotiation deadline and urgency                                                                             0.14s  
  ✓ negotiation escalation workflow                                                                              0.26s  
  ✓ multi tenant vendor negotiation isolation                                                                    0.18s  

   PASS  Tests\Feature\Order\PaymentProcessingTest
  ✓ full payment processing workflow                                                                             0.18s  
  ✓ downpayment and final payment                                                                                0.28s  
  ✓ partial payment tracking                                                                                     0.19s  
  ✓ payment amount validation                                                                                    0.16s  
  ✓ negative payment amount rejected                                                                             0.16s  
  ✓ invoice generation for payment tracking                                                                      0.16s  
  ✓ payment method recording                                                                                     0.15s  
  ✓ multiple payment transactions same order                                                                     0.15s  
  ✓ payment processing multi tenant isolation                                                                    0.17s  

   PASS  Tests\Feature\RefundGatewayIntegrationTest
  ✓ it can process successful refund through gateway                                                             0.69s  
  ✓ it handles failed refund processing                                                                          0.30s  
  ✓ it handles exceptions during processing                                                                      0.18s  
  ✓ it can retry failed refunds                                                                                  0.20s  
  ✓ it prevents retry of non retryable errors                                                                    0.17s  
  ✓ it can process manual refunds                                                                                0.20s  
  ✓ it can check refund status from gateway                                                                      0.17s  
  ✓ it can process bulk refunds                                                                                  0.25s  
  ✓ it handles mixed results in bulk processing                                                                  0.24s  

   PASS  Tests\Feature\ShippingTest
  ✓ calculate shipping cost                                                                                      0.28s  
  ✓ create shipment                                                                                              0.23s  
  ✓ process shipment                                                                                             0.22s  
  ✓ cannot process non pending shipment                                                                          0.15s  
  ✓ update tracking                                                                                              0.21s  
  ✓ cancel shipment                                                                                              0.19s  
  ✓ cannot cancel delivered shipment                                                                             0.17s  
  ✓ shipment has correct delivery status                                                                         0.18s  
  ✓ get latest tracking event                                                                                    0.21s  
  ✓ shipping method scopes                                                                                       0.19s  
  ✓ shipment scopes                                                                                              0.27s  

   PASS  Tests\Feature\TenantIsolationTest
  ✓ tenant a cannot access tenant b customers                                                                    0.13s  
  ✓ tenant b cannot access tenant a products                                                                     0.15s  
  ✓ orders are properly scoped to tenant                                                                         0.13s  
  ✓ cross tenant relationships are prevented                                                                     0.12s  
  ✓ tenant data counts are isolated                                                                              0.14s  
  ✓ tenant switching works correctly                                                                             0.14s  
  ✓ tenant models automatically get tenant id                                                                    0.12s  

   PASS  Tests\Feature\Tenant\Api\AnalyticsSegmentationExportTest
  ✓ customer segmentation endpoint returns distribution                                                          0.39s  
  ✓ vendor analytics endpoint returns summary                                                                    0.33s  
  ✓ analytics export endpoints return data                                                                       0.33s  
  ✓ inventory reconciliation flow and export                                                                     0.83s  

   PASS  Tests\Feature\Tenant\Api\CustomerVendorSearchExportTest
  ✓ customer search returns segmentation data                                                                    0.17s  
  ✓ customer export streams csv                                                                                  0.22s  
  ✓ vendor search includes performance metrics                                                                   0.18s  
  ✓ vendor export respects min score filter                                                                      0.21s  
  ✓ product taxonomy helpers return data                                                                         0.25s  

   PASS  Tests\Feature\Tenant\Api\InventoryControllerTest
  ✓ can create location and set stock                                                                            0.29s  
  ✓ transfer stock between locations updates balances                                                            0.32s  
  ✓ reserve and release stock updates balances                                                                   0.43s  
  ✓ run reconciliation async dispatches job                                                                      0.33s  
  ✓ reconciliation job balances item and logs variance                                                           0.26s  
  ✓ reconciliation job accounts for global reservations                                                          0.26s  

   PASS  Tests\Feature\Tenant\Api\MultiTenantIsolationTest
  ✓ tenant a cannot see tenant b orders                                                                          0.21s  
  ✓ tenant a cannot access tenant b order detail                                                                 0.15s  
  ✓ tenant a cannot see tenant b customers                                                                       0.16s  
  ✓ tenant a cannot access tenant b customer detail                                                              0.18s  
  ✓ tenant a cannot see tenant b products                                                                        0.20s  
  ✓ tenant a cannot see tenant b vendors                                                                         0.21s  
  ✓ tenant a cannot update tenant b order                                                                        0.22s  
  ✓ tenant a cannot delete tenant b customer                                                                     0.29s  
  ✓ orders include only tenant specific customers                                                                0.27s  
  ✓ analytics only show tenant data                                                                              0.40s  
  ✓ dashboard stats isolated by tenant                                                                           0.42s  
  ✓ switching tenant context works correctly                                                                     0.24s  
  ✓ database queries automatically scope by tenant                                                               0.19s  

   PASS  Tests\Feature\Tenant\Api\OrderApiTest
  ✓ can list orders                                                                                              0.35s  
  ✓ order list excludes other tenant data                                                                        0.34s  
  ✓ can filter orders by status                                                                                  0.29s  
  ✓ can create order                                                                                             0.35s  
  ✓ can show order detail                                                                                        0.26s  
  ✓ can update order                                                                                             0.25s  
  ✓ can update order status                                                                                      0.25s  
  ✓ cannot update to invalid status                                                                              0.15s  
  ✓ can ship order with tracking number                                                                          0.16s  
  ✓ can cancel order with reason                                                                                 0.17s  
  ✓ can get available transitions                                                                                0.17s  
  ✓ cannot update other tenant order                                                                             0.14s  
  ✓ cannot delete other tenant order                                                                             0.15s  
  ✓ cannot access other tenant orders                                                                            0.15s  
  ✓ order search works correctly                                                                                 0.27s  
  ✓ order date range filter works                                                                                0.20s  
  ✓ status endpoint is tenant scoped                                                                             0.19s  
  ✓ customer endpoint is tenant scoped                                                                           0.19s  
  ✓ quotations endpoint is tenant scoped                                                                         0.34s  

   WARN  Tests\Feature\Tenant\Api\PaymentRefundTest
  - initiate refund → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund status tracking → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - vendor reversal disbursement → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - payment reconciliation after refund → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund with multiple partial amounts → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - cannot refund more than paid → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund with zero amount rejected → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund status pending on creation → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund status completed after processing → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund reason stored → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund timestamp recorded → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - list refunds for order → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund payment method preserved → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund audit trail → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund cannot be initiated on unpaid order → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund updates order payment status → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund creates transaction record → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund isolation between tenants → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund approval workflow → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.
  - refund rejection workflow → Payment refund feature is not yet implemented. Routes and endpoints for refund processing need to be created.

   PASS  Tests\Feature\Tenant\Api\VendorEvaluationApiTest
  ✓ can list vendor evaluations                                                                                  0.29s  
  ✓ evaluations list excludes null quality ratings                                                               0.20s  
  ✓ evaluations list supports pagination                                                                         0.44s  
  ✓ evaluations list supports sorting                                                                            0.23s  
  ✓ can create vendor evaluation                                                                                 0.24s  
  ✓ creating evaluation updates vendor rating                                                                    0.21s  
  ✓ create evaluation validates required fields                                                                  0.14s  
  ✓ create evaluation validates rating range                                                                     0.18s  
  ✓ create evaluation returns 404 for non existent vendor                                                        0.17s  
  ✓ create evaluation returns 404 for non existent vendor order                                                  0.17s  
  ✓ list evaluations returns 404 for non existent vendor                                                         0.14s  

   PASS  Tests\Feature\Tenant\Api\VendorOrderApiTest
  ✓ can list vendor orders                                                                                       0.26s  
  ✓ vendor orders list supports pagination                                                                       0.43s  
  ✓ vendor orders list supports status filter                                                                    0.19s  
  ✓ vendor orders list supports delivery status filter                                                           0.23s  
  ✓ vendor orders list supports date range filter                                                                0.29s  
  ✓ vendor orders list supports sorting                                                                          0.42s  
  ✓ vendor orders summary calculates correctly                                                                   0.27s  
  ✓ can get specific vendor order                                                                                0.33s  
  ✓ vendor order show calculates profit margin                                                                   0.23s  
  ✓ vendor order show returns null profit margin when prices missing                                             0.25s  
  ✓ vendor order show returns 404 for non existent order                                                         0.19s  
  ✓ vendor orders list returns 404 for non existent vendor                                                       0.17s  
  ✓ vendor order show returns 404 for non existent vendor                                                        0.19s  

   PASS  Tests\Feature\Tenant\Api\VendorPerformanceApiTest
  ✓ can get delivery metrics                                                                                     0.33s  
  ✓ delivery metrics filters by period                                                                           0.23s  
  ✓ delivery metrics filters by vendor                                                                           0.23s  
  ✓ delivery metrics handles no data                                                                             0.16s  
  ✓ can get quality metrics                                                                                      0.22s  
  ✓ quality metrics excludes null ratings                                                                        0.19s  
  ✓ quality metrics handles no data                                                                              0.15s  

   PASS  Tests\Feature\Tenant\Api\VendorSpecializationApiTest
  ✓ can list vendor specializations                                                                              0.18s  
  ✓ list specializations handles empty array                                                                     0.16s  
  ✓ list specializations transforms string array                                                                 0.25s  
  ✓ can add vendor specialization                                                                                0.15s  
  ✓ add specialization auto categorizes                                                                          0.14s  
  ✓ add specialization prevents duplicates                                                                       0.16s  
  ✓ add specialization validates required fields                                                                 0.14s  
  ✓ can update vendor specialization                                                                             0.15s  
  ✓ update specialization returns 404 for non existent id                                                        0.14s  
  ✓ can delete vendor specialization                                                                             0.14s  
  ✓ delete specialization returns 404 for non existent id                                                        0.15s  
  ✓ specialization operations return 404 for non existent vendor                                                 0.17s  
  ✓ specialization id increments correctly                                                                       0.17s  

  Tests:    26 skipped, 1025 passed (3874 assertions)
  Duration: 227.90s

